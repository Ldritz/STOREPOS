import{r as l,j as e}from"./vendor-react-DYaHPGH9.js";import{T as r,E as a,i as V,e as U}from"./index-75GWciUF.js";import"./vendor-B_ioZ_iA.js";import"./vendor-firebase-Bk-C1n0P.js";const ne=({isOpen:f,onClose:p,onAddTransaction:g,inventory:i})=>{const[s,j]=l.useState(r.Income),[d,x]=l.useState(""),[q,y]=l.useState(""),[A,T]=l.useState(""),[m,L]=l.useState(a.General),[M,C]=l.useState(""),[O,E]=l.useState(""),[c,S]=l.useState([]),[u,N]=l.useState(null),[I,$]=l.useState(1),G=l.useMemo(()=>i.filter(t=>!t.isDisabled),[i]);l.useEffect(()=>{f&&(j(r.Income),x(""),y(""),T(new Date().toISOString().split("T")[0]),S([]),N(null),$(1),L(a.General),C(""),E(""))},[f]);const{totalAmount:h,autoName:k}=l.useMemo(()=>{if((s===r.Income||s===r.Expense&&m===a.InventoryPurchase)&&c.length>0){let t=0;c.forEach(o=>{const w=i.find(P=>P.id===o.itemId);if(w){const P=(s===r.Income,w.price);t+=P*o.quantity}});const n=s===r.Income?"Point of Sale Transaction":"Inventory Purchase";return{totalAmount:Math.round(t),autoName:n}}return{totalAmount:0,autoName:""}},[c,i,s,m]);if(l.useEffect(()=>{s===r.Expense&&m===a.InventoryPurchase||s===r.Income?(x(h>0?h.toString():""),y(k)):m===a.General&&(x(""),y(""))},[h,k,s,m]),!f)return null;const J=t=>{t.preventDefault();const n=new Date,[o,w,P]=A.split("-").map(Number),D=new Date(o,w-1,P,n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()).toISOString(),F=` #${Math.random().toString(36).substring(2,7)}`;if(s===r.Income)c.length>0&&(g({type:s,amount:h,name:`${k}${F}`,date:D,items:c.map(b=>({inventoryItemId:b.itemId,quantity:b.quantity}))}),p());else{const b=parseFloat(d);if(m===a.InventoryPurchase){if(c.length>0&&!isNaN(b)&&b>=0){const H=`${[M.trim(),k].filter(Boolean).join(" - ")}${F}`;g({type:r.Expense,expenseSubtype:a.InventoryPurchase,amount:b,name:H,date:D,items:c.map(K=>({inventoryItemId:K.itemId,quantity:K.quantity}))}),p()}}else if(q&&!isNaN(b)&&b>0){const H=`${[O.trim(),q.trim()].filter(Boolean).join(" - ")}`;g({type:r.Expense,expenseSubtype:a.General,amount:b,name:`${H}${F}`,date:D}),p()}}},_=t=>{j(t),S([]),x(""),y(""),N(null),C(""),E("")},R=t=>{L(t),S([]),x(""),y(t===a.InventoryPurchase?"Inventory Purchase":""),N(null),C(""),E("")},B=t=>{s===r.Income&&t.stock<=0&&u!==t.id||(u===t.id?N(null):(N(t.id),$(1)))},Q=()=>{!u||I<=0||(S(t=>{const n=t.findIndex(o=>o.itemId===u);if(n>-1){const o=[...t];return o[n].quantity+=I,o}return[...t,{itemId:u,quantity:I}]}),N(null))},z=t=>{S(n=>n.filter(o=>o.itemId!==t))},v="w-full px-3 py-2 bg-background border border-input rounded-lg focus:outline-none focus:ring-2 focus:ring-ring";return e.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fade-in",children:e.jsxs("div",{className:"relative w-full max-w-3xl rounded-xl bg-background border border-border shadow-2xl animate-slide-in-up max-h-[90vh] flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-border/40",children:[e.jsx("h2",{className:"text-xl font-semibold tracking-tight",children:"Add Transaction"}),e.jsx("button",{onClick:p,className:"rounded-lg p-2.5 text-muted-foreground hover:text-foreground hover:bg-muted/80 transition-colors","aria-label":"Close modal",children:e.jsx(V,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"px-6 py-4 border-b border-border/40 bg-muted/40",children:e.jsxs("div",{className:"inline-flex p-1 bg-muted rounded-lg",children:[e.jsx("button",{type:"button",onClick:()=>_(r.Income),className:`px-4 py-2 rounded-md font-medium text-sm transition-all ${s===r.Income?"bg-success text-success-foreground shadow-sm":"text-muted-foreground hover:text-foreground"}`,children:"Income"}),e.jsx("button",{type:"button",onClick:()=>_(r.Expense),className:`px-4 py-2 rounded-md font-medium text-sm transition-all ${s===r.Expense?"bg-warning text-warning-foreground shadow-sm":"text-muted-foreground hover:text-foreground"}`,children:"Expense"})]})}),e.jsxs("form",{onSubmit:J,className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:s===r.Income?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-muted-foreground mb-2",children:"Select Products"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3 max-h-64 overflow-y-auto bg-muted/40 p-3 rounded-lg",children:G.length>0?G.map(t=>{const n=u===t.id,o=t.stock<=0&&!n;return e.jsxs("button",{type:"button",onClick:()=>B(t),disabled:o,className:`relative p-3 rounded-lg text-left transition-all duration-200 border ${n?"border-primary bg-primary/5 shadow-sm":"border-border/50 bg-card hover:border-border"} ${o?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("p",{className:"font-medium truncate",children:t.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["(",t.unit,")"]}),e.jsx("p",{className:"text-lg font-semibold text-success mt-1",children:t.price.toLocaleString("en-PH",{style:"currency",currency:"PHP"})}),n&&e.jsx("div",{className:"absolute inset-0 ring-2 ring-primary ring-offset-2 ring-offset-background rounded-lg pointer-events-none"}),t.stock<=0&&e.jsx("span",{className:"absolute top-1 right-1 text-xs bg-destructive/10 text-destructive font-medium px-2 py-0.5 rounded-full",children:"Out"})]},t.id)}):e.jsx("p",{className:"col-span-full text-center text-muted-foreground py-4",children:"No products available for sale."})})]}),u&&(()=>{const t=i.find(n=>n.id===u);return t?e.jsx(X,{item:t,quantity:I,setQuantity:$,onAddToCart:Q}):null})(),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Current Order"}),e.jsx("div",{className:"space-y-2",children:c.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-4 bg-muted/40 rounded-lg",children:"Select products to add to cart."}):c.map(t=>{const n=i.find(o=>o.id===t.itemId);return n?e.jsxs("div",{className:"flex items-center justify-between p-3 bg-card border border-border/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:n.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t.quantity," ",n.unit," × ",n.price.toLocaleString("en-PH",{style:"currency",currency:"PHP"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("p",{className:"font-semibold",children:(t.quantity*n.price).toLocaleString("en-PH",{style:"currency",currency:"PHP"})}),e.jsx("button",{type:"button",onClick:()=>z(t.itemId),className:"p-1.5 rounded-md text-muted-foreground hover:text-destructive hover:bg-destructive/10 transition-colors",children:e.jsx(U,{className:"w-4 h-4"})})]})]},t.itemId):null})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"date",className:"block text-sm font-medium text-muted-foreground mb-1.5",children:"Date"}),e.jsx("input",{type:"date",id:"date",value:A,onChange:t=>T(t.target.value),required:!0,className:v})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"inline-flex w-full p-1 bg-muted rounded-lg",children:[e.jsx("button",{type:"button",onClick:()=>R(a.General),className:`flex-1 py-2 text-sm font-medium rounded-md transition-all ${m===a.General?"bg-card shadow text-foreground":"text-muted-foreground hover:text-foreground"}`,children:"General"}),e.jsx("button",{type:"button",onClick:()=>R(a.InventoryPurchase),className:`flex-1 py-2 text-sm font-medium rounded-md transition-all ${m===a.InventoryPurchase?"bg-card shadow text-foreground":"text-muted-foreground hover:text-foreground"}`,children:"By Product"})]}),m===a.General?e.jsxs("div",{className:"space-y-4 animate-fade-in",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"amount",className:"block text-sm font-medium text-muted-foreground mb-1.5",children:"Amount"}),e.jsx("input",{type:"number",id:"amount",value:d,onChange:t=>x(t.target.value),required:!0,min:"0.01",step:"0.01",placeholder:"0.00",className:v})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"expense_name",className:"block text-sm font-medium text-muted-foreground mb-1.5",children:"Name"}),e.jsx("input",{type:"text",id:"expense_name",value:q,onChange:t=>y(t.target.value),required:!0,placeholder:"e.g., Rent, Utilities",className:v})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"expense_note",className:"block text-sm font-medium text-muted-foreground mb-1.5",children:"Note (Optional)"}),e.jsx("input",{type:"text",id:"expense_note",value:O,onChange:t=>E(t.target.value),placeholder:"e.g., Office supplies from store X",className:v})]})]}):e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-muted-foreground mb-2",children:"Select Products to Purchase"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3 max-h-64 overflow-y-auto bg-muted/40 p-3 rounded-lg",children:i.length>0?i.map(t=>{const n=u===t.id;return e.jsxs("button",{type:"button",onClick:()=>B(t),className:`relative p-3 rounded-lg text-left transition-all duration-200 border ${n?"border-primary bg-primary/5 shadow-sm":"border-border/50 bg-card hover:border-border"}`,children:[e.jsx("p",{className:"font-medium truncate",children:t.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["(",t.unit,")"]}),e.jsx("p",{className:"text-lg font-semibold text-info mt-1",children:t.price.toLocaleString("en-PH",{style:"currency",currency:"PHP"})}),n&&e.jsx("div",{className:"absolute inset-0 ring-2 ring-primary ring-offset-2 ring-offset-background rounded-lg pointer-events-none"})]},t.id)}):e.jsx("p",{className:"col-span-full text-center text-muted-foreground py-4",children:"Add items to inventory first."})})]}),u&&(()=>{const t=i.find(n=>n.id===u);return t?e.jsx(X,{item:t,quantity:I,setQuantity:$,onAddToCart:Q}):null})(),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Purchase List"}),e.jsx("div",{className:"space-y-2",children:c.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-4 bg-muted/40 rounded-lg",children:"Add products to the list."}):c.map(t=>{const n=i.find(o=>o.id===t.itemId);return n?e.jsxs("div",{className:"flex items-center justify-between p-3 bg-card border border-border/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:n.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t.quantity," ",n.unit]})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("button",{type:"button",onClick:()=>z(t.itemId),className:"p-1.5 rounded-md text-muted-foreground hover:text-destructive hover:bg-destructive/10 transition-colors","aria-label":`Remove ${n.name}`,children:e.jsx(U,{className:"w-4 h-4"})})})]},t.itemId):null})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"purchase_note",className:"block text-sm font-medium text-muted-foreground mb-1.5",children:"Note (Optional)"}),e.jsx("input",{type:"text",id:"purchase_note",value:M,onChange:t=>C(t.target.value),placeholder:"e.g., Stocks from primary supplier",className:v})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"date",className:"block text-sm font-medium text-muted-foreground mb-1.5",children:"Date"}),e.jsx("input",{type:"date",id:"date",value:A,onChange:t=>T(t.target.value),required:!0,className:v})]})]})}),e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-t border-border/40 bg-muted/40",children:[h>0&&(s===r.Income||s===r.Expense&&m===a.InventoryPurchase)&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Amount"}),e.jsx("p",{className:`text-2xl font-semibold ${s===r.Income?"text-success":"text-warning"}`,children:h.toLocaleString("en-PH",{style:"currency",currency:"PHP"})})]}),e.jsxs("div",{className:"flex items-center gap-3 ml-auto",children:[e.jsx("button",{type:"button",onClick:p,className:"px-4 py-2 rounded-lg font-semibold text-sm bg-muted hover:bg-muted/80 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded-lg font-semibold text-sm bg-primary text-primary-foreground hover:bg-primary/90 transition-colors",children:"Save Transaction"})]})]})]})]})})},X=({item:f,quantity:p,setQuantity:g,onAddToCart:i})=>{const s=d=>{const x=Math.floor(p);g(x+d)},j=["Kilo","kg","L","Litre"].some(d=>f.unit.toLowerCase().includes(d.toLowerCase()));return e.jsxs("div",{className:"p-3 bg-accent rounded-lg my-4 animate-fade-in border-t-2 border-dashed border-border",children:[e.jsxs("p",{className:"font-semibold mb-2 text-sm text-center text-accent-foreground",children:["Enter Quantity for ",f.name," (",f.unit,")"]}),j&&e.jsx("div",{className:"flex justify-center gap-2 mb-3",children:[.25,.5,.75].map(d=>e.jsx("button",{type:"button",onClick:()=>s(d),className:"w-10 h-8 text-sm font-bold bg-background border border-border rounded-md hover:bg-muted transition",children:d===.25?"¼":d===.5?"½":"¾"},d))}),e.jsxs("div",{className:"flex items-center gap-2 mb-3 justify-center",children:[e.jsx("button",{type:"button",onClick:()=>g(d=>Math.max(j?.25:1,d-1)),className:"w-10 h-10 text-2xl font-bold bg-background border border-border rounded-md hover:bg-muted transition",children:"-"}),e.jsx("input",{type:"number",value:p,onChange:d=>g(Number(d.target.value)),step:j?"0.01":"1",className:"w-20 h-10 text-center font-bold text-lg bg-background border border-input rounded-md focus:ring-ring focus:border-ring"}),e.jsx("button",{type:"button",onClick:()=>g(d=>d+1),className:"w-10 h-10 text-2xl font-bold bg-background border border-border rounded-md hover:bg-muted transition",children:"+"})]}),e.jsx("button",{onClick:i,className:"w-full bg-primary/80 text-primary-foreground font-semibold py-2 px-4 rounded-lg hover:bg-primary transition-colors",children:"Add to Cart"})]})};export{ne as default};
