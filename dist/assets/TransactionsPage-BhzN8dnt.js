import{r as T,j as e,R as q}from"./vendor-react-DYaHPGH9.js";import{T as x,E as P,L as R,c as B,d as H,e as V,C as Y}from"./index-75GWciUF.js";import"./vendor-B_ioZ_iA.js";import"./vendor-firebase-Bk-C1n0P.js";const f=(s,o=!1)=>(o?Math.abs(s):s).toLocaleString("en-PH",{style:"currency",currency:"PHP"}),W=({title:s,value:o,avg:h})=>e.jsxs("div",{className:"text-center md:text-left",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wider",children:s}),e.jsx("p",{className:"text-2xl font-bold text-foreground mt-1",children:f(o)}),h!==void 0&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["avg ",f(h),"/day"]})]}),$=({title:s,stats:o})=>e.jsxs("div",{className:"bg-card border border-border p-4 sm:p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-bold text-card-foreground mb-4",children:s}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(W,{title:`Today's ${s.split(" ")[0]}`,value:o.today}),e.jsx(W,{title:"This Week",value:o.thisWeek,avg:o.avgWeek}),e.jsx(W,{title:"All Time",value:o.allTime,avg:o.avgAllTime})]})]}),F=({transaction:s,inventory:o,onDeleteTransaction:h,onEditTransaction:b})=>{var S,D;const[a,w]=T.useState(!1),g=(s.type===x.Income||s.type===x.Expense&&s.expenseSubtype===P.InventoryPurchase)&&s.items&&s.items.length>0,v=()=>{g&&w(!a)},k=((S=s.items)==null?void 0:S.reduce((j,y)=>j+y.quantity,0))||0,C=e.jsxs("button",{onClick:v,className:"flex items-center justify-end gap-1 text-muted-foreground w-full hover:text-foreground transition-colors",children:[e.jsxs("span",{className:"text-xs",children:[k," item(s)"]}),e.jsx(Y,{className:`w-4 h-4 transition-transform ${a?"rotate-180":""}`})]}),A=e.jsxs("span",{className:"text-xs text-muted-foreground",children:[k," item(s)"]});return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"bg-card border border-border p-4 rounded-lg flex justify-between items-center group",children:[e.jsx("div",{className:"flex-1 min-w-0 pr-4",children:e.jsx("p",{className:"font-bold text-foreground truncate",children:s.name||""})}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:`font-bold text-lg ${s.type===x.Income?"text-success":"text-warning"}`,children:f(s.amount)}),g?C:s.items&&s.items.length>0?A:null]}),e.jsx("button",{onClick:()=>b(s),className:"text-muted-foreground hover:text-info transition-colors opacity-0 group-hover:opacity-100",children:e.jsx(H,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>h(s),className:"text-muted-foreground hover:text-destructive transition-colors opacity-0 group-hover:opacity-100",children:e.jsx(V,{className:"w-5 h-5"})})]})]}),a&&g&&e.jsxs("div",{className:"bg-secondary p-4 rounded-b-lg animate-fade-in border border-border border-t-0",children:[e.jsx("h5",{className:"font-semibold mb-2 text-secondary-foreground",children:s.type===x.Income?"Items Sold":"Items Purchased"}),e.jsx("ul",{className:"space-y-2 text-sm",children:(D=s.items)==null?void 0:D.map(j=>{const y=o.find(t=>t.id===j.inventoryItemId);if(!y)return null;const L=y.price*j.quantity;return e.jsxs("li",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"text-muted-foreground",children:[y.name," "]}),e.jsxs("span",{className:"text-xs text-muted-foreground/70",children:["(x",j.quantity,")"]})]}),e.jsx("span",{className:"font-mono text-foreground",children:f(L)})]},j.inventoryItemId)})})]})]})},U=({data:s,sortedDateKeys:o})=>e.jsx("div",{className:"bg-card border border-border rounded-lg overflow-hidden animate-fade-in",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left text-muted-foreground",children:[e.jsx("thead",{className:"text-xs text-muted-foreground uppercase bg-secondary",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-4 py-3",children:"Date"}),e.jsx("th",{scope:"col",className:"px-4 py-3 min-w-[250px]",children:"Name"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-right",children:"Income (Credit)"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-right",children:"Expense (Debit)"})]})}),e.jsx("tbody",{children:o.length>0?o.map(h=>{const b=s[h];return e.jsxs(q.Fragment,{children:[b.transactions.map((a,w)=>e.jsxs("tr",{className:"border-b border-border hover:bg-muted",children:[e.jsx("td",{className:"px-4 py-3 font-medium text-foreground whitespace-nowrap",children:w===0?new Date(h+"T00:00:00").toLocaleDateString("en-CA"):""}),e.jsxs("td",{className:"px-4 py-3",children:[a.note?e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-foreground",children:a.note}),e.jsx("div",{className:"text-sm text-muted-foreground",children:a.name})]}):e.jsx("div",{children:a.name}),a.items&&a.items.length>0&&e.jsx("ul",{className:"text-xs text-muted-foreground/80 mt-1 pl-4 list-disc",children:a.items.map((g,v)=>e.jsxs("li",{children:[g.quantity," ",g.unit," - ",g.name]},v))})]}),e.jsx("td",{className:"px-4 py-3 text-right font-mono text-success",children:a.income?f(a.income):"-"}),e.jsx("td",{className:"px-4 py-3 text-right font-mono text-warning",children:a.expense?f(a.expense):"-"})]},a.id)),e.jsxs("tr",{className:"bg-secondary border-b-2 border-border",children:[e.jsx("td",{colSpan:2,className:"px-4 py-2 text-right font-bold text-foreground",children:"Total"}),e.jsx("td",{className:"px-4 py-2 text-right font-mono font-bold text-success",children:f(b.totalIncome)}),e.jsx("td",{className:"px-4 py-2 text-right font-mono font-bold text-warning",children:f(b.totalExpense)})]})]},h)}):e.jsx("tr",{children:e.jsxs("td",{colSpan:4,className:"text-center py-16 text-muted-foreground",children:[e.jsx("p",{className:"font-semibold text-lg",children:"No transactions found."}),e.jsx("p",{children:"Try changing the filter."})]})})})]})})}),J=({transactions:s,inventory:o,onDeleteTransaction:h,onEditTransaction:b})=>{const[a,w]=T.useState("ALL"),[g,v]=T.useState("list"),{incomeStats:k,expenseStats:C}=T.useMemo(()=>{const t=new Date,d=t.toISOString().split("T")[0],i=new Date(t);i.setDate(t.getDate()-6),i.setHours(0,0,0,0);let n=0,l=0,r=0,m=0,u=0,c=0;if(s.length===0)return{incomeStats:{today:0,thisWeek:0,allTime:0,avgWeek:0,avgAllTime:0},expenseStats:{today:0,thisWeek:0,allTime:0,avgWeek:0,avgAllTime:0}};const N=[...s].sort((p,E)=>new Date(p.date).getTime()-new Date(E.date).getTime());N.forEach(p=>{const E=new Date(p.date);p.type===x.Income?(r+=p.amount,p.date.startsWith(d)&&(n+=p.amount),E>=i&&(l+=p.amount)):(c+=p.amount,p.date.startsWith(d)&&(m+=p.amount),E>=i&&(u+=p.amount))});const I=new Date(N[0].date),M=Math.ceil((t.getTime()-I.getTime())/(1e3*3600*24)),O=M>0?M:1;return{incomeStats:{today:n,thisWeek:l,allTime:r,avgWeek:l/7,avgAllTime:r/O},expenseStats:{today:m,thisWeek:u,allTime:c,avgWeek:u/7,avgAllTime:c/O}}},[s]),{groupedCashbookData:A,sortedCashbookDateKeys:S}=T.useMemo(()=>{const t={};s.filter(n=>a==="ALL"||n.type===a).forEach(n=>{const l=n.date.split("T")[0];t[l]||(t[l]={transactions:[],totalIncome:0,totalExpense:0});let r;n.items&&(n.type===x.Income||n.expenseSubtype===P.InventoryPurchase)&&(r=n.items.map(u=>{const c=o.find(N=>N.id===u.inventoryItemId);return{name:(c==null?void 0:c.name)||"Unknown Item",quantity:u.quantity,unit:(c==null?void 0:c.unit)||""}}));const m={id:n.id,name:n.name||"",income:n.type===x.Income?n.amount:null,expense:n.type===x.Expense?n.amount:null,items:r};if(n.expenseSubtype===P.InventoryPurchase&&n.name){const u=" - Inventory Purchase",c=/ #\w{5}$/,N=n.name.replace(c,"");if(N.includes(u)){const I=N.split(u)[0];I&&(m.note=I,m.name=n.name.substring(I.length+3))}}t[l].transactions.push(m),n.type===x.Income?t[l].totalIncome+=n.amount:t[l].totalExpense+=n.amount});for(const n in t)t[n].transactions.sort((l,r)=>{const m=s.find(c=>c.id===l.id),u=s.find(c=>c.id===r.id);return!m||!u?0:new Date(m.date).getTime()-new Date(u.date).getTime()});const i=Object.keys(t).sort((n,l)=>new Date(l).getTime()-new Date(n).getTime());return{groupedCashbookData:t,sortedCashbookDateKeys:i}},[s,a,o]),D=T.useMemo(()=>s.filter(t=>a==="ALL"||t.type===a).reduce((t,d)=>{const i=d.date.split("T")[0];return t[i]||(t[i]=[]),t[i].push(d),t},{}),[s,a]),j=Object.keys(D).sort((t,d)=>new Date(d).getTime()-new Date(t).getTime()),y=t=>{const d=new Date,i=new Date;i.setDate(d.getDate()-1);const n=new Date(t+"T00:00:00");return n.toDateString()===d.toDateString()?"TODAY":n.toDateString()===i.toDateString()?"YESTERDAY":n.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})},L=[{label:"All",value:"ALL"},{label:"Sales",value:x.Income},{label:"Expenses",value:x.Expense}];return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx($,{title:"Income Overview",stats:k}),e.jsx($,{title:"Expense Overview",stats:C})]}),e.jsxs("div",{className:"flex justify-between items-center border-b border-border",children:[e.jsx("div",{className:"flex space-x-6",children:L.map(t=>e.jsx("button",{onClick:()=>w(t.value),className:`py-2 font-semibold transition-colors ${a===t.value?"text-primary border-b-2 border-primary":"text-muted-foreground hover:text-foreground"}`,children:t.label},t.value))}),e.jsxs("div",{className:"flex items-center gap-1 bg-secondary p-1 rounded-lg",children:[e.jsxs("button",{onClick:()=>v("list"),className:`px-3 py-1.5 flex items-center gap-2 rounded-md text-sm font-medium transition-colors ${g==="list"?"bg-primary text-primary-foreground":"text-muted-foreground hover:text-foreground"}`,"aria-label":"List View",children:[e.jsx(R,{className:"w-5 h-5"}),e.jsx("span",{children:"List"})]}),e.jsxs("button",{onClick:()=>v("cashbook"),className:`px-3 py-1.5 flex items-center gap-2 rounded-md text-sm font-medium transition-colors ${g==="cashbook"?"bg-primary text-primary-foreground":"text-muted-foreground hover:text-foreground"}`,"aria-label":"Cashbook View",children:[e.jsx(B,{className:"w-5 h-5"}),e.jsx("span",{children:"Cashbook"})]})]})]}),g==="list"?e.jsx("div",{className:"space-y-6 animate-fade-in",children:j.length>0?j.map(t=>{const d=D[t],i=d.filter(r=>r.type===x.Income).reduce((r,m)=>r+m.amount,0),n=d.filter(r=>r.type===x.Expense).reduce((r,m)=>r+m.amount,0),l=i-n;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-px flex-1 bg-border"}),e.jsx("h4",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wider",children:y(t)}),e.jsx("div",{className:"h-px flex-1 bg-border"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center bg-card border border-border p-3 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground block",children:"INCOME"}),e.jsx("span",{className:"font-bold text-success",children:f(i)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground block",children:"EXPENSES"}),e.jsx("span",{className:"font-bold text-warning",children:f(n)})]}),e.jsx("div",{children:e.jsxs("span",{className:`font-bold ${l<0?"text-destructive":"text-info"}`,children:[e.jsx("span",{className:"text-xs text-muted-foreground block",children:"NET"}),f(l)]})})]}),e.jsx("div",{className:"space-y-2",children:d.map(r=>e.jsx(F,{transaction:r,inventory:o,onDeleteTransaction:h,onEditTransaction:b},r.id))})]},t)}):e.jsxs("div",{className:"text-center py-16 text-muted-foreground",children:[e.jsx("p",{className:"font-semibold text-lg",children:"No transactions found."}),e.jsx("p",{children:"Try changing the filter or adding a new transaction."})]})}):e.jsx(U,{data:A,sortedDateKeys:S})]})};export{J as default};
