import{r as a,j as e}from"./vendor-react-DYaHPGH9.js";import{C as G}from"./Card-CJQhyZQC.js";import{f as Y,I as M,g as J,h as K,d as V,e as W,i as X,U as Z}from"./index-75GWciUF.js";import{u as _}from"./cloudinary-B-Z19H0V.js";import"./vendor-B_ioZ_iA.js";import"./vendor-firebase-Bk-C1n0P.js";const E=({isOpen:s,onClose:u,onSave:p,itemToEdit:r,profitMarginDivisor:n})=>{const[i,N]=a.useState(""),[y,b]=a.useState(""),[C,f]=a.useState(""),[m,l]=a.useState("pcs"),[o,g]=a.useState("Feeds"),[q,S]=a.useState(""),[v,k]=a.useState(""),[D,P]=a.useState(null),[U,$]=a.useState(!1),[w,L]=a.useState(""),[I,O]=a.useState(""),Q=a.useRef(null),j=!r,F=a.useMemo(()=>{const t=parseFloat(w),d=parseInt(I,10);if(j&&t>0&&d>0&&n>0){const c=t/d;return Math.round(c/n)}return 0},[w,I,j,n]),A=a.useMemo(()=>n>0&&n<1?((1-n)*100).toFixed(1):0,[n]);if(a.useEffect(()=>{s&&(r?(N(r.name),b(r.price.toString()),f(r.stock.toString()),l(r.unit),g(r.category||"Feeds"),S(r.cost||""),k(r.imageUrl||""),P(null),L(""),O("")):(N(""),b(""),f(""),l("pcs"),g("Feeds"),S(""),k(""),P(null),L(""),O("")))},[r,s]),!s)return null;const H=t=>{var c;const d=(c=t.target.files)==null?void 0:c[0];d&&(P(d),k(URL.createObjectURL(d)))},z=async t=>{t.preventDefault(),$(!0);let d=(r==null?void 0:r.imageUrl)||"";if(D)try{d=await _(D)}catch{$(!1);return}else v!==(r==null?void 0:r.imageUrl)&&(d=v);if(j){const c=parseInt(I,10);i&&m&&F>0&&c>0&&(p({name:i,price:F,stock:c,unit:m,category:o,cost:`Cost: ₱${parseFloat(w).toLocaleString()} / ${c} ${m}`,imageUrl:d}),u())}else{const c=parseFloat(y),B=parseInt(C,10);i&&m&&!isNaN(c)&&!isNaN(B)&&r&&(p({...r,name:i,price:Math.round(c),stock:B,unit:m,category:o,cost:q,imageUrl:d}),u())}$(!1)},h="w-full px-3 py-2 bg-background border border-border rounded-md text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring",R=`${h} appearance-none`,x="block text-sm font-medium text-muted-foreground mb-1.5";return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex justify-center items-center z-50 animate-fade-in p-4",children:e.jsxs("div",{className:"bg-card rounded-lg border border-border shadow-xl w-full max-w-lg animate-slide-in-up max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border flex-shrink-0",children:[e.jsx("h2",{className:"text-xl font-bold text-card-foreground",children:j?"Add New Product":"Edit Product"}),e.jsx("button",{onClick:u,className:"text-muted-foreground hover:text-foreground",children:e.jsx(X,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:z,className:"p-6 space-y-4 overflow-y-auto",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:x,children:"Product Name"}),e.jsx("input",{type:"text",id:"name",value:i,onChange:t=>N(t.target.value),required:!0,placeholder:"e.g. Grower Pellets",className:h})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"category",className:x,children:"Category"}),e.jsxs("select",{id:"category",value:o,onChange:t=>g(t.target.value),className:R,children:[e.jsx("option",{children:"Feeds"}),e.jsx("option",{children:"Non-Feeds"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"unit",className:x,children:"Unit"}),e.jsxs("select",{id:"unit",value:m,onChange:t=>l(t.target.value),required:!0,className:R,children:[e.jsx("option",{children:"kilo"}),e.jsx("option",{children:"pcs"}),e.jsx("option",{children:"pack"}),e.jsx("option",{children:"bottle"}),e.jsx("option",{children:"box"}),e.jsx("option",{children:"sachet"})]})]})]}),j?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"batchCost",className:x,children:"Batch Cost"}),e.jsx("input",{type:"number",id:"batchCost",value:w,onChange:t=>L(t.target.value),required:!0,min:"0",step:"any",placeholder:"e.g., 1000",className:h})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"batchQuantity",className:x,children:"Quantity in Batch"}),e.jsx("input",{type:"number",id:"batchQuantity",value:I,onChange:t=>O(t.target.value),required:!0,min:"1",step:"1",placeholder:"e.g., 50",className:h})]})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"price",className:x,children:"Price"}),e.jsx("input",{type:"number",id:"price",value:y,onChange:t=>b(t.target.value),required:!0,min:"0",step:"1",className:h})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"stock",className:x,children:"Stock Quantity"}),e.jsx("input",{type:"number",id:"stock",value:C,onChange:t=>f(t.target.value),required:!0,min:"0",step:"1",className:h})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"cost",className:x,children:"Cost Details (Optional)"}),e.jsx("input",{type:"text",id:"cost",value:q,onChange:t=>S(t.target.value),placeholder:"e.g. Cost: P543 / 12 pack",className:h})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:x,children:"Product Image (Optional)"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-24 h-24 flex-shrink-0 bg-secondary rounded-md flex items-center justify-center border border-border",children:v?e.jsx("img",{src:v,alt:"Product Preview",className:"w-full h-full object-cover rounded-md"}):e.jsx(M,{className:"w-10 h-10 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("input",{type:"text",value:v,onChange:t=>k(t.target.value),placeholder:"Paste image URL here",className:h}),e.jsx("div",{className:"text-center text-muted-foreground text-sm",children:"OR"}),e.jsx("input",{type:"file",ref:Q,onChange:H,accept:"image/*",className:"hidden"}),e.jsxs("button",{type:"button",onClick:()=>{var t;return(t=Q.current)==null?void 0:t.click()},className:"w-full flex items-center justify-center gap-2 py-2 px-4 bg-secondary border border-border rounded-md hover:bg-muted transition-colors",children:[e.jsx(Z,{className:"w-5 h-5"}),e.jsx("span",{children:"Upload File"})]})]})]})]}),j&&e.jsxs("div",{className:"bg-secondary border border-border rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Calculated Selling Price (per item)"}),e.jsx("p",{className:"text-3xl font-bold text-success my-1",children:F>0?F.toLocaleString("en-PH",{style:"currency",currency:"PHP",maximumFractionDigits:0}):"₱0"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Based on a ~",A,"% profit margin."]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:u,className:"bg-secondary text-secondary-foreground font-semibold py-2 px-4 rounded-lg hover:bg-muted transition-colors",disabled:U,children:"Cancel"}),e.jsx("button",{type:"submit",className:"bg-primary text-primary-foreground font-semibold py-2 px-4 rounded-lg hover:bg-primary/90 transition-colors disabled:bg-primary/50 disabled:cursor-not-allowed",disabled:U,children:U?"Saving...":"Save Product"})]})]})]})})},T=({item:s,onEdit:u,onDelete:p,onSaveItem:r})=>{const n=s.stock<=5,i=n?"bg-destructive/20 text-destructive":"bg-success/20 text-success";return e.jsxs("div",{className:`bg-card border border-border rounded-lg p-4 flex gap-4 relative transition-all duration-300 hover:shadow-lg hover:-translate-y-1 ${n?"ring-2 ring-destructive":""} ${s.isDisabled?"opacity-60 filter grayscale":""}`,children:[s.isDisabled&&e.jsx("div",{className:"absolute top-2 right-2 text-xs font-bold uppercase bg-card text-foreground px-2 py-0.5 rounded-full border border-border shadow-sm z-10",children:"Disabled"}),e.jsx("div",{className:"w-24 h-24 flex-shrink-0",children:s.imageUrl?e.jsx("img",{src:s.imageUrl,alt:s.name,className:"w-full h-full object-cover rounded-md bg-secondary"}):e.jsx("div",{className:"w-full h-full bg-secondary rounded-md flex items-center justify-center border border-border",children:e.jsx(M,{className:"w-10 h-10 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-baseline",children:[e.jsx("p",{className:"text-lg font-bold text-card-foreground",children:s.name}),n&&s.stock>0&&e.jsx("span",{className:"text-xs font-bold uppercase text-warning ml-2",children:"Low"})]}),e.jsx("p",{className:"text-xl font-bold text-success mt-1",children:s.price.toLocaleString("en-PH",{style:"currency",currency:"PHP",maximumFractionDigits:0})}),s.cost&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.cost}),e.jsx("div",{className:`mt-3 inline-block px-3 py-1 text-sm font-semibold rounded-full ${i}`,children:s.stock>0?`${s.stock} ${s.unit} in stock`:"Out of stock"})]}),e.jsxs("div",{className:"absolute bottom-4 right-4 flex gap-2",children:[e.jsx("button",{onClick:()=>r({...s,isDisabled:!s.isDisabled}),className:"p-2 rounded-full bg-secondary/50 text-muted-foreground hover:bg-muted hover:text-foreground transition-colors",title:s.isDisabled?"Enable Item":"Disable Item",children:s.isDisabled?e.jsx(J,{className:"w-4 h-4"}):e.jsx(K,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>u(s),className:"p-2 rounded-full bg-secondary/50 text-muted-foreground hover:bg-info hover:text-info-foreground transition-colors",children:e.jsx(V,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>p(s.id),className:"p-2 rounded-full bg-secondary/50 text-muted-foreground hover:bg-destructive hover:text-destructive-foreground transition-colors",children:e.jsx(W,{className:"w-4 h-4"})})]})]})},ne=({inventory:s,onSaveItem:u,onDeleteItem:p,profitMarginDivisor:r})=>{const[n,i]=a.useState(!1),[N,y]=a.useState(null),b=l=>{y(l||null),i(!0)},C=()=>{i(!1),y(null)},f=a.useMemo(()=>s.reduce((l,o)=>{const g=o.category||"Non-Feeds";return l[g]||(l[g]=[]),l[g].push(o),l},{}),[s]),m=Object.keys(f).sort((l,o)=>l==="Feeds"?-1:o==="Feeds"?1:l.localeCompare(o));return e.jsxs("div",{className:"animate-fade-in space-y-6",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:()=>b(),className:"flex items-center gap-2 bg-primary text-primary-foreground font-semibold py-2 px-4 rounded-lg hover:bg-primary/90 transition-colors",children:[e.jsx(Y,{className:"w-5 h-5"}),e.jsx("span",{children:"Add Item"})]})}),s.length>0?m.map(l=>e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-foreground mb-4",children:l}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:f[l].map(o=>e.jsx(T,{item:o,onEdit:b,onDelete:p,onSaveItem:u},o.id))})]},l)):e.jsx(G,{className:"text-center py-16",children:e.jsxs("div",{className:"text-muted-foreground",children:[e.jsx("p",{className:"font-semibold text-lg",children:"Your inventory is empty."}),e.jsx("p",{className:"mt-2",children:'Click "Add Item" to get started.'})]})}),e.jsx(E,{isOpen:n,onClose:C,onSave:u,itemToEdit:N,profitMarginDivisor:r})]})};export{ne as default};
