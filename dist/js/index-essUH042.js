const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/DashboardPage-Bx4JcTTG.js","js/charts-BYcMWlQw.js","js/vendor-CWc6w16D.js","js/Card-CaaA6Rhh.js","js/TransactionsPage-yIUDp7wD.js","js/InventoryPage-CfCvR9Yw.js","js/SettingsPage-BsTaUK4x.js"])))=>i.map(i=>d[i]);
var Fm=Object.defineProperty;var jm=(r,t,e)=>t in r?Fm(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var Lt=(r,t,e)=>jm(r,typeof t!="symbol"?t+"":t,e);import{r as Bm,a as Um,g as qm}from"./vendor-CWc6w16D.js";import{R as he,r as G}from"./charts-BYcMWlQw.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function e(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=e(s);fetch(s.href,i)}})();var So={exports:{}},vr={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gu;function zm(){if(gu)return vr;gu=1;var r=Bm(),t=Symbol.for("react.element"),e=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function a(c,u,d){var f,p={},g=null,S=null;d!==void 0&&(g=""+d),u.key!==void 0&&(g=""+u.key),u.ref!==void 0&&(S=u.ref);for(f in u)n.call(u,f)&&!i.hasOwnProperty(f)&&(p[f]=u[f]);if(c&&c.defaultProps)for(f in u=c.defaultProps,u)p[f]===void 0&&(p[f]=u[f]);return{$$typeof:t,type:c,key:g,ref:S,props:p,_owner:s.current}}return vr.Fragment=e,vr.jsx=a,vr.jsxs=a,vr}var _u;function $m(){return _u||(_u=1,So.exports=zm()),So.exports}var A=$m(),Us={},yu;function Gm(){if(yu)return Us;yu=1;var r=Um();return Us.createRoot=r.createRoot,Us.hydrateRoot=r.hydrateRoot,Us}var Km=Gm();const Hm=qm(Km),Wm="modulepreload",Qm=function(r){return"/"+r},Iu={},xi=function(t,e,n){let s=Promise.resolve();if(e&&e.length>0){let a=function(d){return Promise.all(d.map(f=>Promise.resolve(f).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),u=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));s=a(e.map(d=>{if(d=Qm(d),d in Iu)return;Iu[d]=!0;const f=d.endsWith(".css"),p=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${p}`))return;const g=document.createElement("link");if(g.rel=f?"stylesheet":Wm,f||(g.as="script"),g.crossOrigin="",g.href=d,u&&g.setAttribute("nonce",u),document.head.appendChild(g),f)return new Promise((S,V)=>{g.addEventListener("load",S),g.addEventListener("error",()=>V(new Error(`Unable to preload CSS for ${d}`)))})}))}function i(a){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=a,window.dispatchEvent(c),!c.defaultPrevented)throw a}return s.then(a=>{for(const c of a||[])c.status==="rejected"&&i(c.reason);return t().catch(i)})},Xm=()=>{};var Eu={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mh=function(r){const t=[];let e=0;for(let n=0;n<r.length;n++){let s=r.charCodeAt(n);s<128?t[e++]=s:s<2048?(t[e++]=s>>6|192,t[e++]=s&63|128):(s&64512)===55296&&n+1<r.length&&(r.charCodeAt(n+1)&64512)===56320?(s=65536+((s&1023)<<10)+(r.charCodeAt(++n)&1023),t[e++]=s>>18|240,t[e++]=s>>12&63|128,t[e++]=s>>6&63|128,t[e++]=s&63|128):(t[e++]=s>>12|224,t[e++]=s>>6&63|128,t[e++]=s&63|128)}return t},Jm=function(r){const t=[];let e=0,n=0;for(;e<r.length;){const s=r[e++];if(s<128)t[n++]=String.fromCharCode(s);else if(s>191&&s<224){const i=r[e++];t[n++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=r[e++],a=r[e++],c=r[e++],u=((s&7)<<18|(i&63)<<12|(a&63)<<6|c&63)-65536;t[n++]=String.fromCharCode(55296+(u>>10)),t[n++]=String.fromCharCode(56320+(u&1023))}else{const i=r[e++],a=r[e++];t[n++]=String.fromCharCode((s&15)<<12|(i&63)<<6|a&63)}}return t.join("")},ph={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,t){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();const e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let s=0;s<r.length;s+=3){const i=r[s],a=s+1<r.length,c=a?r[s+1]:0,u=s+2<r.length,d=u?r[s+2]:0,f=i>>2,p=(i&3)<<4|c>>4;let g=(c&15)<<2|d>>6,S=d&63;u||(S=64,a||(g=64)),n.push(e[f],e[p],e[g],e[S])}return n.join("")},encodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(r):this.encodeByteArray(mh(r),t)},decodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(r):Jm(this.decodeStringToByteArray(r,t))},decodeStringToByteArray(r,t){this.init_();const e=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let s=0;s<r.length;){const i=e[r.charAt(s++)],c=s<r.length?e[r.charAt(s)]:0;++s;const d=s<r.length?e[r.charAt(s)]:64;++s;const p=s<r.length?e[r.charAt(s)]:64;if(++s,i==null||c==null||d==null||p==null)throw new Ym;const g=i<<2|c>>4;if(n.push(g),d!==64){const S=c<<4&240|d>>2;if(n.push(S),p!==64){const V=d<<6&192|p;n.push(V)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}};class Ym extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Zm=function(r){const t=mh(r);return ph.encodeByteArray(t,!0)},ai=function(r){return Zm(r).replace(/\./g,"")},tp=function(r){try{return ph.decodeString(r,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gh(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ep=()=>gh().__FIREBASE_DEFAULTS__,np=()=>{if(typeof process>"u"||typeof Eu>"u")return;const r=Eu.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},rp=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=r&&tp(r[1]);return t&&JSON.parse(t)},Ea=()=>{try{return Xm()||ep()||np()||rp()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},sp=r=>{var t,e;return(e=(t=Ea())==null?void 0:t.emulatorHosts)==null?void 0:e[r]},ip=r=>{const t=sp(r);if(!t)return;const e=t.lastIndexOf(":");if(e<=0||e+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const n=parseInt(t.substring(e+1),10);return t[0]==="["?[t.substring(1,e-1),n]:[t.substring(0,e),n]},_h=()=>{var r;return(r=Ea())==null?void 0:r.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class op{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,n))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pi(r){try{return(r.startsWith("http://")||r.startsWith("https://")?new URL(r).hostname:r).endsWith(".cloudworkstations.dev")}catch{return!1}}async function yh(r){return(await fetch(r,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ap(r,t){if(r.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const e={alg:"none",type:"JWT"},n=t||"demo-project",s=r.iat||0,i=r.sub||r.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${n}`,aud:n,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...r};return[ai(JSON.stringify(e)),ai(JSON.stringify(a)),""].join(".")}const Mr={};function cp(){const r={prod:[],emulator:[]};for(const t of Object.keys(Mr))Mr[t]?r.emulator.push(t):r.prod.push(t);return r}function up(r){let t=document.getElementById(r),e=!1;return t||(t=document.createElement("div"),t.setAttribute("id",r),e=!0),{created:e,element:t}}let vu=!1;function lp(r,t){if(typeof window>"u"||typeof document>"u"||!Pi(window.location.host)||Mr[r]===t||Mr[r]||vu)return;Mr[r]=t;function e(g){return`__firebase__banner__${g}`}const n="__firebase__banner",i=cp().prod.length>0;function a(){const g=document.getElementById(n);g&&g.remove()}function c(g){g.style.display="flex",g.style.background="#7faaf0",g.style.position="fixed",g.style.bottom="5px",g.style.left="5px",g.style.padding=".5em",g.style.borderRadius="5px",g.style.alignItems="center"}function u(g,S){g.setAttribute("width","24"),g.setAttribute("id",S),g.setAttribute("height","24"),g.setAttribute("viewBox","0 0 24 24"),g.setAttribute("fill","none"),g.style.marginLeft="-6px"}function d(){const g=document.createElement("span");return g.style.cursor="pointer",g.style.marginLeft="16px",g.style.fontSize="24px",g.innerHTML=" &times;",g.onclick=()=>{vu=!0,a()},g}function f(g,S){g.setAttribute("id",S),g.innerText="Learn more",g.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",g.setAttribute("target","__blank"),g.style.paddingLeft="5px",g.style.textDecoration="underline"}function p(){const g=up(n),S=e("text"),V=document.getElementById(S)||document.createElement("span"),C=e("learnmore"),D=document.getElementById(C)||document.createElement("a"),z=e("preprendIcon"),B=document.getElementById(z)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(g.created){const L=g.element;c(L),f(D,C);const j=d();u(B,z),L.append(B,V,D,j),document.body.appendChild(L)}i?(V.innerText="Preview backend disconnected.",B.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(B.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,V.innerText="Preview backend running in this workspace."),V.setAttribute("id",S)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",p):p()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ci(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Ih(){var t;const r=(t=Ea())==null?void 0:t.forceEnvironment;if(r==="node")return!0;if(r==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Eh(){return!Ih()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function vh(){return!Ih()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function wh(){try{return typeof indexedDB=="object"}catch{return!1}}function hp(){return new Promise((r,t)=>{try{let e=!0;const n="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(n);s.onsuccess=()=>{s.result.close(),e||self.indexedDB.deleteDatabase(n),r(!0)},s.onupgradeneeded=()=>{e=!1},s.onerror=()=>{var i;t(((i=s.error)==null?void 0:i.message)||"")}}catch(e){t(e)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dp="FirebaseError";class tr extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name=dp,Object.setPrototypeOf(this,tr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Th.prototype.create)}}class Th{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},s=`${this.service}/${t}`,i=this.errors[t],a=i?fp(i,n):"Error",c=`${this.serviceName}: ${a} (${s}).`;return new tr(s,c,n)}}function fp(r,t){return r.replace(mp,(e,n)=>{const s=t[n];return s!=null?String(s):`<${n}?>`})}const mp=/\{\$([^}]+)}/g;function Gr(r,t){if(r===t)return!0;const e=Object.keys(r),n=Object.keys(t);for(const s of e){if(!n.includes(s))return!1;const i=r[s],a=t[s];if(wu(i)&&wu(a)){if(!Gr(i,a))return!1}else if(i!==a)return!1}for(const s of n)if(!e.includes(s))return!1;return!0}function wu(r){return r!==null&&typeof r=="object"}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xt(r){return r&&r._delegate?r._delegate:r}class Kr{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const We="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pp{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const n=new op;if(this.instancesDeferred.set(e,n),this.isInitialized(e)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:e});s&&n.resolve(s)}catch{}}return this.instancesDeferred.get(e).promise}getImmediate(t){const e=this.normalizeInstanceIdentifier(t==null?void 0:t.identifier),n=(t==null?void 0:t.optional)??!1;if(this.isInitialized(e)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:e})}catch(s){if(n)return null;throw s}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(_p(t))try{this.getOrInitializeService({instanceIdentifier:We})}catch{}for(const[e,n]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(e);try{const i=this.getOrInitializeService({instanceIdentifier:s});n.resolve(i)}catch{}}}}clearInstance(t=We){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=We){return this.instances.has(t)}getOptions(t=We){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[i,a]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(i);n===c&&a.resolve(s)}return s}onInit(t,e){const n=this.normalizeInstanceIdentifier(e),s=this.onInitCallbacks.get(n)??new Set;s.add(t),this.onInitCallbacks.set(n,s);const i=this.instances.get(n);return i&&t(i,n),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const s of n)try{s(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:gp(t),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch{}return n||null}normalizeInstanceIdentifier(t=We){return this.component?this.component.multipleInstances?t:We:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function gp(r){return r===We?void 0:r}function _p(r){return r.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yp{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new pp(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var tt;(function(r){r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT"})(tt||(tt={}));const Ip={debug:tt.DEBUG,verbose:tt.VERBOSE,info:tt.INFO,warn:tt.WARN,error:tt.ERROR,silent:tt.SILENT},Ep=tt.INFO,vp={[tt.DEBUG]:"log",[tt.VERBOSE]:"log",[tt.INFO]:"info",[tt.WARN]:"warn",[tt.ERROR]:"error"},wp=(r,t,...e)=>{if(t<r.logLevel)return;const n=new Date().toISOString(),s=vp[t];if(s)console[s](`[${n}]  ${r.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class Ah{constructor(t){this.name=t,this._logLevel=Ep,this._logHandler=wp,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in tt))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?Ip[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,tt.DEBUG,...t),this._logHandler(this,tt.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,tt.VERBOSE,...t),this._logHandler(this,tt.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,tt.INFO,...t),this._logHandler(this,tt.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,tt.WARN,...t),this._logHandler(this,tt.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,tt.ERROR,...t),this._logHandler(this,tt.ERROR,...t)}}const Tp=(r,t)=>t.some(e=>r instanceof e);let Tu,Au;function Ap(){return Tu||(Tu=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function bp(){return Au||(Au=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const bh=new WeakMap,Bo=new WeakMap,Sh=new WeakMap,Ro=new WeakMap,va=new WeakMap;function Sp(r){const t=new Promise((e,n)=>{const s=()=>{r.removeEventListener("success",i),r.removeEventListener("error",a)},i=()=>{e(xe(r.result)),s()},a=()=>{n(r.error),s()};r.addEventListener("success",i),r.addEventListener("error",a)});return t.then(e=>{e instanceof IDBCursor&&bh.set(e,r)}).catch(()=>{}),va.set(t,r),t}function Rp(r){if(Bo.has(r))return;const t=new Promise((e,n)=>{const s=()=>{r.removeEventListener("complete",i),r.removeEventListener("error",a),r.removeEventListener("abort",a)},i=()=>{e(),s()},a=()=>{n(r.error||new DOMException("AbortError","AbortError")),s()};r.addEventListener("complete",i),r.addEventListener("error",a),r.addEventListener("abort",a)});Bo.set(r,t)}let Uo={get(r,t,e){if(r instanceof IDBTransaction){if(t==="done")return Bo.get(r);if(t==="objectStoreNames")return r.objectStoreNames||Sh.get(r);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return xe(r[t])},set(r,t,e){return r[t]=e,!0},has(r,t){return r instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in r}};function xp(r){Uo=r(Uo)}function Pp(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){const n=r.call(xo(this),t,...e);return Sh.set(n,t.sort?t.sort():[t]),xe(n)}:bp().includes(r)?function(...t){return r.apply(xo(this),t),xe(bh.get(this))}:function(...t){return xe(r.apply(xo(this),t))}}function Vp(r){return typeof r=="function"?Pp(r):(r instanceof IDBTransaction&&Rp(r),Tp(r,Ap())?new Proxy(r,Uo):r)}function xe(r){if(r instanceof IDBRequest)return Sp(r);if(Ro.has(r))return Ro.get(r);const t=Vp(r);return t!==r&&(Ro.set(r,t),va.set(t,r)),t}const xo=r=>va.get(r);function Cp(r,t,{blocked:e,upgrade:n,blocking:s,terminated:i}={}){const a=indexedDB.open(r,t),c=xe(a);return n&&a.addEventListener("upgradeneeded",u=>{n(xe(a.result),u.oldVersion,u.newVersion,xe(a.transaction),u)}),e&&a.addEventListener("blocked",u=>e(u.oldVersion,u.newVersion,u)),c.then(u=>{i&&u.addEventListener("close",()=>i()),s&&u.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),c}const Dp=["get","getKey","getAll","getAllKeys","count"],kp=["put","add","delete","clear"],Po=new Map;function bu(r,t){if(!(r instanceof IDBDatabase&&!(t in r)&&typeof t=="string"))return;if(Po.get(t))return Po.get(t);const e=t.replace(/FromIndex$/,""),n=t!==e,s=kp.includes(e);if(!(e in(n?IDBIndex:IDBObjectStore).prototype)||!(s||Dp.includes(e)))return;const i=async function(a,...c){const u=this.transaction(a,s?"readwrite":"readonly");let d=u.store;return n&&(d=d.index(c.shift())),(await Promise.all([d[e](...c),s&&u.done]))[0]};return Po.set(t,i),i}xp(r=>({...r,get:(t,e,n)=>bu(t,e)||r.get(t,e,n),has:(t,e)=>!!bu(t,e)||r.has(t,e)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Np{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(Mp(e)){const n=e.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(e=>e).join(" ")}}function Mp(r){const t=r.getComponent();return(t==null?void 0:t.type)==="VERSION"}const qo="@firebase/app",Su="0.14.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fe=new Ah("@firebase/app"),Op="@firebase/app-compat",Lp="@firebase/analytics-compat",Fp="@firebase/analytics",jp="@firebase/app-check-compat",Bp="@firebase/app-check",Up="@firebase/auth",qp="@firebase/auth-compat",zp="@firebase/database",$p="@firebase/data-connect",Gp="@firebase/database-compat",Kp="@firebase/functions",Hp="@firebase/functions-compat",Wp="@firebase/installations",Qp="@firebase/installations-compat",Xp="@firebase/messaging",Jp="@firebase/messaging-compat",Yp="@firebase/performance",Zp="@firebase/performance-compat",tg="@firebase/remote-config",eg="@firebase/remote-config-compat",ng="@firebase/storage",rg="@firebase/storage-compat",sg="@firebase/firestore",ig="@firebase/ai",og="@firebase/firestore-compat",ag="firebase",cg="12.0.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zo="[DEFAULT]",ug={[qo]:"fire-core",[Op]:"fire-core-compat",[Fp]:"fire-analytics",[Lp]:"fire-analytics-compat",[Bp]:"fire-app-check",[jp]:"fire-app-check-compat",[Up]:"fire-auth",[qp]:"fire-auth-compat",[zp]:"fire-rtdb",[$p]:"fire-data-connect",[Gp]:"fire-rtdb-compat",[Kp]:"fire-fn",[Hp]:"fire-fn-compat",[Wp]:"fire-iid",[Qp]:"fire-iid-compat",[Xp]:"fire-fcm",[Jp]:"fire-fcm-compat",[Yp]:"fire-perf",[Zp]:"fire-perf-compat",[tg]:"fire-rc",[eg]:"fire-rc-compat",[ng]:"fire-gcs",[rg]:"fire-gcs-compat",[sg]:"fire-fst",[og]:"fire-fst-compat",[ig]:"fire-vertex","fire-js":"fire-js",[ag]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ui=new Map,lg=new Map,$o=new Map;function Ru(r,t){try{r.container.addComponent(t)}catch(e){fe.debug(`Component ${t.name} failed to register with FirebaseApp ${r.name}`,e)}}function li(r){const t=r.name;if($o.has(t))return fe.debug(`There were multiple attempts to register component ${t}.`),!1;$o.set(t,r);for(const e of ui.values())Ru(e,r);for(const e of lg.values())Ru(e,r);return!0}function Rh(r,t){const e=r.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),r.container.getProvider(t)}function hg(r){return r==null?!1:r.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dg={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Pe=new Th("app","Firebase",dg);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fg{constructor(t,e,n){this._isDeleted=!1,this._options={...t},this._config={...e},this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Kr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Pe.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mg=cg;function xh(r,t={}){let e=r;typeof t!="object"&&(t={name:t});const n={name:zo,automaticDataCollectionEnabled:!0,...t},s=n.name;if(typeof s!="string"||!s)throw Pe.create("bad-app-name",{appName:String(s)});if(e||(e=_h()),!e)throw Pe.create("no-options");const i=ui.get(s);if(i){if(Gr(e,i.options)&&Gr(n,i.config))return i;throw Pe.create("duplicate-app",{appName:s})}const a=new yp(s);for(const u of $o.values())a.addComponent(u);const c=new fg(e,n,a);return ui.set(s,c),c}function pg(r=zo){const t=ui.get(r);if(!t&&r===zo&&_h())return xh();if(!t)throw Pe.create("no-app",{appName:r});return t}function Ln(r,t,e){let n=ug[r]??r;e&&(n+=`-${e}`);const s=n.match(/\s|\//),i=t.match(/\s|\//);if(s||i){const a=[`Unable to register library "${n}" with version "${t}":`];s&&a.push(`library name "${n}" contains illegal characters (whitespace or "/")`),s&&i&&a.push("and"),i&&a.push(`version name "${t}" contains illegal characters (whitespace or "/")`),fe.warn(a.join(" "));return}li(new Kr(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gg="firebase-heartbeat-database",_g=1,Hr="firebase-heartbeat-store";let Vo=null;function Ph(){return Vo||(Vo=Cp(gg,_g,{upgrade:(r,t)=>{switch(t){case 0:try{r.createObjectStore(Hr)}catch(e){console.warn(e)}}}}).catch(r=>{throw Pe.create("idb-open",{originalErrorMessage:r.message})})),Vo}async function yg(r){try{const e=(await Ph()).transaction(Hr),n=await e.objectStore(Hr).get(Vh(r));return await e.done,n}catch(t){if(t instanceof tr)fe.warn(t.message);else{const e=Pe.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});fe.warn(e.message)}}}async function xu(r,t){try{const n=(await Ph()).transaction(Hr,"readwrite");await n.objectStore(Hr).put(t,Vh(r)),await n.done}catch(e){if(e instanceof tr)fe.warn(e.message);else{const n=Pe.create("idb-set",{originalErrorMessage:e==null?void 0:e.message});fe.warn(n.message)}}}function Vh(r){return`${r.name}!${r.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ig=1024,Eg=30;class vg{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new Tg(e),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){var t,e;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Pu();if(((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(a=>a.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats.length>Eg){const a=Ag(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(n){fe.warn(n)}}async getHeartbeatsHeader(){var t;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=Pu(),{heartbeatsToSend:n,unsentEntries:s}=wg(this._heartbeatsCache.heartbeats),i=ai(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return fe.warn(e),""}}}function Pu(){return new Date().toISOString().substring(0,10)}function wg(r,t=Ig){const e=[];let n=r.slice();for(const s of r){const i=e.find(a=>a.agent===s.agent);if(i){if(i.dates.push(s.date),Vu(e)>t){i.dates.pop();break}}else if(e.push({agent:s.agent,dates:[s.date]}),Vu(e)>t){e.pop();break}n=n.slice(1)}return{heartbeatsToSend:e,unsentEntries:n}}class Tg{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return wh()?hp().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const e=await yg(this.app);return e!=null&&e.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){if(await this._canUseIndexedDBPromise){const n=await this.read();return xu(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){if(await this._canUseIndexedDBPromise){const n=await this.read();return xu(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}else return}}function Vu(r){return ai(JSON.stringify({version:2,heartbeats:r})).length}function Ag(r){if(r.length===0)return-1;let t=0,e=r[0].date;for(let n=1;n<r.length;n++)r[n].date<e&&(e=r[n].date,t=n);return t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bg(r){li(new Kr("platform-logger",t=>new Np(t),"PRIVATE")),li(new Kr("heartbeat",t=>new vg(t),"PRIVATE")),Ln(qo,Su,r),Ln(qo,Su,"esm2020"),Ln("fire-js","")}bg("");var Sg="firebase",Rg="12.0.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ln(Sg,Rg,"app");var Cu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Ve,Ch;(function(){var r;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function t(v,y){function I(){}I.prototype=y.prototype,v.D=y.prototype,v.prototype=new I,v.prototype.constructor=v,v.C=function(E,T,w){for(var _=Array(arguments.length-2),X=2;X<arguments.length;X++)_[X-2]=arguments[X];return y.prototype[T].apply(E,_)}}function e(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(n,e),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(v,y,I){I||(I=0);var E=Array(16);if(typeof y=="string")for(var T=0;16>T;++T)E[T]=y.charCodeAt(I++)|y.charCodeAt(I++)<<8|y.charCodeAt(I++)<<16|y.charCodeAt(I++)<<24;else for(T=0;16>T;++T)E[T]=y[I++]|y[I++]<<8|y[I++]<<16|y[I++]<<24;y=v.g[0],I=v.g[1],T=v.g[2];var w=v.g[3],_=y+(w^I&(T^w))+E[0]+3614090360&4294967295;y=I+(_<<7&4294967295|_>>>25),_=w+(T^y&(I^T))+E[1]+3905402710&4294967295,w=y+(_<<12&4294967295|_>>>20),_=T+(I^w&(y^I))+E[2]+606105819&4294967295,T=w+(_<<17&4294967295|_>>>15),_=I+(y^T&(w^y))+E[3]+3250441966&4294967295,I=T+(_<<22&4294967295|_>>>10),_=y+(w^I&(T^w))+E[4]+4118548399&4294967295,y=I+(_<<7&4294967295|_>>>25),_=w+(T^y&(I^T))+E[5]+1200080426&4294967295,w=y+(_<<12&4294967295|_>>>20),_=T+(I^w&(y^I))+E[6]+2821735955&4294967295,T=w+(_<<17&4294967295|_>>>15),_=I+(y^T&(w^y))+E[7]+4249261313&4294967295,I=T+(_<<22&4294967295|_>>>10),_=y+(w^I&(T^w))+E[8]+1770035416&4294967295,y=I+(_<<7&4294967295|_>>>25),_=w+(T^y&(I^T))+E[9]+2336552879&4294967295,w=y+(_<<12&4294967295|_>>>20),_=T+(I^w&(y^I))+E[10]+4294925233&4294967295,T=w+(_<<17&4294967295|_>>>15),_=I+(y^T&(w^y))+E[11]+2304563134&4294967295,I=T+(_<<22&4294967295|_>>>10),_=y+(w^I&(T^w))+E[12]+1804603682&4294967295,y=I+(_<<7&4294967295|_>>>25),_=w+(T^y&(I^T))+E[13]+4254626195&4294967295,w=y+(_<<12&4294967295|_>>>20),_=T+(I^w&(y^I))+E[14]+2792965006&4294967295,T=w+(_<<17&4294967295|_>>>15),_=I+(y^T&(w^y))+E[15]+1236535329&4294967295,I=T+(_<<22&4294967295|_>>>10),_=y+(T^w&(I^T))+E[1]+4129170786&4294967295,y=I+(_<<5&4294967295|_>>>27),_=w+(I^T&(y^I))+E[6]+3225465664&4294967295,w=y+(_<<9&4294967295|_>>>23),_=T+(y^I&(w^y))+E[11]+643717713&4294967295,T=w+(_<<14&4294967295|_>>>18),_=I+(w^y&(T^w))+E[0]+3921069994&4294967295,I=T+(_<<20&4294967295|_>>>12),_=y+(T^w&(I^T))+E[5]+3593408605&4294967295,y=I+(_<<5&4294967295|_>>>27),_=w+(I^T&(y^I))+E[10]+38016083&4294967295,w=y+(_<<9&4294967295|_>>>23),_=T+(y^I&(w^y))+E[15]+3634488961&4294967295,T=w+(_<<14&4294967295|_>>>18),_=I+(w^y&(T^w))+E[4]+3889429448&4294967295,I=T+(_<<20&4294967295|_>>>12),_=y+(T^w&(I^T))+E[9]+568446438&4294967295,y=I+(_<<5&4294967295|_>>>27),_=w+(I^T&(y^I))+E[14]+3275163606&4294967295,w=y+(_<<9&4294967295|_>>>23),_=T+(y^I&(w^y))+E[3]+4107603335&4294967295,T=w+(_<<14&4294967295|_>>>18),_=I+(w^y&(T^w))+E[8]+1163531501&4294967295,I=T+(_<<20&4294967295|_>>>12),_=y+(T^w&(I^T))+E[13]+2850285829&4294967295,y=I+(_<<5&4294967295|_>>>27),_=w+(I^T&(y^I))+E[2]+4243563512&4294967295,w=y+(_<<9&4294967295|_>>>23),_=T+(y^I&(w^y))+E[7]+1735328473&4294967295,T=w+(_<<14&4294967295|_>>>18),_=I+(w^y&(T^w))+E[12]+2368359562&4294967295,I=T+(_<<20&4294967295|_>>>12),_=y+(I^T^w)+E[5]+4294588738&4294967295,y=I+(_<<4&4294967295|_>>>28),_=w+(y^I^T)+E[8]+2272392833&4294967295,w=y+(_<<11&4294967295|_>>>21),_=T+(w^y^I)+E[11]+1839030562&4294967295,T=w+(_<<16&4294967295|_>>>16),_=I+(T^w^y)+E[14]+4259657740&4294967295,I=T+(_<<23&4294967295|_>>>9),_=y+(I^T^w)+E[1]+2763975236&4294967295,y=I+(_<<4&4294967295|_>>>28),_=w+(y^I^T)+E[4]+1272893353&4294967295,w=y+(_<<11&4294967295|_>>>21),_=T+(w^y^I)+E[7]+4139469664&4294967295,T=w+(_<<16&4294967295|_>>>16),_=I+(T^w^y)+E[10]+3200236656&4294967295,I=T+(_<<23&4294967295|_>>>9),_=y+(I^T^w)+E[13]+681279174&4294967295,y=I+(_<<4&4294967295|_>>>28),_=w+(y^I^T)+E[0]+3936430074&4294967295,w=y+(_<<11&4294967295|_>>>21),_=T+(w^y^I)+E[3]+3572445317&4294967295,T=w+(_<<16&4294967295|_>>>16),_=I+(T^w^y)+E[6]+76029189&4294967295,I=T+(_<<23&4294967295|_>>>9),_=y+(I^T^w)+E[9]+3654602809&4294967295,y=I+(_<<4&4294967295|_>>>28),_=w+(y^I^T)+E[12]+3873151461&4294967295,w=y+(_<<11&4294967295|_>>>21),_=T+(w^y^I)+E[15]+530742520&4294967295,T=w+(_<<16&4294967295|_>>>16),_=I+(T^w^y)+E[2]+3299628645&4294967295,I=T+(_<<23&4294967295|_>>>9),_=y+(T^(I|~w))+E[0]+4096336452&4294967295,y=I+(_<<6&4294967295|_>>>26),_=w+(I^(y|~T))+E[7]+1126891415&4294967295,w=y+(_<<10&4294967295|_>>>22),_=T+(y^(w|~I))+E[14]+2878612391&4294967295,T=w+(_<<15&4294967295|_>>>17),_=I+(w^(T|~y))+E[5]+4237533241&4294967295,I=T+(_<<21&4294967295|_>>>11),_=y+(T^(I|~w))+E[12]+1700485571&4294967295,y=I+(_<<6&4294967295|_>>>26),_=w+(I^(y|~T))+E[3]+2399980690&4294967295,w=y+(_<<10&4294967295|_>>>22),_=T+(y^(w|~I))+E[10]+4293915773&4294967295,T=w+(_<<15&4294967295|_>>>17),_=I+(w^(T|~y))+E[1]+2240044497&4294967295,I=T+(_<<21&4294967295|_>>>11),_=y+(T^(I|~w))+E[8]+1873313359&4294967295,y=I+(_<<6&4294967295|_>>>26),_=w+(I^(y|~T))+E[15]+4264355552&4294967295,w=y+(_<<10&4294967295|_>>>22),_=T+(y^(w|~I))+E[6]+2734768916&4294967295,T=w+(_<<15&4294967295|_>>>17),_=I+(w^(T|~y))+E[13]+1309151649&4294967295,I=T+(_<<21&4294967295|_>>>11),_=y+(T^(I|~w))+E[4]+4149444226&4294967295,y=I+(_<<6&4294967295|_>>>26),_=w+(I^(y|~T))+E[11]+3174756917&4294967295,w=y+(_<<10&4294967295|_>>>22),_=T+(y^(w|~I))+E[2]+718787259&4294967295,T=w+(_<<15&4294967295|_>>>17),_=I+(w^(T|~y))+E[9]+3951481745&4294967295,v.g[0]=v.g[0]+y&4294967295,v.g[1]=v.g[1]+(T+(_<<21&4294967295|_>>>11))&4294967295,v.g[2]=v.g[2]+T&4294967295,v.g[3]=v.g[3]+w&4294967295}n.prototype.u=function(v,y){y===void 0&&(y=v.length);for(var I=y-this.blockSize,E=this.B,T=this.h,w=0;w<y;){if(T==0)for(;w<=I;)s(this,v,w),w+=this.blockSize;if(typeof v=="string"){for(;w<y;)if(E[T++]=v.charCodeAt(w++),T==this.blockSize){s(this,E),T=0;break}}else for(;w<y;)if(E[T++]=v[w++],T==this.blockSize){s(this,E),T=0;break}}this.h=T,this.o+=y},n.prototype.v=function(){var v=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);v[0]=128;for(var y=1;y<v.length-8;++y)v[y]=0;var I=8*this.o;for(y=v.length-8;y<v.length;++y)v[y]=I&255,I/=256;for(this.u(v),v=Array(16),y=I=0;4>y;++y)for(var E=0;32>E;E+=8)v[I++]=this.g[y]>>>E&255;return v};function i(v,y){var I=c;return Object.prototype.hasOwnProperty.call(I,v)?I[v]:I[v]=y(v)}function a(v,y){this.h=y;for(var I=[],E=!0,T=v.length-1;0<=T;T--){var w=v[T]|0;E&&w==y||(I[T]=w,E=!1)}this.g=I}var c={};function u(v){return-128<=v&&128>v?i(v,function(y){return new a([y|0],0>y?-1:0)}):new a([v|0],0>v?-1:0)}function d(v){if(isNaN(v)||!isFinite(v))return p;if(0>v)return D(d(-v));for(var y=[],I=1,E=0;v>=I;E++)y[E]=v/I|0,I*=4294967296;return new a(y,0)}function f(v,y){if(v.length==0)throw Error("number format error: empty string");if(y=y||10,2>y||36<y)throw Error("radix out of range: "+y);if(v.charAt(0)=="-")return D(f(v.substring(1),y));if(0<=v.indexOf("-"))throw Error('number format error: interior "-" character');for(var I=d(Math.pow(y,8)),E=p,T=0;T<v.length;T+=8){var w=Math.min(8,v.length-T),_=parseInt(v.substring(T,T+w),y);8>w?(w=d(Math.pow(y,w)),E=E.j(w).add(d(_))):(E=E.j(I),E=E.add(d(_)))}return E}var p=u(0),g=u(1),S=u(16777216);r=a.prototype,r.m=function(){if(C(this))return-D(this).m();for(var v=0,y=1,I=0;I<this.g.length;I++){var E=this.i(I);v+=(0<=E?E:4294967296+E)*y,y*=4294967296}return v},r.toString=function(v){if(v=v||10,2>v||36<v)throw Error("radix out of range: "+v);if(V(this))return"0";if(C(this))return"-"+D(this).toString(v);for(var y=d(Math.pow(v,6)),I=this,E="";;){var T=j(I,y).g;I=z(I,T.j(y));var w=((0<I.g.length?I.g[0]:I.h)>>>0).toString(v);if(I=T,V(I))return w+E;for(;6>w.length;)w="0"+w;E=w+E}},r.i=function(v){return 0>v?0:v<this.g.length?this.g[v]:this.h};function V(v){if(v.h!=0)return!1;for(var y=0;y<v.g.length;y++)if(v.g[y]!=0)return!1;return!0}function C(v){return v.h==-1}r.l=function(v){return v=z(this,v),C(v)?-1:V(v)?0:1};function D(v){for(var y=v.g.length,I=[],E=0;E<y;E++)I[E]=~v.g[E];return new a(I,~v.h).add(g)}r.abs=function(){return C(this)?D(this):this},r.add=function(v){for(var y=Math.max(this.g.length,v.g.length),I=[],E=0,T=0;T<=y;T++){var w=E+(this.i(T)&65535)+(v.i(T)&65535),_=(w>>>16)+(this.i(T)>>>16)+(v.i(T)>>>16);E=_>>>16,w&=65535,_&=65535,I[T]=_<<16|w}return new a(I,I[I.length-1]&-2147483648?-1:0)};function z(v,y){return v.add(D(y))}r.j=function(v){if(V(this)||V(v))return p;if(C(this))return C(v)?D(this).j(D(v)):D(D(this).j(v));if(C(v))return D(this.j(D(v)));if(0>this.l(S)&&0>v.l(S))return d(this.m()*v.m());for(var y=this.g.length+v.g.length,I=[],E=0;E<2*y;E++)I[E]=0;for(E=0;E<this.g.length;E++)for(var T=0;T<v.g.length;T++){var w=this.i(E)>>>16,_=this.i(E)&65535,X=v.i(T)>>>16,vt=v.i(T)&65535;I[2*E+2*T]+=_*vt,B(I,2*E+2*T),I[2*E+2*T+1]+=w*vt,B(I,2*E+2*T+1),I[2*E+2*T+1]+=_*X,B(I,2*E+2*T+1),I[2*E+2*T+2]+=w*X,B(I,2*E+2*T+2)}for(E=0;E<y;E++)I[E]=I[2*E+1]<<16|I[2*E];for(E=y;E<2*y;E++)I[E]=0;return new a(I,0)};function B(v,y){for(;(v[y]&65535)!=v[y];)v[y+1]+=v[y]>>>16,v[y]&=65535,y++}function L(v,y){this.g=v,this.h=y}function j(v,y){if(V(y))throw Error("division by zero");if(V(v))return new L(p,p);if(C(v))return y=j(D(v),y),new L(D(y.g),D(y.h));if(C(y))return y=j(v,D(y)),new L(D(y.g),y.h);if(30<v.g.length){if(C(v)||C(y))throw Error("slowDivide_ only works with positive integers.");for(var I=g,E=y;0>=E.l(v);)I=$(I),E=$(E);var T=H(I,1),w=H(E,1);for(E=H(E,2),I=H(I,2);!V(E);){var _=w.add(E);0>=_.l(v)&&(T=T.add(I),w=_),E=H(E,1),I=H(I,1)}return y=z(v,T.j(y)),new L(T,y)}for(T=p;0<=v.l(y);){for(I=Math.max(1,Math.floor(v.m()/y.m())),E=Math.ceil(Math.log(I)/Math.LN2),E=48>=E?1:Math.pow(2,E-48),w=d(I),_=w.j(y);C(_)||0<_.l(v);)I-=E,w=d(I),_=w.j(y);V(w)&&(w=g),T=T.add(w),v=z(v,_)}return new L(T,v)}r.A=function(v){return j(this,v).h},r.and=function(v){for(var y=Math.max(this.g.length,v.g.length),I=[],E=0;E<y;E++)I[E]=this.i(E)&v.i(E);return new a(I,this.h&v.h)},r.or=function(v){for(var y=Math.max(this.g.length,v.g.length),I=[],E=0;E<y;E++)I[E]=this.i(E)|v.i(E);return new a(I,this.h|v.h)},r.xor=function(v){for(var y=Math.max(this.g.length,v.g.length),I=[],E=0;E<y;E++)I[E]=this.i(E)^v.i(E);return new a(I,this.h^v.h)};function $(v){for(var y=v.g.length+1,I=[],E=0;E<y;E++)I[E]=v.i(E)<<1|v.i(E-1)>>>31;return new a(I,v.h)}function H(v,y){var I=y>>5;y%=32;for(var E=v.g.length-I,T=[],w=0;w<E;w++)T[w]=0<y?v.i(w+I)>>>y|v.i(w+I+1)<<32-y:v.i(w+I);return new a(T,v.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,Ch=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=f,Ve=a}).apply(typeof Cu<"u"?Cu:typeof self<"u"?self:typeof window<"u"?window:{});var qs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Dh,Pr,kh,Qs,Go,Nh,Mh,Oh;(function(){var r,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(o,l,h){return o==Array.prototype||o==Object.prototype||(o[l]=h.value),o};function e(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof qs=="object"&&qs];for(var l=0;l<o.length;++l){var h=o[l];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var n=e(this);function s(o,l){if(l)t:{var h=n;o=o.split(".");for(var m=0;m<o.length-1;m++){var R=o[m];if(!(R in h))break t;h=h[R]}o=o[o.length-1],m=h[o],l=l(m),l!=m&&l!=null&&t(h,o,{configurable:!0,writable:!0,value:l})}}function i(o,l){o instanceof String&&(o+="");var h=0,m=!1,R={next:function(){if(!m&&h<o.length){var x=h++;return{value:l(x,o[x]),done:!1}}return m=!0,{done:!0,value:void 0}}};return R[Symbol.iterator]=function(){return R},R}s("Array.prototype.values",function(o){return o||function(){return i(this,function(l,h){return h})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var a=a||{},c=this||self;function u(o){var l=typeof o;return l=l!="object"?l:o?Array.isArray(o)?"array":l:"null",l=="array"||l=="object"&&typeof o.length=="number"}function d(o){var l=typeof o;return l=="object"&&o!=null||l=="function"}function f(o,l,h){return o.call.apply(o.bind,arguments)}function p(o,l,h){if(!o)throw Error();if(2<arguments.length){var m=Array.prototype.slice.call(arguments,2);return function(){var R=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(R,m),o.apply(l,R)}}return function(){return o.apply(l,arguments)}}function g(o,l,h){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:p,g.apply(null,arguments)}function S(o,l){var h=Array.prototype.slice.call(arguments,1);return function(){var m=h.slice();return m.push.apply(m,arguments),o.apply(this,m)}}function V(o,l){function h(){}h.prototype=l.prototype,o.aa=l.prototype,o.prototype=new h,o.prototype.constructor=o,o.Qb=function(m,R,x){for(var M=Array(arguments.length-2),ot=2;ot<arguments.length;ot++)M[ot-2]=arguments[ot];return l.prototype[R].apply(m,M)}}function C(o){const l=o.length;if(0<l){const h=Array(l);for(let m=0;m<l;m++)h[m]=o[m];return h}return[]}function D(o,l){for(let h=1;h<arguments.length;h++){const m=arguments[h];if(u(m)){const R=o.length||0,x=m.length||0;o.length=R+x;for(let M=0;M<x;M++)o[R+M]=m[M]}else o.push(m)}}class z{constructor(l,h){this.i=l,this.j=h,this.h=0,this.g=null}get(){let l;return 0<this.h?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}function B(o){return/^[\s\xa0]*$/.test(o)}function L(){var o=c.navigator;return o&&(o=o.userAgent)?o:""}function j(o){return j[" "](o),o}j[" "]=function(){};var $=L().indexOf("Gecko")!=-1&&!(L().toLowerCase().indexOf("webkit")!=-1&&L().indexOf("Edge")==-1)&&!(L().indexOf("Trident")!=-1||L().indexOf("MSIE")!=-1)&&L().indexOf("Edge")==-1;function H(o,l,h){for(const m in o)l.call(h,o[m],m,o)}function v(o,l){for(const h in o)l.call(void 0,o[h],h,o)}function y(o){const l={};for(const h in o)l[h]=o[h];return l}const I="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(o,l){let h,m;for(let R=1;R<arguments.length;R++){m=arguments[R];for(h in m)o[h]=m[h];for(let x=0;x<I.length;x++)h=I[x],Object.prototype.hasOwnProperty.call(m,h)&&(o[h]=m[h])}}function T(o){var l=1;o=o.split(":");const h=[];for(;0<l&&o.length;)h.push(o.shift()),l--;return o.length&&h.push(o.join(":")),h}function w(o){c.setTimeout(()=>{throw o},0)}function _(){var o=K;let l=null;return o.g&&(l=o.g,o.g=o.g.next,o.g||(o.h=null),l.next=null),l}class X{constructor(){this.h=this.g=null}add(l,h){const m=vt.get();m.set(l,h),this.h?this.h.next=m:this.g=m,this.h=m}}var vt=new z(()=>new or,o=>o.reset());class or{constructor(){this.next=this.g=this.h=null}set(l,h){this.h=l,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let ye,Ue=!1,K=new X,Nt=()=>{const o=c.Promise.resolve(void 0);ye=()=>{o.then(ft)}};var ft=()=>{for(var o;o=_();){try{o.h.call(o.g)}catch(h){w(h)}var l=vt;l.j(o),100>l.h&&(l.h++,o.next=l.g,l.g=o)}Ue=!1};function Bt(){this.s=this.s,this.C=this.C}Bt.prototype.s=!1,Bt.prototype.ma=function(){this.s||(this.s=!0,this.N())},Bt.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function mt(o,l){this.type=o,this.g=this.target=l,this.defaultPrevented=!1}mt.prototype.h=function(){this.defaultPrevented=!0};var ar=function(){if(!c.addEventListener||!Object.defineProperty)return!1;var o=!1,l=Object.defineProperty({},"passive",{get:function(){o=!0}});try{const h=()=>{};c.addEventListener("test",h,l),c.removeEventListener("test",h,l)}catch{}return o}();function qe(o,l){if(mt.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var h=this.type=o.type,m=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=l,l=o.relatedTarget){if($){t:{try{j(l.nodeName);var R=!0;break t}catch{}R=!1}R||(l=null)}}else h=="mouseover"?l=o.fromElement:h=="mouseout"&&(l=o.toElement);this.relatedTarget=l,m?(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=typeof o.pointerType=="string"?o.pointerType:om[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&qe.aa.h.call(this)}}V(qe,mt);var om={2:"touch",3:"pen",4:"mouse"};qe.prototype.h=function(){qe.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var ws="closure_listenable_"+(1e6*Math.random()|0),am=0;function cm(o,l,h,m,R){this.listener=o,this.proxy=null,this.src=l,this.type=h,this.capture=!!m,this.ha=R,this.key=++am,this.da=this.fa=!1}function Ts(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function As(o){this.src=o,this.g={},this.h=0}As.prototype.add=function(o,l,h,m,R){var x=o.toString();o=this.g[x],o||(o=this.g[x]=[],this.h++);var M=ro(o,l,m,R);return-1<M?(l=o[M],h||(l.fa=!1)):(l=new cm(l,this.src,x,!!m,R),l.fa=h,o.push(l)),l};function no(o,l){var h=l.type;if(h in o.g){var m=o.g[h],R=Array.prototype.indexOf.call(m,l,void 0),x;(x=0<=R)&&Array.prototype.splice.call(m,R,1),x&&(Ts(l),o.g[h].length==0&&(delete o.g[h],o.h--))}}function ro(o,l,h,m){for(var R=0;R<o.length;++R){var x=o[R];if(!x.da&&x.listener==l&&x.capture==!!h&&x.ha==m)return R}return-1}var so="closure_lm_"+(1e6*Math.random()|0),io={};function _c(o,l,h,m,R){if(Array.isArray(l)){for(var x=0;x<l.length;x++)_c(o,l[x],h,m,R);return null}return h=Ec(h),o&&o[ws]?o.K(l,h,d(m)?!!m.capture:!1,R):um(o,l,h,!1,m,R)}function um(o,l,h,m,R,x){if(!l)throw Error("Invalid event type");var M=d(R)?!!R.capture:!!R,ot=ao(o);if(ot||(o[so]=ot=new As(o)),h=ot.add(l,h,m,M,x),h.proxy)return h;if(m=lm(),h.proxy=m,m.src=o,m.listener=h,o.addEventListener)ar||(R=M),R===void 0&&(R=!1),o.addEventListener(l.toString(),m,R);else if(o.attachEvent)o.attachEvent(Ic(l.toString()),m);else if(o.addListener&&o.removeListener)o.addListener(m);else throw Error("addEventListener and attachEvent are unavailable.");return h}function lm(){function o(h){return l.call(o.src,o.listener,h)}const l=hm;return o}function yc(o,l,h,m,R){if(Array.isArray(l))for(var x=0;x<l.length;x++)yc(o,l[x],h,m,R);else m=d(m)?!!m.capture:!!m,h=Ec(h),o&&o[ws]?(o=o.i,l=String(l).toString(),l in o.g&&(x=o.g[l],h=ro(x,h,m,R),-1<h&&(Ts(x[h]),Array.prototype.splice.call(x,h,1),x.length==0&&(delete o.g[l],o.h--)))):o&&(o=ao(o))&&(l=o.g[l.toString()],o=-1,l&&(o=ro(l,h,m,R)),(h=-1<o?l[o]:null)&&oo(h))}function oo(o){if(typeof o!="number"&&o&&!o.da){var l=o.src;if(l&&l[ws])no(l.i,o);else{var h=o.type,m=o.proxy;l.removeEventListener?l.removeEventListener(h,m,o.capture):l.detachEvent?l.detachEvent(Ic(h),m):l.addListener&&l.removeListener&&l.removeListener(m),(h=ao(l))?(no(h,o),h.h==0&&(h.src=null,l[so]=null)):Ts(o)}}}function Ic(o){return o in io?io[o]:io[o]="on"+o}function hm(o,l){if(o.da)o=!0;else{l=new qe(l,this);var h=o.listener,m=o.ha||o.src;o.fa&&oo(o),o=h.call(m,l)}return o}function ao(o){return o=o[so],o instanceof As?o:null}var co="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ec(o){return typeof o=="function"?o:(o[co]||(o[co]=function(l){return o.handleEvent(l)}),o[co])}function Rt(){Bt.call(this),this.i=new As(this),this.M=this,this.F=null}V(Rt,Bt),Rt.prototype[ws]=!0,Rt.prototype.removeEventListener=function(o,l,h,m){yc(this,o,l,h,m)};function Mt(o,l){var h,m=o.F;if(m)for(h=[];m;m=m.F)h.push(m);if(o=o.M,m=l.type||l,typeof l=="string")l=new mt(l,o);else if(l instanceof mt)l.target=l.target||o;else{var R=l;l=new mt(m,o),E(l,R)}if(R=!0,h)for(var x=h.length-1;0<=x;x--){var M=l.g=h[x];R=bs(M,m,!0,l)&&R}if(M=l.g=o,R=bs(M,m,!0,l)&&R,R=bs(M,m,!1,l)&&R,h)for(x=0;x<h.length;x++)M=l.g=h[x],R=bs(M,m,!1,l)&&R}Rt.prototype.N=function(){if(Rt.aa.N.call(this),this.i){var o=this.i,l;for(l in o.g){for(var h=o.g[l],m=0;m<h.length;m++)Ts(h[m]);delete o.g[l],o.h--}}this.F=null},Rt.prototype.K=function(o,l,h,m){return this.i.add(String(o),l,!1,h,m)},Rt.prototype.L=function(o,l,h,m){return this.i.add(String(o),l,!0,h,m)};function bs(o,l,h,m){if(l=o.i.g[String(l)],!l)return!0;l=l.concat();for(var R=!0,x=0;x<l.length;++x){var M=l[x];if(M&&!M.da&&M.capture==h){var ot=M.listener,At=M.ha||M.src;M.fa&&no(o.i,M),R=ot.call(At,m)!==!1&&R}}return R&&!m.defaultPrevented}function vc(o,l,h){if(typeof o=="function")h&&(o=g(o,h));else if(o&&typeof o.handleEvent=="function")o=g(o.handleEvent,o);else throw Error("Invalid listener argument");return 2147483647<Number(l)?-1:c.setTimeout(o,l||0)}function wc(o){o.g=vc(()=>{o.g=null,o.i&&(o.i=!1,wc(o))},o.l);const l=o.h;o.h=null,o.m.apply(null,l)}class dm extends Bt{constructor(l,h){super(),this.m=l,this.l=h,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:wc(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function cr(o){Bt.call(this),this.h=o,this.g={}}V(cr,Bt);var Tc=[];function Ac(o){H(o.g,function(l,h){this.g.hasOwnProperty(h)&&oo(l)},o),o.g={}}cr.prototype.N=function(){cr.aa.N.call(this),Ac(this)},cr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var uo=c.JSON.stringify,fm=c.JSON.parse,mm=class{stringify(o){return c.JSON.stringify(o,void 0)}parse(o){return c.JSON.parse(o,void 0)}};function lo(){}lo.prototype.h=null;function bc(o){return o.h||(o.h=o.i())}function Sc(){}var ur={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ho(){mt.call(this,"d")}V(ho,mt);function fo(){mt.call(this,"c")}V(fo,mt);var ze={},Rc=null;function Ss(){return Rc=Rc||new Rt}ze.La="serverreachability";function xc(o){mt.call(this,ze.La,o)}V(xc,mt);function lr(o){const l=Ss();Mt(l,new xc(l))}ze.STAT_EVENT="statevent";function Pc(o,l){mt.call(this,ze.STAT_EVENT,o),this.stat=l}V(Pc,mt);function Ot(o){const l=Ss();Mt(l,new Pc(l,o))}ze.Ma="timingevent";function Vc(o,l){mt.call(this,ze.Ma,o),this.size=l}V(Vc,mt);function hr(o,l){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){o()},l)}function dr(){this.g=!0}dr.prototype.xa=function(){this.g=!1};function pm(o,l,h,m,R,x){o.info(function(){if(o.g)if(x)for(var M="",ot=x.split("&"),At=0;At<ot.length;At++){var et=ot[At].split("=");if(1<et.length){var xt=et[0];et=et[1];var Pt=xt.split("_");M=2<=Pt.length&&Pt[1]=="type"?M+(xt+"="+et+"&"):M+(xt+"=redacted&")}}else M=null;else M=x;return"XMLHTTP REQ ("+m+") [attempt "+R+"]: "+l+`
`+h+`
`+M})}function gm(o,l,h,m,R,x,M){o.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+R+"]: "+l+`
`+h+`
`+x+" "+M})}function vn(o,l,h,m){o.info(function(){return"XMLHTTP TEXT ("+l+"): "+ym(o,h)+(m?" "+m:"")})}function _m(o,l){o.info(function(){return"TIMEOUT: "+l})}dr.prototype.info=function(){};function ym(o,l){if(!o.g)return l;if(!l)return null;try{var h=JSON.parse(l);if(h){for(o=0;o<h.length;o++)if(Array.isArray(h[o])){var m=h[o];if(!(2>m.length)){var R=m[1];if(Array.isArray(R)&&!(1>R.length)){var x=R[0];if(x!="noop"&&x!="stop"&&x!="close")for(var M=1;M<R.length;M++)R[M]=""}}}}return uo(h)}catch{return l}}var Rs={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Cc={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},mo;function xs(){}V(xs,lo),xs.prototype.g=function(){return new XMLHttpRequest},xs.prototype.i=function(){return{}},mo=new xs;function Ie(o,l,h,m){this.j=o,this.i=l,this.l=h,this.R=m||1,this.U=new cr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Dc}function Dc(){this.i=null,this.g="",this.h=!1}var kc={},po={};function go(o,l,h){o.L=1,o.v=Ds(ue(l)),o.m=h,o.P=!0,Nc(o,null)}function Nc(o,l){o.F=Date.now(),Ps(o),o.A=ue(o.v);var h=o.A,m=o.R;Array.isArray(m)||(m=[String(m)]),Wc(h.i,"t",m),o.C=0,h=o.j.J,o.h=new Dc,o.g=du(o.j,h?l:null,!o.m),0<o.O&&(o.M=new dm(g(o.Y,o,o.g),o.O)),l=o.U,h=o.g,m=o.ca;var R="readystatechange";Array.isArray(R)||(R&&(Tc[0]=R.toString()),R=Tc);for(var x=0;x<R.length;x++){var M=_c(h,R[x],m||l.handleEvent,!1,l.h||l);if(!M)break;l.g[M.key]=M}l=o.H?y(o.H):{},o.m?(o.u||(o.u="POST"),l["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,l)):(o.u="GET",o.g.ea(o.A,o.u,null,l)),lr(),pm(o.i,o.u,o.A,o.l,o.R,o.m)}Ie.prototype.ca=function(o){o=o.target;const l=this.M;l&&le(o)==3?l.j():this.Y(o)},Ie.prototype.Y=function(o){try{if(o==this.g)t:{const Pt=le(this.g);var l=this.g.Ba();const An=this.g.Z();if(!(3>Pt)&&(Pt!=3||this.g&&(this.h.h||this.g.oa()||eu(this.g)))){this.J||Pt!=4||l==7||(l==8||0>=An?lr(3):lr(2)),_o(this);var h=this.g.Z();this.X=h;e:if(Mc(this)){var m=eu(this.g);o="";var R=m.length,x=le(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){$e(this),fr(this);var M="";break e}this.h.i=new c.TextDecoder}for(l=0;l<R;l++)this.h.h=!0,o+=this.h.i.decode(m[l],{stream:!(x&&l==R-1)});m.length=0,this.h.g+=o,this.C=0,M=this.h.g}else M=this.g.oa();if(this.o=h==200,gm(this.i,this.u,this.A,this.l,this.R,Pt,h),this.o){if(this.T&&!this.K){e:{if(this.g){var ot,At=this.g;if((ot=At.g?At.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!B(ot)){var et=ot;break e}}et=null}if(h=et)vn(this.i,this.l,h,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,yo(this,h);else{this.o=!1,this.s=3,Ot(12),$e(this),fr(this);break t}}if(this.P){h=!0;let Jt;for(;!this.J&&this.C<M.length;)if(Jt=Im(this,M),Jt==po){Pt==4&&(this.s=4,Ot(14),h=!1),vn(this.i,this.l,null,"[Incomplete Response]");break}else if(Jt==kc){this.s=4,Ot(15),vn(this.i,this.l,M,"[Invalid Chunk]"),h=!1;break}else vn(this.i,this.l,Jt,null),yo(this,Jt);if(Mc(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Pt!=4||M.length!=0||this.h.h||(this.s=1,Ot(16),h=!1),this.o=this.o&&h,!h)vn(this.i,this.l,M,"[Invalid Chunked Response]"),$e(this),fr(this);else if(0<M.length&&!this.W){this.W=!0;var xt=this.j;xt.g==this&&xt.ba&&!xt.M&&(xt.j.info("Great, no buffering proxy detected. Bytes received: "+M.length),Ao(xt),xt.M=!0,Ot(11))}}else vn(this.i,this.l,M,null),yo(this,M);Pt==4&&$e(this),this.o&&!this.J&&(Pt==4?cu(this.j,this):(this.o=!1,Ps(this)))}else Om(this.g),h==400&&0<M.indexOf("Unknown SID")?(this.s=3,Ot(12)):(this.s=0,Ot(13)),$e(this),fr(this)}}}catch{}finally{}};function Mc(o){return o.g?o.u=="GET"&&o.L!=2&&o.j.Ca:!1}function Im(o,l){var h=o.C,m=l.indexOf(`
`,h);return m==-1?po:(h=Number(l.substring(h,m)),isNaN(h)?kc:(m+=1,m+h>l.length?po:(l=l.slice(m,m+h),o.C=m+h,l)))}Ie.prototype.cancel=function(){this.J=!0,$e(this)};function Ps(o){o.S=Date.now()+o.I,Oc(o,o.I)}function Oc(o,l){if(o.B!=null)throw Error("WatchDog timer not null");o.B=hr(g(o.ba,o),l)}function _o(o){o.B&&(c.clearTimeout(o.B),o.B=null)}Ie.prototype.ba=function(){this.B=null;const o=Date.now();0<=o-this.S?(_m(this.i,this.A),this.L!=2&&(lr(),Ot(17)),$e(this),this.s=2,fr(this)):Oc(this,this.S-o)};function fr(o){o.j.G==0||o.J||cu(o.j,o)}function $e(o){_o(o);var l=o.M;l&&typeof l.ma=="function"&&l.ma(),o.M=null,Ac(o.U),o.g&&(l=o.g,o.g=null,l.abort(),l.ma())}function yo(o,l){try{var h=o.j;if(h.G!=0&&(h.g==o||Io(h.h,o))){if(!o.K&&Io(h.h,o)&&h.G==3){try{var m=h.Da.g.parse(l)}catch{m=null}if(Array.isArray(m)&&m.length==3){var R=m;if(R[0]==0){t:if(!h.u){if(h.g)if(h.g.F+3e3<o.F)Fs(h),Os(h);else break t;To(h),Ot(18)}}else h.za=R[1],0<h.za-h.T&&37500>R[2]&&h.F&&h.v==0&&!h.C&&(h.C=hr(g(h.Za,h),6e3));if(1>=jc(h.h)&&h.ca){try{h.ca()}catch{}h.ca=void 0}}else Ke(h,11)}else if((o.K||h.g==o)&&Fs(h),!B(l))for(R=h.Da.g.parse(l),l=0;l<R.length;l++){let et=R[l];if(h.T=et[0],et=et[1],h.G==2)if(et[0]=="c"){h.K=et[1],h.ia=et[2];const xt=et[3];xt!=null&&(h.la=xt,h.j.info("VER="+h.la));const Pt=et[4];Pt!=null&&(h.Aa=Pt,h.j.info("SVER="+h.Aa));const An=et[5];An!=null&&typeof An=="number"&&0<An&&(m=1.5*An,h.L=m,h.j.info("backChannelRequestTimeoutMs_="+m)),m=h;const Jt=o.g;if(Jt){const Bs=Jt.g?Jt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Bs){var x=m.h;x.g||Bs.indexOf("spdy")==-1&&Bs.indexOf("quic")==-1&&Bs.indexOf("h2")==-1||(x.j=x.l,x.g=new Set,x.h&&(Eo(x,x.h),x.h=null))}if(m.D){const bo=Jt.g?Jt.g.getResponseHeader("X-HTTP-Session-Id"):null;bo&&(m.ya=bo,at(m.I,m.D,bo))}}h.G=3,h.l&&h.l.ua(),h.ba&&(h.R=Date.now()-o.F,h.j.info("Handshake RTT: "+h.R+"ms")),m=h;var M=o;if(m.qa=hu(m,m.J?m.ia:null,m.W),M.K){Bc(m.h,M);var ot=M,At=m.L;At&&(ot.I=At),ot.B&&(_o(ot),Ps(ot)),m.g=M}else ou(m);0<h.i.length&&Ls(h)}else et[0]!="stop"&&et[0]!="close"||Ke(h,7);else h.G==3&&(et[0]=="stop"||et[0]=="close"?et[0]=="stop"?Ke(h,7):wo(h):et[0]!="noop"&&h.l&&h.l.ta(et),h.v=0)}}lr(4)}catch{}}var Em=class{constructor(o,l){this.g=o,this.map=l}};function Lc(o){this.l=o||10,c.PerformanceNavigationTiming?(o=c.performance.getEntriesByType("navigation"),o=0<o.length&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Fc(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function jc(o){return o.h?1:o.g?o.g.size:0}function Io(o,l){return o.h?o.h==l:o.g?o.g.has(l):!1}function Eo(o,l){o.g?o.g.add(l):o.h=l}function Bc(o,l){o.h&&o.h==l?o.h=null:o.g&&o.g.has(l)&&o.g.delete(l)}Lc.prototype.cancel=function(){if(this.i=Uc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const o of this.g.values())o.cancel();this.g.clear()}};function Uc(o){if(o.h!=null)return o.i.concat(o.h.D);if(o.g!=null&&o.g.size!==0){let l=o.i;for(const h of o.g.values())l=l.concat(h.D);return l}return C(o.i)}function vm(o){if(o.V&&typeof o.V=="function")return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if(typeof o=="string")return o.split("");if(u(o)){for(var l=[],h=o.length,m=0;m<h;m++)l.push(o[m]);return l}l=[],h=0;for(m in o)l[h++]=o[m];return l}function wm(o){if(o.na&&typeof o.na=="function")return o.na();if(!o.V||typeof o.V!="function"){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(u(o)||typeof o=="string"){var l=[];o=o.length;for(var h=0;h<o;h++)l.push(h);return l}l=[],h=0;for(const m in o)l[h++]=m;return l}}}function qc(o,l){if(o.forEach&&typeof o.forEach=="function")o.forEach(l,void 0);else if(u(o)||typeof o=="string")Array.prototype.forEach.call(o,l,void 0);else for(var h=wm(o),m=vm(o),R=m.length,x=0;x<R;x++)l.call(void 0,m[x],h&&h[x],o)}var zc=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Tm(o,l){if(o){o=o.split("&");for(var h=0;h<o.length;h++){var m=o[h].indexOf("="),R=null;if(0<=m){var x=o[h].substring(0,m);R=o[h].substring(m+1)}else x=o[h];l(x,R?decodeURIComponent(R.replace(/\+/g," ")):"")}}}function Ge(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof Ge){this.h=o.h,Vs(this,o.j),this.o=o.o,this.g=o.g,Cs(this,o.s),this.l=o.l;var l=o.i,h=new gr;h.i=l.i,l.g&&(h.g=new Map(l.g),h.h=l.h),$c(this,h),this.m=o.m}else o&&(l=String(o).match(zc))?(this.h=!1,Vs(this,l[1]||"",!0),this.o=mr(l[2]||""),this.g=mr(l[3]||"",!0),Cs(this,l[4]),this.l=mr(l[5]||"",!0),$c(this,l[6]||"",!0),this.m=mr(l[7]||"")):(this.h=!1,this.i=new gr(null,this.h))}Ge.prototype.toString=function(){var o=[],l=this.j;l&&o.push(pr(l,Gc,!0),":");var h=this.g;return(h||l=="file")&&(o.push("//"),(l=this.o)&&o.push(pr(l,Gc,!0),"@"),o.push(encodeURIComponent(String(h)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.s,h!=null&&o.push(":",String(h))),(h=this.l)&&(this.g&&h.charAt(0)!="/"&&o.push("/"),o.push(pr(h,h.charAt(0)=="/"?Sm:bm,!0))),(h=this.i.toString())&&o.push("?",h),(h=this.m)&&o.push("#",pr(h,xm)),o.join("")};function ue(o){return new Ge(o)}function Vs(o,l,h){o.j=h?mr(l,!0):l,o.j&&(o.j=o.j.replace(/:$/,""))}function Cs(o,l){if(l){if(l=Number(l),isNaN(l)||0>l)throw Error("Bad port number "+l);o.s=l}else o.s=null}function $c(o,l,h){l instanceof gr?(o.i=l,Pm(o.i,o.h)):(h||(l=pr(l,Rm)),o.i=new gr(l,o.h))}function at(o,l,h){o.i.set(l,h)}function Ds(o){return at(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function mr(o,l){return o?l?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function pr(o,l,h){return typeof o=="string"?(o=encodeURI(o).replace(l,Am),h&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function Am(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var Gc=/[#\/\?@]/g,bm=/[#\?:]/g,Sm=/[#\?]/g,Rm=/[#\?@]/g,xm=/#/g;function gr(o,l){this.h=this.g=null,this.i=o||null,this.j=!!l}function Ee(o){o.g||(o.g=new Map,o.h=0,o.i&&Tm(o.i,function(l,h){o.add(decodeURIComponent(l.replace(/\+/g," ")),h)}))}r=gr.prototype,r.add=function(o,l){Ee(this),this.i=null,o=wn(this,o);var h=this.g.get(o);return h||this.g.set(o,h=[]),h.push(l),this.h+=1,this};function Kc(o,l){Ee(o),l=wn(o,l),o.g.has(l)&&(o.i=null,o.h-=o.g.get(l).length,o.g.delete(l))}function Hc(o,l){return Ee(o),l=wn(o,l),o.g.has(l)}r.forEach=function(o,l){Ee(this),this.g.forEach(function(h,m){h.forEach(function(R){o.call(l,R,m,this)},this)},this)},r.na=function(){Ee(this);const o=Array.from(this.g.values()),l=Array.from(this.g.keys()),h=[];for(let m=0;m<l.length;m++){const R=o[m];for(let x=0;x<R.length;x++)h.push(l[m])}return h},r.V=function(o){Ee(this);let l=[];if(typeof o=="string")Hc(this,o)&&(l=l.concat(this.g.get(wn(this,o))));else{o=Array.from(this.g.values());for(let h=0;h<o.length;h++)l=l.concat(o[h])}return l},r.set=function(o,l){return Ee(this),this.i=null,o=wn(this,o),Hc(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[l]),this.h+=1,this},r.get=function(o,l){return o?(o=this.V(o),0<o.length?String(o[0]):l):l};function Wc(o,l,h){Kc(o,l),0<h.length&&(o.i=null,o.g.set(wn(o,l),C(h)),o.h+=h.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const o=[],l=Array.from(this.g.keys());for(var h=0;h<l.length;h++){var m=l[h];const x=encodeURIComponent(String(m)),M=this.V(m);for(m=0;m<M.length;m++){var R=x;M[m]!==""&&(R+="="+encodeURIComponent(String(M[m]))),o.push(R)}}return this.i=o.join("&")};function wn(o,l){return l=String(l),o.j&&(l=l.toLowerCase()),l}function Pm(o,l){l&&!o.j&&(Ee(o),o.i=null,o.g.forEach(function(h,m){var R=m.toLowerCase();m!=R&&(Kc(this,m),Wc(this,R,h))},o)),o.j=l}function Vm(o,l){const h=new dr;if(c.Image){const m=new Image;m.onload=S(ve,h,"TestLoadImage: loaded",!0,l,m),m.onerror=S(ve,h,"TestLoadImage: error",!1,l,m),m.onabort=S(ve,h,"TestLoadImage: abort",!1,l,m),m.ontimeout=S(ve,h,"TestLoadImage: timeout",!1,l,m),c.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=o}else l(!1)}function Cm(o,l){const h=new dr,m=new AbortController,R=setTimeout(()=>{m.abort(),ve(h,"TestPingServer: timeout",!1,l)},1e4);fetch(o,{signal:m.signal}).then(x=>{clearTimeout(R),x.ok?ve(h,"TestPingServer: ok",!0,l):ve(h,"TestPingServer: server error",!1,l)}).catch(()=>{clearTimeout(R),ve(h,"TestPingServer: error",!1,l)})}function ve(o,l,h,m,R){try{R&&(R.onload=null,R.onerror=null,R.onabort=null,R.ontimeout=null),m(h)}catch{}}function Dm(){this.g=new mm}function km(o,l,h){const m=h||"";try{qc(o,function(R,x){let M=R;d(R)&&(M=uo(R)),l.push(m+x+"="+encodeURIComponent(M))})}catch(R){throw l.push(m+"type="+encodeURIComponent("_badmap")),R}}function ks(o){this.l=o.Ub||null,this.j=o.eb||!1}V(ks,lo),ks.prototype.g=function(){return new Ns(this.l,this.j)},ks.prototype.i=function(o){return function(){return o}}({});function Ns(o,l){Rt.call(this),this.D=o,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}V(Ns,Rt),r=Ns.prototype,r.open=function(o,l){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=l,this.readyState=1,yr(this)},r.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const l={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(l.body=o),(this.D||c).fetch(new Request(this.A,l)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,_r(this)),this.readyState=0},r.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,yr(this)),this.g&&(this.readyState=3,yr(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Qc(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))};function Qc(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}r.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var l=o.value?o.value:new Uint8Array(0);(l=this.v.decode(l,{stream:!o.done}))&&(this.response=this.responseText+=l)}o.done?_r(this):yr(this),this.readyState==3&&Qc(this)}},r.Ra=function(o){this.g&&(this.response=this.responseText=o,_r(this))},r.Qa=function(o){this.g&&(this.response=o,_r(this))},r.ga=function(){this.g&&_r(this)};function _r(o){o.readyState=4,o.l=null,o.j=null,o.v=null,yr(o)}r.setRequestHeader=function(o,l){this.u.append(o,l)},r.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const o=[],l=this.h.entries();for(var h=l.next();!h.done;)h=h.value,o.push(h[0]+": "+h[1]),h=l.next();return o.join(`\r
`)};function yr(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(Ns.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function Xc(o){let l="";return H(o,function(h,m){l+=m,l+=":",l+=h,l+=`\r
`}),l}function vo(o,l,h){t:{for(m in h){var m=!1;break t}m=!0}m||(h=Xc(h),typeof o=="string"?h!=null&&encodeURIComponent(String(h)):at(o,l,h))}function ht(o){Rt.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}V(ht,Rt);var Nm=/^https?$/i,Mm=["POST","PUT"];r=ht.prototype,r.Ha=function(o){this.J=o},r.ea=function(o,l,h,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);l=l?l.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():mo.g(),this.v=this.o?bc(this.o):bc(mo),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(l,String(o),!0),this.B=!1}catch(x){Jc(this,x);return}if(o=h||"",h=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var R in m)h.set(R,m[R]);else if(typeof m.keys=="function"&&typeof m.get=="function")for(const x of m.keys())h.set(x,m.get(x));else throw Error("Unknown input type for opt_headers: "+String(m));m=Array.from(h.keys()).find(x=>x.toLowerCase()=="content-type"),R=c.FormData&&o instanceof c.FormData,!(0<=Array.prototype.indexOf.call(Mm,l,void 0))||m||R||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[x,M]of h)this.g.setRequestHeader(x,M);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{tu(this),this.u=!0,this.g.send(o),this.u=!1}catch(x){Jc(this,x)}};function Jc(o,l){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=l,o.m=5,Yc(o),Ms(o)}function Yc(o){o.A||(o.A=!0,Mt(o,"complete"),Mt(o,"error"))}r.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,Mt(this,"complete"),Mt(this,"abort"),Ms(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ms(this,!0)),ht.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?Zc(this):this.bb())},r.bb=function(){Zc(this)};function Zc(o){if(o.h&&typeof a<"u"&&(!o.v[1]||le(o)!=4||o.Z()!=2)){if(o.u&&le(o)==4)vc(o.Ea,0,o);else if(Mt(o,"readystatechange"),le(o)==4){o.h=!1;try{const M=o.Z();t:switch(M){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break t;default:l=!1}var h;if(!(h=l)){var m;if(m=M===0){var R=String(o.D).match(zc)[1]||null;!R&&c.self&&c.self.location&&(R=c.self.location.protocol.slice(0,-1)),m=!Nm.test(R?R.toLowerCase():"")}h=m}if(h)Mt(o,"complete"),Mt(o,"success");else{o.m=6;try{var x=2<le(o)?o.g.statusText:""}catch{x=""}o.l=x+" ["+o.Z()+"]",Yc(o)}}finally{Ms(o)}}}}function Ms(o,l){if(o.g){tu(o);const h=o.g,m=o.v[0]?()=>{}:null;o.g=null,o.v=null,l||Mt(o,"ready");try{h.onreadystatechange=m}catch{}}}function tu(o){o.I&&(c.clearTimeout(o.I),o.I=null)}r.isActive=function(){return!!this.g};function le(o){return o.g?o.g.readyState:0}r.Z=function(){try{return 2<le(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(o){if(this.g){var l=this.g.responseText;return o&&l.indexOf(o)==0&&(l=l.substring(o.length)),fm(l)}};function eu(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function Om(o){const l={};o=(o.g&&2<=le(o)&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let m=0;m<o.length;m++){if(B(o[m]))continue;var h=T(o[m]);const R=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();const x=l[R]||[];l[R]=x,x.push(h)}v(l,function(m){return m.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ir(o,l,h){return h&&h.internalChannelParams&&h.internalChannelParams[o]||l}function nu(o){this.Aa=0,this.i=[],this.j=new dr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Ir("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Ir("baseRetryDelayMs",5e3,o),this.cb=Ir("retryDelaySeedMs",1e4,o),this.Wa=Ir("forwardChannelMaxRetries",2,o),this.wa=Ir("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new Lc(o&&o.concurrentRequestLimit),this.Da=new Dm,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=nu.prototype,r.la=8,r.G=1,r.connect=function(o,l,h,m){Ot(0),this.W=o,this.H=l||{},h&&m!==void 0&&(this.H.OSID=h,this.H.OAID=m),this.F=this.X,this.I=hu(this,null,this.W),Ls(this)};function wo(o){if(ru(o),o.G==3){var l=o.U++,h=ue(o.I);if(at(h,"SID",o.K),at(h,"RID",l),at(h,"TYPE","terminate"),Er(o,h),l=new Ie(o,o.j,l),l.L=2,l.v=Ds(ue(h)),h=!1,c.navigator&&c.navigator.sendBeacon)try{h=c.navigator.sendBeacon(l.v.toString(),"")}catch{}!h&&c.Image&&(new Image().src=l.v,h=!0),h||(l.g=du(l.j,null),l.g.ea(l.v)),l.F=Date.now(),Ps(l)}lu(o)}function Os(o){o.g&&(Ao(o),o.g.cancel(),o.g=null)}function ru(o){Os(o),o.u&&(c.clearTimeout(o.u),o.u=null),Fs(o),o.h.cancel(),o.s&&(typeof o.s=="number"&&c.clearTimeout(o.s),o.s=null)}function Ls(o){if(!Fc(o.h)&&!o.s){o.s=!0;var l=o.Ga;ye||Nt(),Ue||(ye(),Ue=!0),K.add(l,o),o.B=0}}function Lm(o,l){return jc(o.h)>=o.h.j-(o.s?1:0)?!1:o.s?(o.i=l.D.concat(o.i),!0):o.G==1||o.G==2||o.B>=(o.Va?0:o.Wa)?!1:(o.s=hr(g(o.Ga,o,l),uu(o,o.B)),o.B++,!0)}r.Ga=function(o){if(this.s)if(this.s=null,this.G==1){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;const R=new Ie(this,this.j,o);let x=this.o;if(this.S&&(x?(x=y(x),E(x,this.S)):x=this.S),this.m!==null||this.O||(R.H=x,x=null),this.P)t:{for(var l=0,h=0;h<this.i.length;h++){e:{var m=this.i[h];if("__data__"in m.map&&(m=m.map.__data__,typeof m=="string")){m=m.length;break e}m=void 0}if(m===void 0)break;if(l+=m,4096<l){l=h;break t}if(l===4096||h===this.i.length-1){l=h+1;break t}}l=1e3}else l=1e3;l=iu(this,R,l),h=ue(this.I),at(h,"RID",o),at(h,"CVER",22),this.D&&at(h,"X-HTTP-Session-Id",this.D),Er(this,h),x&&(this.O?l="headers="+encodeURIComponent(String(Xc(x)))+"&"+l:this.m&&vo(h,this.m,x)),Eo(this.h,R),this.Ua&&at(h,"TYPE","init"),this.P?(at(h,"$req",l),at(h,"SID","null"),R.T=!0,go(R,h,null)):go(R,h,l),this.G=2}}else this.G==3&&(o?su(this,o):this.i.length==0||Fc(this.h)||su(this))};function su(o,l){var h;l?h=l.l:h=o.U++;const m=ue(o.I);at(m,"SID",o.K),at(m,"RID",h),at(m,"AID",o.T),Er(o,m),o.m&&o.o&&vo(m,o.m,o.o),h=new Ie(o,o.j,h,o.B+1),o.m===null&&(h.H=o.o),l&&(o.i=l.D.concat(o.i)),l=iu(o,h,1e3),h.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),Eo(o.h,h),go(h,m,l)}function Er(o,l){o.H&&H(o.H,function(h,m){at(l,m,h)}),o.l&&qc({},function(h,m){at(l,m,h)})}function iu(o,l,h){h=Math.min(o.i.length,h);var m=o.l?g(o.l.Na,o.l,o):null;t:{var R=o.i;let x=-1;for(;;){const M=["count="+h];x==-1?0<h?(x=R[0].g,M.push("ofs="+x)):x=0:M.push("ofs="+x);let ot=!0;for(let At=0;At<h;At++){let et=R[At].g;const xt=R[At].map;if(et-=x,0>et)x=Math.max(0,R[At].g-100),ot=!1;else try{km(xt,M,"req"+et+"_")}catch{m&&m(xt)}}if(ot){m=M.join("&");break t}}}return o=o.i.splice(0,h),l.D=o,m}function ou(o){if(!o.g&&!o.u){o.Y=1;var l=o.Fa;ye||Nt(),Ue||(ye(),Ue=!0),K.add(l,o),o.v=0}}function To(o){return o.g||o.u||3<=o.v?!1:(o.Y++,o.u=hr(g(o.Fa,o),uu(o,o.v)),o.v++,!0)}r.Fa=function(){if(this.u=null,au(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=hr(g(this.ab,this),o)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ot(10),Os(this),au(this))};function Ao(o){o.A!=null&&(c.clearTimeout(o.A),o.A=null)}function au(o){o.g=new Ie(o,o.j,"rpc",o.Y),o.m===null&&(o.g.H=o.o),o.g.O=0;var l=ue(o.qa);at(l,"RID","rpc"),at(l,"SID",o.K),at(l,"AID",o.T),at(l,"CI",o.F?"0":"1"),!o.F&&o.ja&&at(l,"TO",o.ja),at(l,"TYPE","xmlhttp"),Er(o,l),o.m&&o.o&&vo(l,o.m,o.o),o.L&&(o.g.I=o.L);var h=o.g;o=o.ia,h.L=1,h.v=Ds(ue(l)),h.m=null,h.P=!0,Nc(h,o)}r.Za=function(){this.C!=null&&(this.C=null,Os(this),To(this),Ot(19))};function Fs(o){o.C!=null&&(c.clearTimeout(o.C),o.C=null)}function cu(o,l){var h=null;if(o.g==l){Fs(o),Ao(o),o.g=null;var m=2}else if(Io(o.h,l))h=l.D,Bc(o.h,l),m=1;else return;if(o.G!=0){if(l.o)if(m==1){h=l.m?l.m.length:0,l=Date.now()-l.F;var R=o.B;m=Ss(),Mt(m,new Vc(m,h)),Ls(o)}else ou(o);else if(R=l.s,R==3||R==0&&0<l.X||!(m==1&&Lm(o,l)||m==2&&To(o)))switch(h&&0<h.length&&(l=o.h,l.i=l.i.concat(h)),R){case 1:Ke(o,5);break;case 4:Ke(o,10);break;case 3:Ke(o,6);break;default:Ke(o,2)}}}function uu(o,l){let h=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(h*=2),h*l}function Ke(o,l){if(o.j.info("Error code "+l),l==2){var h=g(o.fb,o),m=o.Xa;const R=!m;m=new Ge(m||"//www.google.com/images/cleardot.gif"),c.location&&c.location.protocol=="http"||Vs(m,"https"),Ds(m),R?Vm(m.toString(),h):Cm(m.toString(),h)}else Ot(2);o.G=0,o.l&&o.l.sa(l),lu(o),ru(o)}r.fb=function(o){o?(this.j.info("Successfully pinged google.com"),Ot(2)):(this.j.info("Failed to ping google.com"),Ot(1))};function lu(o){if(o.G=0,o.ka=[],o.l){const l=Uc(o.h);(l.length!=0||o.i.length!=0)&&(D(o.ka,l),D(o.ka,o.i),o.h.i.length=0,C(o.i),o.i.length=0),o.l.ra()}}function hu(o,l,h){var m=h instanceof Ge?ue(h):new Ge(h);if(m.g!="")l&&(m.g=l+"."+m.g),Cs(m,m.s);else{var R=c.location;m=R.protocol,l=l?l+"."+R.hostname:R.hostname,R=+R.port;var x=new Ge(null);m&&Vs(x,m),l&&(x.g=l),R&&Cs(x,R),h&&(x.l=h),m=x}return h=o.D,l=o.ya,h&&l&&at(m,h,l),at(m,"VER",o.la),Er(o,m),m}function du(o,l,h){if(l&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return l=o.Ca&&!o.pa?new ht(new ks({eb:h})):new ht(o.pa),l.Ha(o.J),l}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function fu(){}r=fu.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function js(){}js.prototype.g=function(o,l){return new qt(o,l)};function qt(o,l){Rt.call(this),this.g=new nu(l),this.l=o,this.h=l&&l.messageUrlParams||null,o=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(o?o["X-WebChannel-Content-Type"]=l.messageContentType:o={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.va&&(o?o["X-WebChannel-Client-Profile"]=l.va:o={"X-WebChannel-Client-Profile":l.va}),this.g.S=o,(o=l&&l.Sb)&&!B(o)&&(this.g.m=o),this.v=l&&l.supportsCrossDomainXhr||!1,this.u=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!B(l)&&(this.g.D=l,o=this.h,o!==null&&l in o&&(o=this.h,l in o&&delete o[l])),this.j=new Tn(this)}V(qt,Rt),qt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},qt.prototype.close=function(){wo(this.g)},qt.prototype.o=function(o){var l=this.g;if(typeof o=="string"){var h={};h.__data__=o,o=h}else this.u&&(h={},h.__data__=uo(o),o=h);l.i.push(new Em(l.Ya++,o)),l.G==3&&Ls(l)},qt.prototype.N=function(){this.g.l=null,delete this.j,wo(this.g),delete this.g,qt.aa.N.call(this)};function mu(o){ho.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var l=o.__sm__;if(l){t:{for(const h in l){o=h;break t}o=void 0}(this.i=o)&&(o=this.i,l=l!==null&&o in l?l[o]:void 0),this.data=l}else this.data=o}V(mu,ho);function pu(){fo.call(this),this.status=1}V(pu,fo);function Tn(o){this.g=o}V(Tn,fu),Tn.prototype.ua=function(){Mt(this.g,"a")},Tn.prototype.ta=function(o){Mt(this.g,new mu(o))},Tn.prototype.sa=function(o){Mt(this.g,new pu)},Tn.prototype.ra=function(){Mt(this.g,"b")},js.prototype.createWebChannel=js.prototype.g,qt.prototype.send=qt.prototype.o,qt.prototype.open=qt.prototype.m,qt.prototype.close=qt.prototype.close,Oh=function(){return new js},Mh=function(){return Ss()},Nh=ze,Go={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Rs.NO_ERROR=0,Rs.TIMEOUT=8,Rs.HTTP_ERROR=6,Qs=Rs,Cc.COMPLETE="complete",kh=Cc,Sc.EventType=ur,ur.OPEN="a",ur.CLOSE="b",ur.ERROR="c",ur.MESSAGE="d",Rt.prototype.listen=Rt.prototype.K,Pr=Sc,ht.prototype.listenOnce=ht.prototype.L,ht.prototype.getLastError=ht.prototype.Ka,ht.prototype.getLastErrorCode=ht.prototype.Ba,ht.prototype.getStatus=ht.prototype.Z,ht.prototype.getResponseJson=ht.prototype.Oa,ht.prototype.getResponseText=ht.prototype.oa,ht.prototype.send=ht.prototype.ea,ht.prototype.setWithCredentials=ht.prototype.Ha,Dh=ht}).apply(typeof qs<"u"?qs:typeof self<"u"?self:typeof window<"u"?window:{});const Du="@firebase/firestore",ku="4.9.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bt{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}bt.UNAUTHENTICATED=new bt(null),bt.GOOGLE_CREDENTIALS=new bt("google-credentials-uid"),bt.FIRST_PARTY=new bt("first-party-uid"),bt.MOCK_USER=new bt("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let er="12.0.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hn=new Ah("@firebase/firestore");function Cn(){return hn.logLevel}function k(r,...t){if(hn.logLevel<=tt.DEBUG){const e=t.map(wa);hn.debug(`Firestore (${er}): ${r}`,...e)}}function Ft(r,...t){if(hn.logLevel<=tt.ERROR){const e=t.map(wa);hn.error(`Firestore (${er}): ${r}`,...e)}}function Bn(r,...t){if(hn.logLevel<=tt.WARN){const e=t.map(wa);hn.warn(`Firestore (${er}): ${r}`,...e)}}function wa(r){if(typeof r=="string")return r;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(e){return JSON.stringify(e)}(r)}catch{return r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function F(r,t,e){let n="Unexpected state";typeof t=="string"?n=t:e=t,Lh(r,n,e)}function Lh(r,t,e){let n=`FIRESTORE (${er}) INTERNAL ASSERTION FAILED: ${t} (ID: ${r.toString(16)})`;if(e!==void 0)try{n+=" CONTEXT: "+JSON.stringify(e)}catch{n+=" CONTEXT: "+e}throw Ft(n),new Error(n)}function U(r,t,e,n){let s="Unexpected state";typeof e=="string"?s=e:n=e,r||Lh(t,s,n)}function Q(r,t){return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class N extends tr{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ce{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fh{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class xg{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(bt.UNAUTHENTICATED))}shutdown(){}}class Pg{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}}class Vg{constructor(t){this.t=t,this.currentUser=bt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){U(this.o===void 0,42304);let n=this.i;const s=u=>this.i!==n?(n=this.i,e(u)):Promise.resolve();let i=new Ce;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Ce,t.enqueueRetryable(()=>s(this.currentUser))};const a=()=>{const u=i;t.enqueueRetryable(async()=>{await u.promise,await s(this.currentUser)})},c=u=>{k("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(u=>c(u)),setTimeout(()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?c(u):(k("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Ce)}},0),a()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(n=>this.i!==t?(k("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(U(typeof n.accessToken=="string",31837,{l:n}),new Fh(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return U(t===null||typeof t=="string",2055,{h:t}),new bt(t)}}class Cg{constructor(t,e,n){this.P=t,this.T=e,this.I=n,this.type="FirstParty",this.user=bt.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class Dg{constructor(t,e,n){this.P=t,this.T=e,this.I=n}getToken(){return Promise.resolve(new Cg(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable(()=>e(bt.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Nu{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class kg{constructor(t,e){this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,hg(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){U(this.o===void 0,3512);const n=i=>{i.error!=null&&k("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const a=i.token!==this.m;return this.m=i.token,k("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?e(i.token):Promise.resolve()};this.o=i=>{t.enqueueRetryable(()=>n(i))};const s=i=>{k("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):k("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Nu(this.p));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(U(typeof e.token=="string",44558,{tokenResult:e}),this.m=e.token,new Nu(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ng(r){const t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(r);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let n=0;n<r;n++)e[n]=Math.floor(256*Math.random());return e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ta{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(4.129032258064516);let n="";for(;n.length<20;){const s=Ng(40);for(let i=0;i<s.length;++i)n.length<20&&s[i]<e&&(n+=t.charAt(s[i]%62))}return n}}function W(r,t){return r<t?-1:r>t?1:0}function Ko(r,t){const e=Math.min(r.length,t.length);for(let n=0;n<e;n++){const s=r.charAt(n),i=t.charAt(n);if(s!==i)return Co(s)===Co(i)?W(s,i):Co(s)?1:-1}return W(r.length,t.length)}const Mg=55296,Og=57343;function Co(r){const t=r.charCodeAt(0);return t>=Mg&&t<=Og}function Un(r,t,e){return r.length===t.length&&r.every((n,s)=>e(n,t[s]))}function jh(r){return r+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mu="__name__";class ee{constructor(t,e,n){e===void 0?e=0:e>t.length&&F(637,{offset:e,range:t.length}),n===void 0?n=t.length-e:n>t.length-e&&F(1746,{length:n,range:t.length-e}),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return ee.comparator(this,t)===0}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof ee?t.forEach(n=>{e.push(n)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let s=0;s<n;s++){const i=ee.compareSegments(t.get(s),e.get(s));if(i!==0)return i}return W(t.length,e.length)}static compareSegments(t,e){const n=ee.isNumericId(t),s=ee.isNumericId(e);return n&&!s?-1:!n&&s?1:n&&s?ee.extractNumericId(t).compare(ee.extractNumericId(e)):Ko(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return Ve.fromString(t.substring(4,t.length-2))}}class nt extends ee{construct(t,e,n){return new nt(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new N(P.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter(s=>s.length>0))}return new nt(e)}static emptyPath(){return new nt([])}}const Lg=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class lt extends ee{construct(t,e,n){return new lt(t,e,n)}static isValidIdentifier(t){return Lg.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),lt.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Mu}static keyField(){return new lt([Mu])}static fromServerFormat(t){const e=[];let n="",s=0;const i=()=>{if(n.length===0)throw new N(P.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let a=!1;for(;s<t.length;){const c=t[s];if(c==="\\"){if(s+1===t.length)throw new N(P.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const u=t[s+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new N(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=u,s+=2}else c==="`"?(a=!a,s++):c!=="."||a?(n+=c,s++):(i(),s++)}if(i(),a)throw new N(P.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new lt(e)}static emptyPath(){return new lt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O{constructor(t){this.path=t}static fromPath(t){return new O(nt.fromString(t))}static fromName(t){return new O(nt.fromString(t).popFirst(5))}static empty(){return new O(nt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&nt.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return nt.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new O(new nt(t.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bh(r,t,e){if(!e)throw new N(P.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${t}.`)}function Fg(r,t,e,n){if(t===!0&&n===!0)throw new N(P.INVALID_ARGUMENT,`${r} and ${e} cannot be used together.`)}function Ou(r){if(!O.isDocumentKey(r))throw new N(P.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function Lu(r){if(O.isDocumentKey(r))throw new N(P.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function Uh(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}function Vi(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{const t=function(n){return n.constructor?n.constructor.name:null}(r);return t?`a custom ${t} object`:"an object"}}return typeof r=="function"?"a function":F(12329,{type:typeof r})}function te(r,t){if("_delegate"in r&&(r=r._delegate),!(r instanceof t)){if(t.name===r.constructor.name)throw new N(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const e=Vi(r);throw new N(P.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return r}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _t(r,t){const e={typeString:r};return t&&(e.value=t),e}function us(r,t){if(!Uh(r))throw new N(P.INVALID_ARGUMENT,"JSON must be an object");let e;for(const n in t)if(t[n]){const s=t[n].typeString,i="value"in t[n]?{value:t[n].value}:void 0;if(!(n in r)){e=`JSON missing required field: '${n}'`;break}const a=r[n];if(s&&typeof a!==s){e=`JSON field '${n}' must be a ${s}.`;break}if(i!==void 0&&a!==i.value){e=`Expected '${n}' field to equal '${i.value}'`;break}}if(e)throw new N(P.INVALID_ARGUMENT,e);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fu=-62135596800,ju=1e6;class rt{static now(){return rt.fromMillis(Date.now())}static fromDate(t){return rt.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor((t-1e3*e)*ju);return new rt(e,n)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new N(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new N(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<Fu)throw new N(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new N(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/ju}_compareTo(t){return this.seconds===t.seconds?W(this.nanoseconds,t.nanoseconds):W(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:rt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(us(t,rt._jsonSchema))return new rt(t.seconds,t.nanoseconds)}valueOf(){const t=this.seconds-Fu;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}rt._jsonSchemaVersion="firestore/timestamp/1.0",rt._jsonSchema={type:_t("string",rt._jsonSchemaVersion),seconds:_t("number"),nanoseconds:_t("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q{static fromTimestamp(t){return new q(t)}static min(){return new q(new rt(0,0))}static max(){return new q(new rt(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wr=-1;class hi{constructor(t,e,n,s){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=s}}function Ho(r){return r.fields.find(t=>t.kind===2)}function Qe(r){return r.fields.filter(t=>t.kind!==2)}hi.UNKNOWN_ID=-1;class Xs{constructor(t,e){this.fieldPath=t,this.kind=e}}class Qr{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new Qr(0,Kt.min())}}function jg(r,t){const e=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,s=q.fromTimestamp(n===1e9?new rt(e+1,0):new rt(e,n));return new Kt(s,O.empty(),t)}function qh(r){return new Kt(r.readTime,r.key,Wr)}class Kt{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new Kt(q.min(),O.empty(),Wr)}static max(){return new Kt(q.max(),O.empty(),Wr)}}function Aa(r,t){let e=r.readTime.compareTo(t.readTime);return e!==0?e:(e=O.comparator(r.documentKey,t.documentKey),e!==0?e:W(r.largestBatchId,t.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zh="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class $h{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yn(r){if(r.code!==P.FAILED_PRECONDITION||r.message!==zh)throw r;k("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&F(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new b((n,s)=>{this.nextCallback=i=>{this.wrapSuccess(t,i).next(n,s)},this.catchCallback=i=>{this.wrapFailure(e,i).next(n,s)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{const e=t();return e instanceof b?e:b.resolve(e)}catch(e){return b.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):b.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):b.reject(e)}static resolve(t){return new b((e,n)=>{e(t)})}static reject(t){return new b((e,n)=>{n(t)})}static waitFor(t){return new b((e,n)=>{let s=0,i=0,a=!1;t.forEach(c=>{++s,c.next(()=>{++i,a&&i===s&&e()},u=>n(u))}),a=!0,i===s&&e()})}static or(t){let e=b.resolve(!1);for(const n of t)e=e.next(s=>s?b.resolve(s):n());return e}static forEach(t,e){const n=[];return t.forEach((s,i)=>{n.push(e.call(this,s,i))}),this.waitFor(n)}static mapArray(t,e){return new b((n,s)=>{const i=t.length,a=new Array(i);let c=0;for(let u=0;u<i;u++){const d=u;e(t[d]).next(f=>{a[d]=f,++c,c===i&&n(a)},f=>s(f))}})}static doWhile(t,e){return new b((n,s)=>{const i=()=>{t()===!0?e().next(()=>{i()},s):n()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $t="SimpleDb";class Ci{static open(t,e,n,s){try{return new Ci(e,t.transaction(s,n))}catch(i){throw new Or(e,i)}}constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.S=new Ce,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{e.error?this.S.reject(new Or(t,e.error)):this.S.resolve()},this.transaction.onerror=n=>{const s=ba(n.target.error);this.S.reject(new Or(t,s))}}get D(){return this.S.promise}abort(t){t&&this.S.reject(t),this.aborted||(k($t,"Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const t=this.transaction;this.aborted||typeof t.commit!="function"||t.commit()}store(t){const e=this.transaction.objectStore(t);return new Ug(e)}}class De{static delete(t){return k($t,"Removing database:",t),Je(gh().indexedDB.deleteDatabase(t)).toPromise()}static v(){if(!wh())return!1;if(De.F())return!0;const t=ci(),e=De.M(t),n=0<e&&e<10,s=Gh(t),i=0<s&&s<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||i)}static F(){var t;return typeof process<"u"&&((t=process.__PRIVATE_env)==null?void 0:t.__PRIVATE_USE_MOCK_PERSISTENCE)==="YES"}static O(t,e){return t.store(e)}static M(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}constructor(t,e,n){this.name=t,this.version=e,this.N=n,this.B=null,De.M(ci())===12.2&&Ft("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(t){return this.db||(k($t,"Opening database:",this.name),this.db=await new Promise((e,n)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const a=i.target.result;e(a)},s.onblocked=()=>{n(new Or(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const a=i.target.error;a.name==="VersionError"?n(new N(P.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):a.name==="InvalidStateError"?n(new N(P.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a)):n(new Or(t,a))},s.onupgradeneeded=i=>{k($t,'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const a=i.target.result;this.N.k(a,s.transaction,i.oldVersion,this.version).next(()=>{k($t,"Database upgrade to version "+this.version+" complete")})}})),this.q&&(this.db.onversionchange=e=>this.q(e)),this.db}$(t){this.q=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(t,e,n,s){const i=e==="readonly";let a=0;for(;;){++a;try{this.db=await this.L(t);const c=Ci.open(this.db,t,i?"readonly":"readwrite",n),u=s(c).next(d=>(c.C(),d)).catch(d=>(c.abort(d),b.reject(d))).toPromise();return u.catch(()=>{}),await c.D,u}catch(c){const u=c,d=u.name!=="FirebaseError"&&a<3;if(k($t,"Transaction failed with error:",u.message,"Retrying:",d),this.close(),!d)return Promise.reject(u)}}}close(){this.db&&this.db.close(),this.db=void 0}}function Gh(r){const t=r.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}class Bg{constructor(t){this.U=t,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(t){this.U=t}done(){this.K=!0}j(t){this.W=t}delete(){return Je(this.U.delete())}}class Or extends N{constructor(t,e){super(P.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}}function je(r){return r.name==="IndexedDbTransactionError"}class Ug{constructor(t){this.store=t}put(t,e){let n;return e!==void 0?(k($t,"PUT",this.store.name,t,e),n=this.store.put(e,t)):(k($t,"PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Je(n)}add(t){return k($t,"ADD",this.store.name,t,t),Je(this.store.add(t))}get(t){return Je(this.store.get(t)).next(e=>(e===void 0&&(e=null),k($t,"GET",this.store.name,t,e),e))}delete(t){return k($t,"DELETE",this.store.name,t),Je(this.store.delete(t))}count(){return k($t,"COUNT",this.store.name),Je(this.store.count())}J(t,e){const n=this.options(t,e),s=n.index?this.store.index(n.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(n.range);return new b((a,c)=>{i.onerror=u=>{c(u.target.error)},i.onsuccess=u=>{a(u.target.result)}})}{const i=this.cursor(n),a=[];return this.H(i,(c,u)=>{a.push(u)}).next(()=>a)}}Y(t,e){const n=this.store.getAll(t,e===null?void 0:e);return new b((s,i)=>{n.onerror=a=>{i(a.target.error)},n.onsuccess=a=>{s(a.target.result)}})}Z(t,e){k($t,"DELETE ALL",this.store.name);const n=this.options(t,e);n.X=!1;const s=this.cursor(n);return this.H(s,(i,a,c)=>c.delete())}ee(t,e){let n;e?n=t:(n={},e=t);const s=this.cursor(n);return this.H(s,e)}te(t){const e=this.cursor({});return new b((n,s)=>{e.onerror=i=>{const a=ba(i.target.error);s(a)},e.onsuccess=i=>{const a=i.target.result;a?t(a.primaryKey,a.value).next(c=>{c?a.continue():n()}):n()}})}H(t,e){const n=[];return new b((s,i)=>{t.onerror=a=>{i(a.target.error)},t.onsuccess=a=>{const c=a.target.result;if(!c)return void s();const u=new Bg(c),d=e(c.primaryKey,c.value,u);if(d instanceof b){const f=d.catch(p=>(u.done(),b.reject(p)));n.push(f)}u.isDone?s():u.G===null?c.continue():c.continue(u.G)}}).next(()=>b.waitFor(n))}options(t,e){let n;return t!==void 0&&(typeof t=="string"?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.X?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function Je(r){return new b((t,e)=>{r.onsuccess=n=>{const s=n.target.result;t(s)},r.onerror=n=>{const s=ba(n.target.error);e(s)}})}let Bu=!1;function ba(r){const t=De.M(ci());if(t>=12.2&&t<13){const e="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(e)>=0){const n=new N("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Bu||(Bu=!0,setTimeout(()=>{throw n},0)),n}}return r}const Lr="IndexBackfiller";class qg{constructor(t,e){this.asyncQueue=t,this.ne=e,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(t){k(Lr,`Scheduled in ${t}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",t,async()=>{this.task=null;try{const e=await this.ne.ie();k(Lr,`Documents written: ${e}`)}catch(e){je(e)?k(Lr,"Ignoring IndexedDB error during index backfill: ",e):await yn(e)}await this.re(6e4)})}}class zg{constructor(t,e){this.localStore=t,this.persistence=e}async ie(t=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",e=>this.se(e,t))}se(t,e){const n=new Set;let s=e,i=!0;return b.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(t).next(a=>{if(a!==null&&!n.has(a))return k(Lr,`Processing collection: ${a}`),this.oe(t,a,s).next(c=>{s-=c,n.add(a)});i=!1})).next(()=>e-s)}oe(t,e,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(t,e).next(s=>this.localStore.localDocuments.getNextDocuments(t,e,s,n).next(i=>{const a=i.changes;return this.localStore.indexManager.updateIndexEntries(t,a).next(()=>this._e(s,i)).next(c=>(k(Lr,`Updating offset: ${c}`),this.localStore.indexManager.updateCollectionGroup(t,e,c))).next(()=>a.size)}))}_e(t,e){let n=t;return e.changes.forEach((s,i)=>{const a=qh(i);Aa(a,n)>0&&(n=a)}),new Kt(n.readTime,n.documentKey,Math.max(e.batchId,t.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wt{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=n=>this.ae(n),this.ue=n=>e.writeSequenceNumber(n))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ue&&this.ue(t),t}}Wt.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const on=-1;function Di(r){return r==null}function Xr(r){return r===0&&1/r==-1/0}function $g(r){return typeof r=="number"&&Number.isInteger(r)&&!Xr(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const di="";function kt(r){let t="";for(let e=0;e<r.length;e++)t.length>0&&(t=Uu(t)),t=Gg(r.get(e),t);return Uu(t)}function Gg(r,t){let e=t;const n=r.length;for(let s=0;s<n;s++){const i=r.charAt(s);switch(i){case"\0":e+="";break;case di:e+="";break;default:e+=i}}return e}function Uu(r){return r+di+""}function ne(r){const t=r.length;if(U(t>=2,64408,{path:r}),t===2)return U(r.charAt(0)===di&&r.charAt(1)==="",56145,{path:r}),nt.emptyPath();const e=t-2,n=[];let s="";for(let i=0;i<t;){const a=r.indexOf(di,i);switch((a<0||a>e)&&F(50515,{path:r}),r.charAt(a+1)){case"":const c=r.substring(i,a);let u;s.length===0?u=c:(s+=c,u=s,s=""),n.push(u);break;case"":s+=r.substring(i,a),s+="\0";break;case"":s+=r.substring(i,a+1);break;default:F(61167,{path:r})}i=a+2}return new nt(n)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xe="remoteDocuments",ls="owner",bn="owner",Jr="mutationQueues",Kg="userId",Yt="mutations",qu="batchId",sn="userMutationsIndex",zu=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Js(r,t){return[r,kt(t)]}function Kh(r,t,e){return[r,kt(t),e]}const Hg={},qn="documentMutations",fi="remoteDocumentsV14",Wg=["prefixPath","collectionGroup","readTime","documentId"],Ys="documentKeyIndex",Qg=["prefixPath","collectionGroup","documentId"],Hh="collectionGroupIndex",Xg=["collectionGroup","readTime","prefixPath","documentId"],Yr="remoteDocumentGlobal",Wo="remoteDocumentGlobalKey",zn="targets",Wh="queryTargetsIndex",Jg=["canonicalId","targetId"],$n="targetDocuments",Yg=["targetId","path"],Sa="documentTargetsIndex",Zg=["path","targetId"],mi="targetGlobalKey",an="targetGlobal",Zr="collectionParents",t_=["collectionId","parent"],Gn="clientMetadata",e_="clientId",ki="bundles",n_="bundleId",Ni="namedQueries",r_="name",Ra="indexConfiguration",s_="indexId",Qo="collectionGroupIndex",i_="collectionGroup",Fr="indexState",o_=["indexId","uid"],Qh="sequenceNumberIndex",a_=["uid","sequenceNumber"],jr="indexEntries",c_=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Xh="documentKeyIndex",u_=["indexId","uid","orderedDocumentKey"],Mi="documentOverlays",l_=["userId","collectionPath","documentId"],Xo="collectionPathOverlayIndex",h_=["userId","collectionPath","largestBatchId"],Jh="collectionGroupOverlayIndex",d_=["userId","collectionGroup","largestBatchId"],xa="globals",f_="name",Yh=[Jr,Yt,qn,Xe,zn,ls,an,$n,Gn,Yr,Zr,ki,Ni],m_=[...Yh,Mi],Zh=[Jr,Yt,qn,fi,zn,ls,an,$n,Gn,Yr,Zr,ki,Ni,Mi],td=Zh,Pa=[...td,Ra,Fr,jr],p_=Pa,ed=[...Pa,xa],g_=ed;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jo extends $h{constructor(t,e){super(),this.le=t,this.currentSequenceNumber=e}}function Et(r,t){const e=Q(r);return De.O(e.le,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $u(r){let t=0;for(const e in r)Object.prototype.hasOwnProperty.call(r,e)&&t++;return t}function Be(r,t){for(const e in r)Object.prototype.hasOwnProperty.call(r,e)&&t(e,r[e])}function nd(r){for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ut{constructor(t,e){this.comparator=t,this.root=e||St.EMPTY}insert(t,e){return new ut(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,St.BLACK,null,null))}remove(t){return new ut(this.comparator,this.root.remove(t,this.comparator).copy(null,null,St.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(n===0)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(t,n.key);if(s===0)return e+n.left.size;s<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,n)=>(t(e,n),!1))}toString(){const t=[];return this.inorderTraversal((e,n)=>(t.push(`${e}:${n}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new zs(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new zs(this.root,t,this.comparator,!1)}getReverseIterator(){return new zs(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new zs(this.root,t,this.comparator,!0)}}class zs{constructor(t,e,n,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,e&&s&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(i===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class St{constructor(t,e,n,s,i){this.key=t,this.value=e,this.color=n??St.RED,this.left=s??St.EMPTY,this.right=i??St.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,s,i){return new St(t??this.key,e??this.value,n??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let s=this;const i=n(t,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(t,e,n),null):i===0?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return St.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),e(t,s.key)===0){if(s.right.isEmpty())return St.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,St.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,St.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw F(43730,{key:this.key,value:this.value});if(this.right.isRed())throw F(14113,{key:this.key,value:this.value});const t=this.left.check();if(t!==this.right.check())throw F(27949);return t+(this.isRed()?0:1)}}St.EMPTY=null,St.RED=!0,St.BLACK=!1;St.EMPTY=new class{constructor(){this.size=0}get key(){throw F(57766)}get value(){throw F(16141)}get color(){throw F(16727)}get left(){throw F(29726)}get right(){throw F(36894)}copy(t,e,n,s,i){return this}insert(t,e,n){return new St(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class it{constructor(t){this.comparator=t,this.data=new ut(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,n)=>(t(e),!1))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let n;for(n=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Gu(this.data.getIterator())}getIteratorFrom(t){return new Gu(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(n=>{e=e.add(n)}),e}isEqual(t){if(!(t instanceof it)||this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const s=e.getNext().key,i=n.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){const e=new it(this.comparator);return e.data=t,e}}class Gu{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Sn(r){return r.hasNext()?r.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ut{constructor(t){this.fields=t,t.sort(lt.comparator)}static empty(){return new Ut([])}unionWith(t){let e=new it(lt.comparator);for(const n of this.fields)e=e.add(n);for(const n of t)e=e.add(n);return new Ut(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Un(this.fields,t.fields,(e,n)=>e.isEqual(n))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rd extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yt{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new rd("Invalid base64 string: "+i):i}}(t);return new yt(e)}static fromUint8Array(t){const e=function(s){let i="";for(let a=0;a<s.length;++a)i+=String.fromCharCode(s[a]);return i}(t);return new yt(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){const n=new Uint8Array(e.length);for(let s=0;s<e.length;s++)n[s]=e.charCodeAt(s);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return W(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}yt.EMPTY_BYTE_STRING=new yt("");const __=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function me(r){if(U(!!r,39018),typeof r=="string"){let t=0;const e=__.exec(r);if(U(!!e,46558,{timestamp:r}),e[1]){let s=e[1];s=(s+"000000000").substr(0,9),t=Number(s)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:t}}return{seconds:ct(r.seconds),nanos:ct(r.nanos)}}function ct(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function pe(r){return typeof r=="string"?yt.fromBase64String(r):yt.fromUint8Array(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sd="server_timestamp",id="__type__",od="__previous_value__",ad="__local_write_time__";function Va(r){var e,n;return((n=(((e=r==null?void 0:r.mapValue)==null?void 0:e.fields)||{})[id])==null?void 0:n.stringValue)===sd}function Oi(r){const t=r.mapValue.fields[od];return Va(t)?Oi(t):t}function ts(r){const t=me(r.mapValue.fields[ad].timestampValue);return new rt(t.seconds,t.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y_{constructor(t,e,n,s,i,a,c,u,d,f){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=s,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=c,this.longPollingOptions=u,this.useFetchStreams=d,this.isUsingEmulator=f}}const es="(default)";class dn{constructor(t,e){this.projectId=t,this.database=e||es}static empty(){return new dn("","")}get isDefaultDatabase(){return this.database===es}isEqual(t){return t instanceof dn&&t.projectId===this.projectId&&t.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ca="__type__",cd="__max__",Re={mapValue:{fields:{__type__:{stringValue:cd}}}},Da="__vector__",Kn="value",Zs={nullValue:"NULL_VALUE"};function Ne(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?Va(r)?4:ud(r)?9007199254740991:Li(r)?10:11:F(28295,{value:r})}function oe(r,t){if(r===t)return!0;const e=Ne(r);if(e!==Ne(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===t.booleanValue;case 4:return ts(r).isEqual(ts(t));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const a=me(s.timestampValue),c=me(i.timestampValue);return a.seconds===c.seconds&&a.nanos===c.nanos}(r,t);case 5:return r.stringValue===t.stringValue;case 6:return function(s,i){return pe(s.bytesValue).isEqual(pe(i.bytesValue))}(r,t);case 7:return r.referenceValue===t.referenceValue;case 8:return function(s,i){return ct(s.geoPointValue.latitude)===ct(i.geoPointValue.latitude)&&ct(s.geoPointValue.longitude)===ct(i.geoPointValue.longitude)}(r,t);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return ct(s.integerValue)===ct(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const a=ct(s.doubleValue),c=ct(i.doubleValue);return a===c?Xr(a)===Xr(c):isNaN(a)&&isNaN(c)}return!1}(r,t);case 9:return Un(r.arrayValue.values||[],t.arrayValue.values||[],oe);case 10:case 11:return function(s,i){const a=s.mapValue.fields||{},c=i.mapValue.fields||{};if($u(a)!==$u(c))return!1;for(const u in a)if(a.hasOwnProperty(u)&&(c[u]===void 0||!oe(a[u],c[u])))return!1;return!0}(r,t);default:return F(52216,{left:r})}}function ns(r,t){return(r.values||[]).find(e=>oe(e,t))!==void 0}function Me(r,t){if(r===t)return 0;const e=Ne(r),n=Ne(t);if(e!==n)return W(e,n);switch(e){case 0:case 9007199254740991:return 0;case 1:return W(r.booleanValue,t.booleanValue);case 2:return function(i,a){const c=ct(i.integerValue||i.doubleValue),u=ct(a.integerValue||a.doubleValue);return c<u?-1:c>u?1:c===u?0:isNaN(c)?isNaN(u)?0:-1:1}(r,t);case 3:return Ku(r.timestampValue,t.timestampValue);case 4:return Ku(ts(r),ts(t));case 5:return Ko(r.stringValue,t.stringValue);case 6:return function(i,a){const c=pe(i),u=pe(a);return c.compareTo(u)}(r.bytesValue,t.bytesValue);case 7:return function(i,a){const c=i.split("/"),u=a.split("/");for(let d=0;d<c.length&&d<u.length;d++){const f=W(c[d],u[d]);if(f!==0)return f}return W(c.length,u.length)}(r.referenceValue,t.referenceValue);case 8:return function(i,a){const c=W(ct(i.latitude),ct(a.latitude));return c!==0?c:W(ct(i.longitude),ct(a.longitude))}(r.geoPointValue,t.geoPointValue);case 9:return Hu(r.arrayValue,t.arrayValue);case 10:return function(i,a){var g,S,V,C;const c=i.fields||{},u=a.fields||{},d=(g=c[Kn])==null?void 0:g.arrayValue,f=(S=u[Kn])==null?void 0:S.arrayValue,p=W(((V=d==null?void 0:d.values)==null?void 0:V.length)||0,((C=f==null?void 0:f.values)==null?void 0:C.length)||0);return p!==0?p:Hu(d,f)}(r.mapValue,t.mapValue);case 11:return function(i,a){if(i===Re.mapValue&&a===Re.mapValue)return 0;if(i===Re.mapValue)return 1;if(a===Re.mapValue)return-1;const c=i.fields||{},u=Object.keys(c),d=a.fields||{},f=Object.keys(d);u.sort(),f.sort();for(let p=0;p<u.length&&p<f.length;++p){const g=Ko(u[p],f[p]);if(g!==0)return g;const S=Me(c[u[p]],d[f[p]]);if(S!==0)return S}return W(u.length,f.length)}(r.mapValue,t.mapValue);default:throw F(23264,{he:e})}}function Ku(r,t){if(typeof r=="string"&&typeof t=="string"&&r.length===t.length)return W(r,t);const e=me(r),n=me(t),s=W(e.seconds,n.seconds);return s!==0?s:W(e.nanos,n.nanos)}function Hu(r,t){const e=r.values||[],n=t.values||[];for(let s=0;s<e.length&&s<n.length;++s){const i=Me(e[s],n[s]);if(i)return i}return W(e.length,n.length)}function Hn(r){return Yo(r)}function Yo(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(e){const n=me(e);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(e){return pe(e).toBase64()}(r.bytesValue):"referenceValue"in r?function(e){return O.fromName(e).toString()}(r.referenceValue):"geoPointValue"in r?function(e){return`geo(${e.latitude},${e.longitude})`}(r.geoPointValue):"arrayValue"in r?function(e){let n="[",s=!0;for(const i of e.values||[])s?s=!1:n+=",",n+=Yo(i);return n+"]"}(r.arrayValue):"mapValue"in r?function(e){const n=Object.keys(e.fields||{}).sort();let s="{",i=!0;for(const a of n)i?i=!1:s+=",",s+=`${a}:${Yo(e.fields[a])}`;return s+"}"}(r.mapValue):F(61005,{value:r})}function ti(r){switch(Ne(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=Oi(r);return t?16+ti(t):16;case 5:return 2*r.stringValue.length;case 6:return pe(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return function(n){return(n.values||[]).reduce((s,i)=>s+ti(i),0)}(r.arrayValue);case 10:case 11:return function(n){let s=0;return Be(n.fields,(i,a)=>{s+=i.length+ti(a)}),s}(r.mapValue);default:throw F(13486,{value:r})}}function rs(r,t){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${t.path.canonicalString()}`}}function Zo(r){return!!r&&"integerValue"in r}function ss(r){return!!r&&"arrayValue"in r}function Wu(r){return!!r&&"nullValue"in r}function Qu(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function ei(r){return!!r&&"mapValue"in r}function Li(r){var e,n;return((n=(((e=r==null?void 0:r.mapValue)==null?void 0:e.fields)||{})[Ca])==null?void 0:n.stringValue)===Da}function Br(r){if(r.geoPointValue)return{geoPointValue:{...r.geoPointValue}};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:{...r.timestampValue}};if(r.mapValue){const t={mapValue:{fields:{}}};return Be(r.mapValue.fields,(e,n)=>t.mapValue.fields[e]=Br(n)),t}if(r.arrayValue){const t={arrayValue:{values:[]}};for(let e=0;e<(r.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=Br(r.arrayValue.values[e]);return t}return{...r}}function ud(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue===cd}const ld={mapValue:{fields:{[Ca]:{stringValue:Da},[Kn]:{arrayValue:{}}}}};function I_(r){return"nullValue"in r?Zs:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?rs(dn.empty(),O.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?Li(r)?ld:{mapValue:{}}:F(35942,{value:r})}function E_(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?rs(dn.empty(),O.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?ld:"mapValue"in r?Li(r)?{mapValue:{}}:Re:F(61959,{value:r})}function Xu(r,t){const e=Me(r.value,t.value);return e!==0?e:r.inclusive&&!t.inclusive?-1:!r.inclusive&&t.inclusive?1:0}function Ju(r,t){const e=Me(r.value,t.value);return e!==0?e:r.inclusive&&!t.inclusive?1:!r.inclusive&&t.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dt{constructor(t){this.value=t}static empty(){return new Dt({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!ei(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Br(e)}setAll(t){let e=lt.emptyPath(),n={},s=[];t.forEach((a,c)=>{if(!e.isImmediateParentOf(c)){const u=this.getFieldsMap(e);this.applyChanges(u,n,s),n={},s=[],e=c.popLast()}a?n[c.lastSegment()]=Br(a):s.push(c.lastSegment())});const i=this.getFieldsMap(e);this.applyChanges(i,n,s)}delete(t){const e=this.field(t.popLast());ei(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return oe(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let s=e.mapValue.fields[t.get(n)];ei(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,n){Be(e,(s,i)=>t[s]=i);for(const s of n)delete t[s]}clone(){return new Dt(Br(this.value))}}function hd(r){const t=[];return Be(r.fields,(e,n)=>{const s=new lt([e]);if(ei(n)){const i=hd(n.mapValue).fields;if(i.length===0)t.push(s);else for(const a of i)t.push(s.child(a))}else t.push(s)}),new Ut(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dt{constructor(t,e,n,s,i,a,c){this.key=t,this.documentType=e,this.version=n,this.readTime=s,this.createTime=i,this.data=a,this.documentState=c}static newInvalidDocument(t){return new dt(t,0,q.min(),q.min(),q.min(),Dt.empty(),0)}static newFoundDocument(t,e,n,s){return new dt(t,1,e,q.min(),n,s,0)}static newNoDocument(t,e){return new dt(t,2,e,q.min(),q.min(),Dt.empty(),0)}static newUnknownDocument(t,e){return new dt(t,3,e,q.min(),q.min(),Dt.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(q.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Dt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Dt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=q.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof dt&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new dt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wn{constructor(t,e){this.position=t,this.inclusive=e}}function Yu(r,t,e){let n=0;for(let s=0;s<r.position.length;s++){const i=t[s],a=r.position[s];if(i.field.isKeyField()?n=O.comparator(O.fromName(a.referenceValue),e.key):n=Me(a,e.data.field(i.field)),i.dir==="desc"&&(n*=-1),n!==0)break}return n}function Zu(r,t){if(r===null)return t===null;if(t===null||r.inclusive!==t.inclusive||r.position.length!==t.position.length)return!1;for(let e=0;e<r.position.length;e++)if(!oe(r.position[e],t.position[e]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class is{constructor(t,e="asc"){this.field=t,this.dir=e}}function v_(r,t){return r.dir===t.dir&&r.field.isEqual(t.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dd{}class Y extends dd{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,n):new w_(t,e,n):e==="array-contains"?new b_(t,n):e==="in"?new yd(t,n):e==="not-in"?new S_(t,n):e==="array-contains-any"?new R_(t,n):new Y(t,e,n)}static createKeyFieldInFilter(t,e,n){return e==="in"?new T_(t,n):new A_(t,n)}matches(t){const e=t.data.field(this.field);return this.op==="!="?e!==null&&e.nullValue===void 0&&this.matchesComparison(Me(e,this.value)):e!==null&&Ne(this.value)===Ne(e)&&this.matchesComparison(Me(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return F(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class st extends dd{constructor(t,e){super(),this.filters=t,this.op=e,this.Pe=null}static create(t,e){return new st(t,e)}matches(t){return Qn(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Qn(r){return r.op==="and"}function ta(r){return r.op==="or"}function ka(r){return fd(r)&&Qn(r)}function fd(r){for(const t of r.filters)if(t instanceof st)return!1;return!0}function ea(r){if(r instanceof Y)return r.field.canonicalString()+r.op.toString()+Hn(r.value);if(ka(r))return r.filters.map(t=>ea(t)).join(",");{const t=r.filters.map(e=>ea(e)).join(",");return`${r.op}(${t})`}}function md(r,t){return r instanceof Y?function(n,s){return s instanceof Y&&n.op===s.op&&n.field.isEqual(s.field)&&oe(n.value,s.value)}(r,t):r instanceof st?function(n,s){return s instanceof st&&n.op===s.op&&n.filters.length===s.filters.length?n.filters.reduce((i,a,c)=>i&&md(a,s.filters[c]),!0):!1}(r,t):void F(19439)}function pd(r,t){const e=r.filters.concat(t);return st.create(e,r.op)}function gd(r){return r instanceof Y?function(e){return`${e.field.canonicalString()} ${e.op} ${Hn(e.value)}`}(r):r instanceof st?function(e){return e.op.toString()+" {"+e.getFilters().map(gd).join(" ,")+"}"}(r):"Filter"}class w_ extends Y{constructor(t,e,n){super(t,e,n),this.key=O.fromName(n.referenceValue)}matches(t){const e=O.comparator(t.key,this.key);return this.matchesComparison(e)}}class T_ extends Y{constructor(t,e){super(t,"in",e),this.keys=_d("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class A_ extends Y{constructor(t,e){super(t,"not-in",e),this.keys=_d("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function _d(r,t){var e;return(((e=t.arrayValue)==null?void 0:e.values)||[]).map(n=>O.fromName(n.referenceValue))}class b_ extends Y{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return ss(e)&&ns(e.arrayValue,this.value)}}class yd extends Y{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return e!==null&&ns(this.value.arrayValue,e)}}class S_ extends Y{constructor(t,e){super(t,"not-in",e)}matches(t){if(ns(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return e!==null&&e.nullValue===void 0&&!ns(this.value.arrayValue,e)}}class R_ extends Y{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!ss(e)||!e.arrayValue.values)&&e.arrayValue.values.some(n=>ns(this.value.arrayValue,n))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x_{constructor(t,e=null,n=[],s=[],i=null,a=null,c=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=a,this.endAt=c,this.Te=null}}function na(r,t=null,e=[],n=[],s=null,i=null,a=null){return new x_(r,t,e,n,s,i,a)}function fn(r){const t=Q(r);if(t.Te===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(n=>ea(n)).join(","),e+="|ob:",e+=t.orderBy.map(n=>function(i){return i.field.canonicalString()+i.dir}(n)).join(","),Di(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(n=>Hn(n)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(n=>Hn(n)).join(",")),t.Te=e}return t.Te}function hs(r,t){if(r.limit!==t.limit||r.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<r.orderBy.length;e++)if(!v_(r.orderBy[e],t.orderBy[e]))return!1;if(r.filters.length!==t.filters.length)return!1;for(let e=0;e<r.filters.length;e++)if(!md(r.filters[e],t.filters[e]))return!1;return r.collectionGroup===t.collectionGroup&&!!r.path.isEqual(t.path)&&!!Zu(r.startAt,t.startAt)&&Zu(r.endAt,t.endAt)}function pi(r){return O.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}function gi(r,t){return r.filters.filter(e=>e instanceof Y&&e.field.isEqual(t))}function tl(r,t,e){let n=Zs,s=!0;for(const i of gi(r,t)){let a=Zs,c=!0;switch(i.op){case"<":case"<=":a=I_(i.value);break;case"==":case"in":case">=":a=i.value;break;case">":a=i.value,c=!1;break;case"!=":case"not-in":a=Zs}Xu({value:n,inclusive:s},{value:a,inclusive:c})<0&&(n=a,s=c)}if(e!==null){for(let i=0;i<r.orderBy.length;++i)if(r.orderBy[i].field.isEqual(t)){const a=e.position[i];Xu({value:n,inclusive:s},{value:a,inclusive:e.inclusive})<0&&(n=a,s=e.inclusive);break}}return{value:n,inclusive:s}}function el(r,t,e){let n=Re,s=!0;for(const i of gi(r,t)){let a=Re,c=!0;switch(i.op){case">=":case">":a=E_(i.value),c=!1;break;case"==":case"in":case"<=":a=i.value;break;case"<":a=i.value,c=!1;break;case"!=":case"not-in":a=Re}Ju({value:n,inclusive:s},{value:a,inclusive:c})>0&&(n=a,s=c)}if(e!==null){for(let i=0;i<r.orderBy.length;++i)if(r.orderBy[i].field.isEqual(t)){const a=e.position[i];Ju({value:n,inclusive:s},{value:a,inclusive:e.inclusive})>0&&(n=a,s=e.inclusive);break}}return{value:n,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nr{constructor(t,e=null,n=[],s=[],i=null,a="F",c=null,u=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=s,this.limit=i,this.limitType=a,this.startAt=c,this.endAt=u,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function P_(r,t,e,n,s,i,a,c){return new nr(r,t,e,n,s,i,a,c)}function Fi(r){return new nr(r)}function nl(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function Id(r){return r.collectionGroup!==null}function Ur(r){const t=Q(r);if(t.Ie===null){t.Ie=[];const e=new Set;for(const i of t.explicitOrderBy)t.Ie.push(i),e.add(i.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(a){let c=new it(lt.comparator);return a.filters.forEach(u=>{u.getFlattenedFilters().forEach(d=>{d.isInequality()&&(c=c.add(d.field))})}),c})(t).forEach(i=>{e.has(i.canonicalString())||i.isKeyField()||t.Ie.push(new is(i,n))}),e.has(lt.keyField().canonicalString())||t.Ie.push(new is(lt.keyField(),n))}return t.Ie}function Qt(r){const t=Q(r);return t.Ee||(t.Ee=V_(t,Ur(r))),t.Ee}function V_(r,t){if(r.limitType==="F")return na(r.path,r.collectionGroup,t,r.filters,r.limit,r.startAt,r.endAt);{t=t.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new is(s.field,i)});const e=r.endAt?new Wn(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new Wn(r.startAt.position,r.startAt.inclusive):null;return na(r.path,r.collectionGroup,t,r.filters,r.limit,e,n)}}function ra(r,t){const e=r.filters.concat([t]);return new nr(r.path,r.collectionGroup,r.explicitOrderBy.slice(),e,r.limit,r.limitType,r.startAt,r.endAt)}function sa(r,t,e){return new nr(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),t,e,r.startAt,r.endAt)}function ji(r,t){return hs(Qt(r),Qt(t))&&r.limitType===t.limitType}function Ed(r){return`${fn(Qt(r))}|lt:${r.limitType}`}function Dn(r){return`Query(target=${function(e){let n=e.path.canonicalString();return e.collectionGroup!==null&&(n+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(n+=`, filters: [${e.filters.map(s=>gd(s)).join(", ")}]`),Di(e.limit)||(n+=", limit: "+e.limit),e.orderBy.length>0&&(n+=`, orderBy: [${e.orderBy.map(s=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(s)).join(", ")}]`),e.startAt&&(n+=", startAt: ",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(s=>Hn(s)).join(",")),e.endAt&&(n+=", endAt: ",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(s=>Hn(s)).join(",")),`Target(${n})`}(Qt(r))}; limitType=${r.limitType})`}function ds(r,t){return t.isFoundDocument()&&function(n,s){const i=s.key.path;return n.collectionGroup!==null?s.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(i):O.isDocumentKey(n.path)?n.path.isEqual(i):n.path.isImmediateParentOf(i)}(r,t)&&function(n,s){for(const i of Ur(n))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(r,t)&&function(n,s){for(const i of n.filters)if(!i.matches(s))return!1;return!0}(r,t)&&function(n,s){return!(n.startAt&&!function(a,c,u){const d=Yu(a,c,u);return a.inclusive?d<=0:d<0}(n.startAt,Ur(n),s)||n.endAt&&!function(a,c,u){const d=Yu(a,c,u);return a.inclusive?d>=0:d>0}(n.endAt,Ur(n),s))}(r,t)}function C_(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function vd(r){return(t,e)=>{let n=!1;for(const s of Ur(r)){const i=D_(s,t,e);if(i!==0)return i;n=n||s.field.isKeyField()}return 0}}function D_(r,t,e){const n=r.field.isKeyField()?O.comparator(t.key,e.key):function(i,a,c){const u=a.data.field(i),d=c.data.field(i);return u!==null&&d!==null?Me(u,d):F(42886)}(r.field,t,e);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return F(19790,{direction:r.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ge{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(n!==void 0){for(const[s,i]of n)if(this.equalsFn(s,t))return i}}has(t){return this.get(t)!==void 0}set(t,e){const n=this.mapKeyFn(t),s=this.inner[n];if(s===void 0)return this.inner[n]=[[t,e]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],t))return void(s[i]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(n===void 0)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],t))return n.length===1?delete this.inner[e]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(t){Be(this.inner,(e,n)=>{for(const[s,i]of n)t(s,i)})}isEmpty(){return nd(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k_=new ut(O.comparator);function Gt(){return k_}const wd=new ut(O.comparator);function Vr(...r){let t=wd;for(const e of r)t=t.insert(e.key,e);return t}function Td(r){let t=wd;return r.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function re(){return qr()}function Ad(){return qr()}function qr(){return new ge(r=>r.toString(),(r,t)=>r.isEqual(t))}const N_=new ut(O.comparator),M_=new it(O.comparator);function J(...r){let t=M_;for(const e of r)t=t.add(e);return t}const O_=new it(W);function L_(){return O_}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Na(r,t){if(r.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Xr(t)?"-0":t}}function bd(r){return{integerValue:""+r}}function F_(r,t){return $g(t)?bd(t):Na(r,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bi{constructor(){this._=void 0}}function j_(r,t,e){return r instanceof os?function(s,i){const a={fields:{[id]:{stringValue:sd},[ad]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&Va(i)&&(i=Oi(i)),i&&(a.fields[od]=i),{mapValue:a}}(e,t):r instanceof Xn?Rd(r,t):r instanceof Jn?xd(r,t):function(s,i){const a=Sd(s,i),c=rl(a)+rl(s.Ae);return Zo(a)&&Zo(s.Ae)?bd(c):Na(s.serializer,c)}(r,t)}function B_(r,t,e){return r instanceof Xn?Rd(r,t):r instanceof Jn?xd(r,t):e}function Sd(r,t){return r instanceof as?function(n){return Zo(n)||function(i){return!!i&&"doubleValue"in i}(n)}(t)?t:{integerValue:0}:null}class os extends Bi{}class Xn extends Bi{constructor(t){super(),this.elements=t}}function Rd(r,t){const e=Pd(t);for(const n of r.elements)e.some(s=>oe(s,n))||e.push(n);return{arrayValue:{values:e}}}class Jn extends Bi{constructor(t){super(),this.elements=t}}function xd(r,t){let e=Pd(t);for(const n of r.elements)e=e.filter(s=>!oe(s,n));return{arrayValue:{values:e}}}class as extends Bi{constructor(t,e){super(),this.serializer=t,this.Ae=e}}function rl(r){return ct(r.integerValue||r.doubleValue)}function Pd(r){return ss(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U_{constructor(t,e){this.field=t,this.transform=e}}function q_(r,t){return r.field.isEqual(t.field)&&function(n,s){return n instanceof Xn&&s instanceof Xn||n instanceof Jn&&s instanceof Jn?Un(n.elements,s.elements,oe):n instanceof as&&s instanceof as?oe(n.Ae,s.Ae):n instanceof os&&s instanceof os}(r.transform,t.transform)}class z_{constructor(t,e){this.version=t,this.transformResults=e}}class It{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new It}static exists(t){return new It(void 0,t)}static updateTime(t){return new It(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function ni(r,t){return r.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(r.updateTime):r.exists===void 0||r.exists===t.isFoundDocument()}class Ui{}function Vd(r,t){if(!r.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return r.isNoDocument()?new fs(r.key,It.none()):new rr(r.key,r.data,It.none());{const e=r.data,n=Dt.empty();let s=new it(lt.comparator);for(let i of t.fields)if(!s.has(i)){let a=e.field(i);a===null&&i.length>1&&(i=i.popLast(),a=e.field(i)),a===null?n.delete(i):n.set(i,a),s=s.add(i)}return new _e(r.key,n,new Ut(s.toArray()),It.none())}}function $_(r,t,e){r instanceof rr?function(s,i,a){const c=s.value.clone(),u=il(s.fieldTransforms,i,a.transformResults);c.setAll(u),i.convertToFoundDocument(a.version,c).setHasCommittedMutations()}(r,t,e):r instanceof _e?function(s,i,a){if(!ni(s.precondition,i))return void i.convertToUnknownDocument(a.version);const c=il(s.fieldTransforms,i,a.transformResults),u=i.data;u.setAll(Cd(s)),u.setAll(c),i.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(r,t,e):function(s,i,a){i.convertToNoDocument(a.version).setHasCommittedMutations()}(0,t,e)}function zr(r,t,e,n){return r instanceof rr?function(i,a,c,u){if(!ni(i.precondition,a))return c;const d=i.value.clone(),f=ol(i.fieldTransforms,u,a);return d.setAll(f),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null}(r,t,e,n):r instanceof _e?function(i,a,c,u){if(!ni(i.precondition,a))return c;const d=ol(i.fieldTransforms,u,a),f=a.data;return f.setAll(Cd(i)),f.setAll(d),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),c===null?null:c.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(p=>p.field))}(r,t,e,n):function(i,a,c){return ni(i.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):c}(r,t,e)}function G_(r,t){let e=null;for(const n of r.fieldTransforms){const s=t.data.field(n.field),i=Sd(n.transform,s||null);i!=null&&(e===null&&(e=Dt.empty()),e.set(n.field,i))}return e||null}function sl(r,t){return r.type===t.type&&!!r.key.isEqual(t.key)&&!!r.precondition.isEqual(t.precondition)&&!!function(n,s){return n===void 0&&s===void 0||!(!n||!s)&&Un(n,s,(i,a)=>q_(i,a))}(r.fieldTransforms,t.fieldTransforms)&&(r.type===0?r.value.isEqual(t.value):r.type!==1||r.data.isEqual(t.data)&&r.fieldMask.isEqual(t.fieldMask))}class rr extends Ui{constructor(t,e,n,s=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class _e extends Ui{constructor(t,e,n,s,i=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Cd(r){const t=new Map;return r.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){const n=r.data.field(e);t.set(e,n)}}),t}function il(r,t,e){const n=new Map;U(r.length===e.length,32656,{Re:e.length,Ve:r.length});for(let s=0;s<e.length;s++){const i=r[s],a=i.transform,c=t.data.field(i.field);n.set(i.field,B_(a,c,e[s]))}return n}function ol(r,t,e){const n=new Map;for(const s of r){const i=s.transform,a=e.data.field(s.field);n.set(s.field,j_(i,a,t))}return n}class fs extends Ui{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Dd extends Ui{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ma{constructor(t,e,n,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(t.key)&&$_(i,t,n[s])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=zr(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=zr(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=Ad();return this.mutations.forEach(s=>{const i=t.get(s.key),a=i.overlayedDocument;let c=this.applyToLocalView(a,i.mutatedFields);c=e.has(s.key)?null:c;const u=Vd(a,c);u!==null&&n.set(s.key,u),a.isValidDocument()||a.convertToNoDocument(q.min())}),n}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),J())}isEqual(t){return this.batchId===t.batchId&&Un(this.mutations,t.mutations,(e,n)=>sl(e,n))&&Un(this.baseMutations,t.baseMutations,(e,n)=>sl(e,n))}}class Oa{constructor(t,e,n,s){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=s}static from(t,e,n){U(t.mutations.length===n.length,58842,{me:t.mutations.length,fe:n.length});let s=function(){return N_}();const i=t.mutations;for(let a=0;a<i.length;a++)s=s.insert(i[a].key,n[a].version);return new Oa(t,e,n,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class La{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K_{constructor(t,e){this.count=t,this.unchangedNames=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var gt,Z;function H_(r){switch(r){case P.OK:return F(64938);case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0;default:return F(15467,{code:r})}}function kd(r){if(r===void 0)return Ft("GRPC error has no .code"),P.UNKNOWN;switch(r){case gt.OK:return P.OK;case gt.CANCELLED:return P.CANCELLED;case gt.UNKNOWN:return P.UNKNOWN;case gt.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case gt.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case gt.INTERNAL:return P.INTERNAL;case gt.UNAVAILABLE:return P.UNAVAILABLE;case gt.UNAUTHENTICATED:return P.UNAUTHENTICATED;case gt.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case gt.NOT_FOUND:return P.NOT_FOUND;case gt.ALREADY_EXISTS:return P.ALREADY_EXISTS;case gt.PERMISSION_DENIED:return P.PERMISSION_DENIED;case gt.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case gt.ABORTED:return P.ABORTED;case gt.OUT_OF_RANGE:return P.OUT_OF_RANGE;case gt.UNIMPLEMENTED:return P.UNIMPLEMENTED;case gt.DATA_LOSS:return P.DATA_LOSS;default:return F(39323,{code:r})}}(Z=gt||(gt={}))[Z.OK=0]="OK",Z[Z.CANCELLED=1]="CANCELLED",Z[Z.UNKNOWN=2]="UNKNOWN",Z[Z.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Z[Z.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Z[Z.NOT_FOUND=5]="NOT_FOUND",Z[Z.ALREADY_EXISTS=6]="ALREADY_EXISTS",Z[Z.PERMISSION_DENIED=7]="PERMISSION_DENIED",Z[Z.UNAUTHENTICATED=16]="UNAUTHENTICATED",Z[Z.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Z[Z.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Z[Z.ABORTED=10]="ABORTED",Z[Z.OUT_OF_RANGE=11]="OUT_OF_RANGE",Z[Z.UNIMPLEMENTED=12]="UNIMPLEMENTED",Z[Z.INTERNAL=13]="INTERNAL",Z[Z.UNAVAILABLE=14]="UNAVAILABLE",Z[Z.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function W_(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q_=new Ve([4294967295,4294967295],0);function al(r){const t=W_().encode(r),e=new Ch;return e.update(t),new Uint8Array(e.digest())}function cl(r){const t=new DataView(r.buffer),e=t.getUint32(0,!0),n=t.getUint32(4,!0),s=t.getUint32(8,!0),i=t.getUint32(12,!0);return[new Ve([e,n],0),new Ve([s,i],0)]}class Fa{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new Cr(`Invalid padding: ${e}`);if(n<0)throw new Cr(`Invalid hash count: ${n}`);if(t.length>0&&this.hashCount===0)throw new Cr(`Invalid hash count: ${n}`);if(t.length===0&&e!==0)throw new Cr(`Invalid padding when bitmap length is 0: ${e}`);this.ge=8*t.length-e,this.pe=Ve.fromNumber(this.ge)}ye(t,e,n){let s=t.add(e.multiply(Ve.fromNumber(n)));return s.compare(Q_)===1&&(s=new Ve([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.ge===0)return!1;const e=al(t),[n,s]=cl(e);for(let i=0;i<this.hashCount;i++){const a=this.ye(n,s,i);if(!this.we(a))return!1}return!0}static create(t,e,n){const s=t%8==0?0:8-t%8,i=new Uint8Array(Math.ceil(t/8)),a=new Fa(i,s,e);return n.forEach(c=>a.insert(c)),a}insert(t){if(this.ge===0)return;const e=al(t),[n,s]=cl(e);for(let i=0;i<this.hashCount;i++){const a=this.ye(n,s,i);this.Se(a)}}Se(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class Cr extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qi{constructor(t,e,n,s,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const s=new Map;return s.set(t,ms.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new qi(q.min(),s,new ut(W),Gt(),J())}}class ms{constructor(t,e,n,s,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new ms(n,e,J(),J(),J())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ri{constructor(t,e,n,s){this.be=t,this.removedTargetIds=e,this.key=n,this.De=s}}class Nd{constructor(t,e){this.targetId=t,this.Ce=e}}class Md{constructor(t,e,n=yt.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=s}}class ul{constructor(){this.ve=0,this.Fe=ll(),this.Me=yt.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(t){t.approximateByteSize()>0&&(this.Oe=!0,this.Me=t)}ke(){let t=J(),e=J(),n=J();return this.Fe.forEach((s,i)=>{switch(i){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:n=n.add(s);break;default:F(38017,{changeType:i})}}),new ms(this.Me,this.xe,t,e,n)}qe(){this.Oe=!1,this.Fe=ll()}Qe(t,e){this.Oe=!0,this.Fe=this.Fe.insert(t,e)}$e(t){this.Oe=!0,this.Fe=this.Fe.remove(t)}Ue(){this.ve+=1}Ke(){this.ve-=1,U(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class X_{constructor(t){this.Ge=t,this.ze=new Map,this.je=Gt(),this.Je=$s(),this.He=$s(),this.Ye=new ut(W)}Ze(t){for(const e of t.be)t.De&&t.De.isFoundDocument()?this.Xe(e,t.De):this.et(e,t.key,t.De);for(const e of t.removedTargetIds)this.et(e,t.key,t.De)}tt(t){this.forEachTarget(t,e=>{const n=this.nt(e);switch(t.state){case 0:this.rt(e)&&n.Le(t.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(t.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(e);break;case 3:this.rt(e)&&(n.We(),n.Le(t.resumeToken));break;case 4:this.rt(e)&&(this.it(e),n.Le(t.resumeToken));break;default:F(56790,{state:t.state})}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ze.forEach((n,s)=>{this.rt(s)&&e(s)})}st(t){const e=t.targetId,n=t.Ce.count,s=this.ot(e);if(s){const i=s.target;if(pi(i))if(n===0){const a=new O(i.path);this.et(e,a,dt.newNoDocument(a,q.min()))}else U(n===1,20013,{expectedCount:n});else{const a=this._t(e);if(a!==n){const c=this.ut(t),u=c?this.ct(c,t,a):1;if(u!==0){this.it(e);const d=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(e,d)}}}}}ut(t){const e=t.Ce.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:n="",padding:s=0},hashCount:i=0}=e;let a,c;try{a=pe(n).toUint8Array()}catch(u){if(u instanceof rd)return Bn("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{c=new Fa(a,s,i)}catch(u){return Bn(u instanceof Cr?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return c.ge===0?null:c}ct(t,e,n){return e.Ce.count===n-this.Pt(t,e.targetId)?0:2}Pt(t,e){const n=this.Ge.getRemoteKeysForTarget(e);let s=0;return n.forEach(i=>{const a=this.Ge.ht(),c=`projects/${a.projectId}/databases/${a.database}/documents/${i.path.canonicalString()}`;t.mightContain(c)||(this.et(e,i,null),s++)}),s}Tt(t){const e=new Map;this.ze.forEach((i,a)=>{const c=this.ot(a);if(c){if(i.current&&pi(c.target)){const u=new O(c.target.path);this.It(u).has(a)||this.Et(a,u)||this.et(a,u,dt.newNoDocument(u,t))}i.Be&&(e.set(a,i.ke()),i.qe())}});let n=J();this.He.forEach((i,a)=>{let c=!0;a.forEachWhile(u=>{const d=this.ot(u);return!d||d.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)}),c&&(n=n.add(i))}),this.je.forEach((i,a)=>a.setReadTime(t));const s=new qi(t,e,this.Ye,this.je,n);return this.je=Gt(),this.Je=$s(),this.He=$s(),this.Ye=new ut(W),s}Xe(t,e){if(!this.rt(t))return;const n=this.Et(t,e.key)?2:0;this.nt(t).Qe(e.key,n),this.je=this.je.insert(e.key,e),this.Je=this.Je.insert(e.key,this.It(e.key).add(t)),this.He=this.He.insert(e.key,this.dt(e.key).add(t))}et(t,e,n){if(!this.rt(t))return;const s=this.nt(t);this.Et(t,e)?s.Qe(e,1):s.$e(e),this.He=this.He.insert(e,this.dt(e).delete(t)),this.He=this.He.insert(e,this.dt(e).add(t)),n&&(this.je=this.je.insert(e,n))}removeTarget(t){this.ze.delete(t)}_t(t){const e=this.nt(t).ke();return this.Ge.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Ue(t){this.nt(t).Ue()}nt(t){let e=this.ze.get(t);return e||(e=new ul,this.ze.set(t,e)),e}dt(t){let e=this.He.get(t);return e||(e=new it(W),this.He=this.He.insert(t,e)),e}It(t){let e=this.Je.get(t);return e||(e=new it(W),this.Je=this.Je.insert(t,e)),e}rt(t){const e=this.ot(t)!==null;return e||k("WatchChangeAggregator","Detected inactive target",t),e}ot(t){const e=this.ze.get(t);return e&&e.Ne?null:this.Ge.At(t)}it(t){this.ze.set(t,new ul),this.Ge.getRemoteKeysForTarget(t).forEach(e=>{this.et(t,e,null)})}Et(t,e){return this.Ge.getRemoteKeysForTarget(t).has(e)}}function $s(){return new ut(O.comparator)}function ll(){return new ut(O.comparator)}const J_={asc:"ASCENDING",desc:"DESCENDING"},Y_={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Z_={and:"AND",or:"OR"};class ty{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function ia(r,t){return r.useProto3Json||Di(t)?t:{value:t}}function Yn(r,t){return r.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Od(r,t){return r.useProto3Json?t.toBase64():t.toUint8Array()}function ey(r,t){return Yn(r,t.toTimestamp())}function jt(r){return U(!!r,49232),q.fromTimestamp(function(e){const n=me(e);return new rt(n.seconds,n.nanos)}(r))}function ja(r,t){return oa(r,t).canonicalString()}function oa(r,t){const e=function(s){return new nt(["projects",s.projectId,"databases",s.database])}(r).child("documents");return t===void 0?e:e.child(t)}function Ld(r){const t=nt.fromString(r);return U(Kd(t),10190,{key:t.toString()}),t}function _i(r,t){return ja(r.databaseId,t.path)}function cn(r,t){const e=Ld(t);if(e.get(1)!==r.databaseId.projectId)throw new N(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+r.databaseId.projectId);if(e.get(3)!==r.databaseId.database)throw new N(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+r.databaseId.database);return new O(Bd(e))}function Fd(r,t){return ja(r.databaseId,t)}function jd(r){const t=Ld(r);return t.length===4?nt.emptyPath():Bd(t)}function aa(r){return new nt(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function Bd(r){return U(r.length>4&&r.get(4)==="documents",29091,{key:r.toString()}),r.popFirst(5)}function hl(r,t,e){return{name:_i(r,t),fields:e.value.mapValue.fields}}function ny(r,t,e){const n=cn(r,t.name),s=jt(t.updateTime),i=t.createTime?jt(t.createTime):q.min(),a=new Dt({mapValue:{fields:t.fields}}),c=dt.newFoundDocument(n,s,i,a);return e&&c.setHasCommittedMutations(),e?c.setHasCommittedMutations():c}function ry(r,t){let e;if("targetChange"in t){t.targetChange;const n=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:F(39313,{state:d})}(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],i=function(d,f){return d.useProto3Json?(U(f===void 0||typeof f=="string",58123),yt.fromBase64String(f||"")):(U(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),yt.fromUint8Array(f||new Uint8Array))}(r,t.targetChange.resumeToken),a=t.targetChange.cause,c=a&&function(d){const f=d.code===void 0?P.UNKNOWN:kd(d.code);return new N(f,d.message||"")}(a);e=new Md(n,s,i,c||null)}else if("documentChange"in t){t.documentChange;const n=t.documentChange;n.document,n.document.name,n.document.updateTime;const s=cn(r,n.document.name),i=jt(n.document.updateTime),a=n.document.createTime?jt(n.document.createTime):q.min(),c=new Dt({mapValue:{fields:n.document.fields}}),u=dt.newFoundDocument(s,i,a,c),d=n.targetIds||[],f=n.removedTargetIds||[];e=new ri(d,f,u.key,u)}else if("documentDelete"in t){t.documentDelete;const n=t.documentDelete;n.document;const s=cn(r,n.document),i=n.readTime?jt(n.readTime):q.min(),a=dt.newNoDocument(s,i),c=n.removedTargetIds||[];e=new ri([],c,a.key,a)}else if("documentRemove"in t){t.documentRemove;const n=t.documentRemove;n.document;const s=cn(r,n.document),i=n.removedTargetIds||[];e=new ri([],i,s,null)}else{if(!("filter"in t))return F(11601,{Rt:t});{t.filter;const n=t.filter;n.targetId;const{count:s=0,unchangedNames:i}=n,a=new K_(s,i),c=n.targetId;e=new Nd(c,a)}}return e}function yi(r,t){let e;if(t instanceof rr)e={update:hl(r,t.key,t.value)};else if(t instanceof fs)e={delete:_i(r,t.key)};else if(t instanceof _e)e={update:hl(r,t.key,t.data),updateMask:uy(t.fieldMask)};else{if(!(t instanceof Dd))return F(16599,{Vt:t.type});e={verify:_i(r,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(n=>function(i,a){const c=a.transform;if(c instanceof os)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof Xn)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof Jn)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof as)return{fieldPath:a.field.canonicalString(),increment:c.Ae};throw F(20930,{transform:a.transform})}(0,n))),t.precondition.isNone||(e.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:ey(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:F(27497)}(r,t.precondition)),e}function ca(r,t){const e=t.currentDocument?function(i){return i.updateTime!==void 0?It.updateTime(jt(i.updateTime)):i.exists!==void 0?It.exists(i.exists):It.none()}(t.currentDocument):It.none(),n=t.updateTransforms?t.updateTransforms.map(s=>function(a,c){let u=null;if("setToServerValue"in c)U(c.setToServerValue==="REQUEST_TIME",16630,{proto:c}),u=new os;else if("appendMissingElements"in c){const f=c.appendMissingElements.values||[];u=new Xn(f)}else if("removeAllFromArray"in c){const f=c.removeAllFromArray.values||[];u=new Jn(f)}else"increment"in c?u=new as(a,c.increment):F(16584,{proto:c});const d=lt.fromServerFormat(c.fieldPath);return new U_(d,u)}(r,s)):[];if(t.update){t.update.name;const s=cn(r,t.update.name),i=new Dt({mapValue:{fields:t.update.fields}});if(t.updateMask){const a=function(u){const d=u.fieldPaths||[];return new Ut(d.map(f=>lt.fromServerFormat(f)))}(t.updateMask);return new _e(s,i,a,e,n)}return new rr(s,i,e,n)}if(t.delete){const s=cn(r,t.delete);return new fs(s,e)}if(t.verify){const s=cn(r,t.verify);return new Dd(s,e)}return F(1463,{proto:t})}function sy(r,t){return r&&r.length>0?(U(t!==void 0,14353),r.map(e=>function(s,i){let a=s.updateTime?jt(s.updateTime):jt(i);return a.isEqual(q.min())&&(a=jt(i)),new z_(a,s.transformResults||[])}(e,t))):[]}function Ud(r,t){return{documents:[Fd(r,t.path)]}}function qd(r,t){const e={structuredQuery:{}},n=t.path;let s;t.collectionGroup!==null?(s=n,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=n.popLast(),e.structuredQuery.from=[{collectionId:n.lastSegment()}]),e.parent=Fd(r,s);const i=function(d){if(d.length!==0)return Gd(st.create(d,"and"))}(t.filters);i&&(e.structuredQuery.where=i);const a=function(d){if(d.length!==0)return d.map(f=>function(g){return{field:kn(g.field),direction:oy(g.dir)}}(f))}(t.orderBy);a&&(e.structuredQuery.orderBy=a);const c=ia(r,t.limit);return c!==null&&(e.structuredQuery.limit=c),t.startAt&&(e.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(t.startAt)),t.endAt&&(e.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(t.endAt)),{ft:e,parent:s}}function zd(r){let t=jd(r.parent);const e=r.structuredQuery,n=e.from?e.from.length:0;let s=null;if(n>0){U(n===1,65062);const f=e.from[0];f.allDescendants?s=f.collectionId:t=t.child(f.collectionId)}let i=[];e.where&&(i=function(p){const g=$d(p);return g instanceof st&&ka(g)?g.getFilters():[g]}(e.where));let a=[];e.orderBy&&(a=function(p){return p.map(g=>function(V){return new is(Nn(V.field),function(D){switch(D){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(V.direction))}(g))}(e.orderBy));let c=null;e.limit&&(c=function(p){let g;return g=typeof p=="object"?p.value:p,Di(g)?null:g}(e.limit));let u=null;e.startAt&&(u=function(p){const g=!!p.before,S=p.values||[];return new Wn(S,g)}(e.startAt));let d=null;return e.endAt&&(d=function(p){const g=!p.before,S=p.values||[];return new Wn(S,g)}(e.endAt)),P_(t,s,a,i,c,"F",u,d)}function iy(r,t){const e=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return F(28987,{purpose:s})}}(t.purpose);return e==null?null:{"goog-listen-tags":e}}function $d(r){return r.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":const n=Nn(e.unaryFilter.field);return Y.create(n,"==",{doubleValue:NaN});case"IS_NULL":const s=Nn(e.unaryFilter.field);return Y.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Nn(e.unaryFilter.field);return Y.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Nn(e.unaryFilter.field);return Y.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return F(61313);default:return F(60726)}}(r):r.fieldFilter!==void 0?function(e){return Y.create(Nn(e.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return F(58110);default:return F(50506)}}(e.fieldFilter.op),e.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(e){return st.create(e.compositeFilter.filters.map(n=>$d(n)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return F(1026)}}(e.compositeFilter.op))}(r):F(30097,{filter:r})}function oy(r){return J_[r]}function ay(r){return Y_[r]}function cy(r){return Z_[r]}function kn(r){return{fieldPath:r.canonicalString()}}function Nn(r){return lt.fromServerFormat(r.fieldPath)}function Gd(r){return r instanceof Y?function(e){if(e.op==="=="){if(Qu(e.value))return{unaryFilter:{field:kn(e.field),op:"IS_NAN"}};if(Wu(e.value))return{unaryFilter:{field:kn(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(Qu(e.value))return{unaryFilter:{field:kn(e.field),op:"IS_NOT_NAN"}};if(Wu(e.value))return{unaryFilter:{field:kn(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:kn(e.field),op:ay(e.op),value:e.value}}}(r):r instanceof st?function(e){const n=e.getFilters().map(s=>Gd(s));return n.length===1?n[0]:{compositeFilter:{op:cy(e.op),filters:n}}}(r):F(54877,{filter:r})}function uy(r){const t=[];return r.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function Kd(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class de{constructor(t,e,n,s,i=q.min(),a=q.min(),c=yt.EMPTY_BYTE_STRING,u=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=c,this.expectedCount=u}withSequenceNumber(t){return new de(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new de(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new de(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new de(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hd{constructor(t){this.yt=t}}function ly(r,t){let e;if(t.document)e=ny(r.yt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const n=O.fromSegments(t.noDocument.path),s=pn(t.noDocument.readTime);e=dt.newNoDocument(n,s),t.hasCommittedMutations&&e.setHasCommittedMutations()}else{if(!t.unknownDocument)return F(56709);{const n=O.fromSegments(t.unknownDocument.path),s=pn(t.unknownDocument.version);e=dt.newUnknownDocument(n,s)}}return t.readTime&&e.setReadTime(function(s){const i=new rt(s[0],s[1]);return q.fromTimestamp(i)}(t.readTime)),e}function dl(r,t){const e=t.key,n={prefixPath:e.getCollectionPath().popLast().toArray(),collectionGroup:e.collectionGroup,documentId:e.path.lastSegment(),readTime:Ii(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())n.document=function(i,a){return{name:_i(i,a.key),fields:a.data.value.mapValue.fields,updateTime:Yn(i,a.version.toTimestamp()),createTime:Yn(i,a.createTime.toTimestamp())}}(r.yt,t);else if(t.isNoDocument())n.noDocument={path:e.path.toArray(),readTime:mn(t.version)};else{if(!t.isUnknownDocument())return F(57904,{document:t});n.unknownDocument={path:e.path.toArray(),version:mn(t.version)}}return n}function Ii(r){const t=r.toTimestamp();return[t.seconds,t.nanoseconds]}function mn(r){const t=r.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function pn(r){const t=new rt(r.seconds,r.nanoseconds);return q.fromTimestamp(t)}function Ye(r,t){const e=(t.baseMutations||[]).map(i=>ca(r.yt,i));for(let i=0;i<t.mutations.length-1;++i){const a=t.mutations[i];if(i+1<t.mutations.length&&t.mutations[i+1].transform!==void 0){const c=t.mutations[i+1];a.updateTransforms=c.transform.fieldTransforms,t.mutations.splice(i+1,1),++i}}const n=t.mutations.map(i=>ca(r.yt,i)),s=rt.fromMillis(t.localWriteTimeMs);return new Ma(t.batchId,s,e,n)}function Dr(r){const t=pn(r.readTime),e=r.lastLimboFreeSnapshotVersion!==void 0?pn(r.lastLimboFreeSnapshotVersion):q.min();let n;return n=function(i){return i.documents!==void 0}(r.query)?function(i){const a=i.documents.length;return U(a===1,1966,{count:a}),Qt(Fi(jd(i.documents[0])))}(r.query):function(i){return Qt(zd(i))}(r.query),new de(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,t,e,yt.fromBase64String(r.resumeToken))}function Wd(r,t){const e=mn(t.snapshotVersion),n=mn(t.lastLimboFreeSnapshotVersion);let s;s=pi(t.target)?Ud(r.yt,t.target):qd(r.yt,t.target).ft;const i=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:fn(t.target),readTime:e,resumeToken:i,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:s}}function Qd(r){const t=zd({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?sa(t,t.limit,"L"):t}function Do(r,t){return new La(t.largestBatchId,ca(r.yt,t.overlayMutation))}function fl(r,t){const e=t.path.lastSegment();return[r,kt(t.path.popLast()),e]}function ml(r,t,e,n){return{indexId:r,uid:t,sequenceNumber:e,readTime:mn(n.readTime),documentKey:kt(n.documentKey.path),largestBatchId:n.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hy{getBundleMetadata(t,e){return pl(t).get(e).next(n=>{if(n)return function(i){return{id:i.bundleId,createTime:pn(i.createTime),version:i.version}}(n)})}saveBundleMetadata(t,e){return pl(t).put(function(s){return{bundleId:s.id,createTime:mn(jt(s.createTime)),version:s.version}}(e))}getNamedQuery(t,e){return gl(t).get(e).next(n=>{if(n)return function(i){return{name:i.name,query:Qd(i.bundledQuery),readTime:pn(i.readTime)}}(n)})}saveNamedQuery(t,e){return gl(t).put(function(s){return{name:s.name,readTime:mn(jt(s.readTime)),bundledQuery:s.bundledQuery}}(e))}}function pl(r){return Et(r,ki)}function gl(r){return Et(r,Ni)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zi{constructor(t,e){this.serializer=t,this.userId=e}static wt(t,e){const n=e.uid||"";return new zi(t,n)}getOverlay(t,e){return wr(t).get(fl(this.userId,e)).next(n=>n?Do(this.serializer,n):null)}getOverlays(t,e){const n=re();return b.forEach(e,s=>this.getOverlay(t,s).next(i=>{i!==null&&n.set(s,i)})).next(()=>n)}saveOverlays(t,e,n){const s=[];return n.forEach((i,a)=>{const c=new La(e,a);s.push(this.St(t,c))}),b.waitFor(s)}removeOverlaysForBatchId(t,e,n){const s=new Set;e.forEach(a=>s.add(kt(a.getCollectionPath())));const i=[];return s.forEach(a=>{const c=IDBKeyRange.bound([this.userId,a,n],[this.userId,a,n+1],!1,!0);i.push(wr(t).Z(Xo,c))}),b.waitFor(i)}getOverlaysForCollection(t,e,n){const s=re(),i=kt(e),a=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return wr(t).J(Xo,a).next(c=>{for(const u of c){const d=Do(this.serializer,u);s.set(d.getKey(),d)}return s})}getOverlaysForCollectionGroup(t,e,n,s){const i=re();let a;const c=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,Number.POSITIVE_INFINITY],!0);return wr(t).ee({index:Jh,range:c},(u,d,f)=>{const p=Do(this.serializer,d);i.size()<s||p.largestBatchId===a?(i.set(p.getKey(),p),a=p.largestBatchId):f.done()}).next(()=>i)}St(t,e){return wr(t).put(function(s,i,a){const[c,u,d]=fl(i,a.mutation.key);return{userId:i,collectionPath:u,documentId:d,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:yi(s.yt,a.mutation)}}(this.serializer,this.userId,e))}}function wr(r){return Et(r,Mi)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dy{bt(t){return Et(t,xa)}getSessionToken(t){return this.bt(t).get("sessionToken").next(e=>{const n=e==null?void 0:e.value;return n?yt.fromUint8Array(n):yt.EMPTY_BYTE_STRING})}setSessionToken(t,e){return this.bt(t).put({name:"sessionToken",value:e.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ze{constructor(){}Dt(t,e){this.Ct(t,e),e.vt()}Ct(t,e){if("nullValue"in t)this.Ft(e,5);else if("booleanValue"in t)this.Ft(e,10),e.Mt(t.booleanValue?1:0);else if("integerValue"in t)this.Ft(e,15),e.Mt(ct(t.integerValue));else if("doubleValue"in t){const n=ct(t.doubleValue);isNaN(n)?this.Ft(e,13):(this.Ft(e,15),Xr(n)?e.Mt(0):e.Mt(n))}else if("timestampValue"in t){let n=t.timestampValue;this.Ft(e,20),typeof n=="string"&&(n=me(n)),e.xt(`${n.seconds||""}`),e.Mt(n.nanos||0)}else if("stringValue"in t)this.Ot(t.stringValue,e),this.Nt(e);else if("bytesValue"in t)this.Ft(e,30),e.Bt(pe(t.bytesValue)),this.Nt(e);else if("referenceValue"in t)this.Lt(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.Ft(e,45),e.Mt(n.latitude||0),e.Mt(n.longitude||0)}else"mapValue"in t?ud(t)?this.Ft(e,Number.MAX_SAFE_INTEGER):Li(t)?this.kt(t.mapValue,e):(this.qt(t.mapValue,e),this.Nt(e)):"arrayValue"in t?(this.Qt(t.arrayValue,e),this.Nt(e)):F(19022,{$t:t})}Ot(t,e){this.Ft(e,25),this.Ut(t,e)}Ut(t,e){e.xt(t)}qt(t,e){const n=t.fields||{};this.Ft(e,55);for(const s of Object.keys(n))this.Ot(s,e),this.Ct(n[s],e)}kt(t,e){var a,c;const n=t.fields||{};this.Ft(e,53);const s=Kn,i=((c=(a=n[s].arrayValue)==null?void 0:a.values)==null?void 0:c.length)||0;this.Ft(e,15),e.Mt(ct(i)),this.Ot(s,e),this.Ct(n[s],e)}Qt(t,e){const n=t.values||[];this.Ft(e,50);for(const s of n)this.Ct(s,e)}Lt(t,e){this.Ft(e,37),O.fromName(t).path.forEach(n=>{this.Ft(e,60),this.Ut(n,e)})}Ft(t,e){t.Mt(e)}Nt(t){t.Mt(2)}}Ze.Kt=new Ze;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rn=255;function fy(r){if(r===0)return 8;let t=0;return r>>4||(t+=4,r<<=4),r>>6||(t+=2,r<<=2),r>>7||(t+=1),t}function _l(r){const t=64-function(n){let s=0;for(let i=0;i<8;++i){const a=fy(255&n[i]);if(s+=a,a!==8)break}return s}(r);return Math.ceil(t/8)}class my{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(t){const e=t[Symbol.iterator]();let n=e.next();for(;!n.done;)this.Gt(n.value),n=e.next();this.zt()}jt(t){const e=t[Symbol.iterator]();let n=e.next();for(;!n.done;)this.Jt(n.value),n=e.next();this.Ht()}Yt(t){for(const e of t){const n=e.charCodeAt(0);if(n<128)this.Gt(n);else if(n<2048)this.Gt(960|n>>>6),this.Gt(128|63&n);else if(e<"\uD800"||"\uDBFF"<e)this.Gt(480|n>>>12),this.Gt(128|63&n>>>6),this.Gt(128|63&n);else{const s=e.codePointAt(0);this.Gt(240|s>>>18),this.Gt(128|63&s>>>12),this.Gt(128|63&s>>>6),this.Gt(128|63&s)}}this.zt()}Zt(t){for(const e of t){const n=e.charCodeAt(0);if(n<128)this.Jt(n);else if(n<2048)this.Jt(960|n>>>6),this.Jt(128|63&n);else if(e<"\uD800"||"\uDBFF"<e)this.Jt(480|n>>>12),this.Jt(128|63&n>>>6),this.Jt(128|63&n);else{const s=e.codePointAt(0);this.Jt(240|s>>>18),this.Jt(128|63&s>>>12),this.Jt(128|63&s>>>6),this.Jt(128|63&s)}}this.Ht()}Xt(t){const e=this.en(t),n=_l(e);this.tn(1+n),this.buffer[this.position++]=255&n;for(let s=e.length-n;s<e.length;++s)this.buffer[this.position++]=255&e[s]}nn(t){const e=this.en(t),n=_l(e);this.tn(1+n),this.buffer[this.position++]=~(255&n);for(let s=e.length-n;s<e.length;++s)this.buffer[this.position++]=~(255&e[s])}rn(){this.sn(Rn),this.sn(255)}_n(){this.an(Rn),this.an(255)}reset(){this.position=0}seed(t){this.tn(t.length),this.buffer.set(t,this.position),this.position+=t.length}un(){return this.buffer.slice(0,this.position)}en(t){const e=function(i){const a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,i,!1),new Uint8Array(a.buffer)}(t),n=!!(128&e[0]);e[0]^=n?255:128;for(let s=1;s<e.length;++s)e[s]^=n?255:0;return e}Gt(t){const e=255&t;e===0?(this.sn(0),this.sn(255)):e===Rn?(this.sn(Rn),this.sn(0)):this.sn(e)}Jt(t){const e=255&t;e===0?(this.an(0),this.an(255)):e===Rn?(this.an(Rn),this.an(0)):this.an(t)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(t){this.tn(1),this.buffer[this.position++]=t}an(t){this.tn(1),this.buffer[this.position++]=~t}tn(t){const e=t+this.position;if(e<=this.buffer.length)return;let n=2*this.buffer.length;n<e&&(n=e);const s=new Uint8Array(n);s.set(this.buffer),this.buffer=s}}class py{constructor(t){this.cn=t}Bt(t){this.cn.Wt(t)}xt(t){this.cn.Yt(t)}Mt(t){this.cn.Xt(t)}vt(){this.cn.rn()}}class gy{constructor(t){this.cn=t}Bt(t){this.cn.jt(t)}xt(t){this.cn.Zt(t)}Mt(t){this.cn.nn(t)}vt(){this.cn._n()}}class Tr{constructor(){this.cn=new my,this.ln=new py(this.cn),this.hn=new gy(this.cn)}seed(t){this.cn.seed(t)}Pn(t){return t===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tn{constructor(t,e,n,s){this.Tn=t,this.In=e,this.En=n,this.dn=s}An(){const t=this.dn.length,e=t===0||this.dn[t-1]===255?t+1:t,n=new Uint8Array(e);return n.set(this.dn,0),e!==t?n.set([0],this.dn.length):++n[n.length-1],new tn(this.Tn,this.In,this.En,n)}Rn(t,e,n){return{indexId:this.Tn,uid:t,arrayValue:si(this.En),directionalValue:si(this.dn),orderedDocumentKey:si(e),documentKey:n.path.toArray()}}Vn(t,e,n){const s=this.Rn(t,e,n);return[s.indexId,s.uid,s.arrayValue,s.directionalValue,s.orderedDocumentKey,s.documentKey]}}function we(r,t){let e=r.Tn-t.Tn;return e!==0?e:(e=yl(r.En,t.En),e!==0?e:(e=yl(r.dn,t.dn),e!==0?e:O.comparator(r.In,t.In)))}function yl(r,t){for(let e=0;e<r.length&&e<t.length;++e){const n=r[e]-t[e];if(n!==0)return n}return r.length-t.length}function si(r){return vh()?function(e){let n="";for(let s=0;s<e.length;s++)n+=String.fromCharCode(e[s]);return n}(r):r}function Il(r){return typeof r!="string"?r:function(e){const n=new Uint8Array(e.length);for(let s=0;s<e.length;s++)n[s]=e.charCodeAt(s);return n}(r)}class El{constructor(t){this.mn=new it((e,n)=>lt.comparator(e.field,n.field)),this.collectionId=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment(),this.fn=t.orderBy,this.gn=[];for(const e of t.filters){const n=e;n.isInequality()?this.mn=this.mn.add(n):this.gn.push(n)}}get pn(){return this.mn.size>1}yn(t){if(U(t.collectionGroup===this.collectionId,49279),this.pn)return!1;const e=Ho(t);if(e!==void 0&&!this.wn(e))return!1;const n=Qe(t);let s=new Set,i=0,a=0;for(;i<n.length&&this.wn(n[i]);++i)s=s.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(this.mn.size>0){const c=this.mn.getIterator().getNext();if(!s.has(c.field.canonicalString())){const u=n[i];if(!this.Sn(c,u)||!this.bn(this.fn[a++],u))return!1}++i}for(;i<n.length;++i){const c=n[i];if(a>=this.fn.length||!this.bn(this.fn[a++],c))return!1}return!0}Dn(){if(this.pn)return null;let t=new it(lt.comparator);const e=[];for(const n of this.gn)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")e.push(new Xs(n.field,2));else{if(t.has(n.field))continue;t=t.add(n.field),e.push(new Xs(n.field,0))}for(const n of this.fn)n.field.isKeyField()||t.has(n.field)||(t=t.add(n.field),e.push(new Xs(n.field,n.dir==="asc"?0:1)));return new hi(hi.UNKNOWN_ID,this.collectionId,e,Qr.empty())}wn(t){for(const e of this.gn)if(this.Sn(e,t))return!0;return!1}Sn(t,e){if(t===void 0||!t.field.isEqual(e.fieldPath))return!1;const n=t.op==="array-contains"||t.op==="array-contains-any";return e.kind===2===n}bn(t,e){return!!t.field.isEqual(e.fieldPath)&&(e.kind===0&&t.dir==="asc"||e.kind===1&&t.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xd(r){var e,n;if(U(r instanceof Y||r instanceof st,20012),r instanceof Y){if(r instanceof yd){const s=((n=(e=r.value.arrayValue)==null?void 0:e.values)==null?void 0:n.map(i=>Y.create(r.field,"==",i)))||[];return st.create(s,"or")}return r}const t=r.filters.map(s=>Xd(s));return st.create(t,r.op)}function _y(r){if(r.getFilters().length===0)return[];const t=ha(Xd(r));return U(Jd(t),7391),ua(t)||la(t)?[t]:t.getFilters()}function ua(r){return r instanceof Y}function la(r){return r instanceof st&&ka(r)}function Jd(r){return ua(r)||la(r)||function(e){if(e instanceof st&&ta(e)){for(const n of e.getFilters())if(!ua(n)&&!la(n))return!1;return!0}return!1}(r)}function ha(r){if(U(r instanceof Y||r instanceof st,34018),r instanceof Y)return r;if(r.filters.length===1)return ha(r.filters[0]);const t=r.filters.map(n=>ha(n));let e=st.create(t,r.op);return e=Ei(e),Jd(e)?e:(U(e instanceof st,64498),U(Qn(e),40251),U(e.filters.length>1,57927),e.filters.reduce((n,s)=>Ba(n,s)))}function Ba(r,t){let e;return U(r instanceof Y||r instanceof st,38388),U(t instanceof Y||t instanceof st,25473),e=r instanceof Y?t instanceof Y?function(s,i){return st.create([s,i],"and")}(r,t):vl(r,t):t instanceof Y?vl(t,r):function(s,i){if(U(s.filters.length>0&&i.filters.length>0,48005),Qn(s)&&Qn(i))return pd(s,i.getFilters());const a=ta(s)?s:i,c=ta(s)?i:s,u=a.filters.map(d=>Ba(d,c));return st.create(u,"or")}(r,t),Ei(e)}function vl(r,t){if(Qn(t))return pd(t,r.getFilters());{const e=t.filters.map(n=>Ba(r,n));return st.create(e,"or")}}function Ei(r){if(U(r instanceof Y||r instanceof st,11850),r instanceof Y)return r;const t=r.getFilters();if(t.length===1)return Ei(t[0]);if(fd(r))return r;const e=t.map(s=>Ei(s)),n=[];return e.forEach(s=>{s instanceof Y?n.push(s):s instanceof st&&(s.op===r.op?n.push(...s.filters):n.push(s))}),n.length===1?n[0]:st.create(n,r.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yy{constructor(){this.Cn=new Ua}addToCollectionParentIndex(t,e){return this.Cn.add(e),b.resolve()}getCollectionParents(t,e){return b.resolve(this.Cn.getEntries(e))}addFieldIndex(t,e){return b.resolve()}deleteFieldIndex(t,e){return b.resolve()}deleteAllFieldIndexes(t){return b.resolve()}createTargetIndexes(t,e){return b.resolve()}getDocumentsMatchingTarget(t,e){return b.resolve(null)}getIndexType(t,e){return b.resolve(0)}getFieldIndexes(t,e){return b.resolve([])}getNextCollectionGroupToUpdate(t){return b.resolve(null)}getMinOffset(t,e){return b.resolve(Kt.min())}getMinOffsetFromCollectionGroup(t,e){return b.resolve(Kt.min())}updateCollectionGroup(t,e,n){return b.resolve()}updateIndexEntries(t,e){return b.resolve()}}class Ua{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e]||new it(nt.comparator),i=!s.has(n);return this.index[e]=s.add(n),i}has(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e];return s&&s.has(n)}getEntries(t){return(this.index[t]||new it(nt.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wl="IndexedDbIndexManager",Gs=new Uint8Array(0);class Iy{constructor(t,e){this.databaseId=e,this.vn=new Ua,this.Fn=new ge(n=>fn(n),(n,s)=>hs(n,s)),this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this.vn.has(e)){const n=e.lastSegment(),s=e.popLast();t.addOnCommittedListener(()=>{this.vn.add(e)});const i={collectionId:n,parent:kt(s)};return Tl(t).put(i)}return b.resolve()}getCollectionParents(t,e){const n=[],s=IDBKeyRange.bound([e,""],[jh(e),""],!1,!0);return Tl(t).J(s).next(i=>{for(const a of i){if(a.collectionId!==e)break;n.push(ne(a.parent))}return n})}addFieldIndex(t,e){const n=Ar(t),s=function(c){return{indexId:c.indexId,collectionGroup:c.collectionGroup,fields:c.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])}}(e);delete s.indexId;const i=n.add(s);if(e.indexState){const a=Pn(t);return i.next(c=>{a.put(ml(c,this.uid,e.indexState.sequenceNumber,e.indexState.offset))})}return i.next()}deleteFieldIndex(t,e){const n=Ar(t),s=Pn(t),i=xn(t);return n.delete(e.indexId).next(()=>s.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))}deleteAllFieldIndexes(t){const e=Ar(t),n=xn(t),s=Pn(t);return e.Z().next(()=>n.Z()).next(()=>s.Z())}createTargetIndexes(t,e){return b.forEach(this.Mn(e),n=>this.getIndexType(t,n).next(s=>{if(s===0||s===1){const i=new El(n).Dn();if(i!=null)return this.addFieldIndex(t,i)}}))}getDocumentsMatchingTarget(t,e){const n=xn(t);let s=!0;const i=new Map;return b.forEach(this.Mn(e),a=>this.xn(t,a).next(c=>{s&&(s=!!c),i.set(a,c)})).next(()=>{if(s){let a=J();const c=[];return b.forEach(i,(u,d)=>{k(wl,`Using index ${function(L){return`id=${L.indexId}|cg=${L.collectionGroup}|f=${L.fields.map(j=>`${j.fieldPath}:${j.kind}`).join(",")}`}(u)} to execute ${fn(e)}`);const f=function(L,j){const $=Ho(j);if($===void 0)return null;for(const H of gi(L,$.fieldPath))switch(H.op){case"array-contains-any":return H.value.arrayValue.values||[];case"array-contains":return[H.value]}return null}(d,u),p=function(L,j){const $=new Map;for(const H of Qe(j))for(const v of gi(L,H.fieldPath))switch(v.op){case"==":case"in":$.set(H.fieldPath.canonicalString(),v.value);break;case"not-in":case"!=":return $.set(H.fieldPath.canonicalString(),v.value),Array.from($.values())}return null}(d,u),g=function(L,j){const $=[];let H=!0;for(const v of Qe(j)){const y=v.kind===0?tl(L,v.fieldPath,L.startAt):el(L,v.fieldPath,L.startAt);$.push(y.value),H&&(H=y.inclusive)}return new Wn($,H)}(d,u),S=function(L,j){const $=[];let H=!0;for(const v of Qe(j)){const y=v.kind===0?el(L,v.fieldPath,L.endAt):tl(L,v.fieldPath,L.endAt);$.push(y.value),H&&(H=y.inclusive)}return new Wn($,H)}(d,u),V=this.On(u,d,g),C=this.On(u,d,S),D=this.Nn(u,d,p),z=this.Bn(u.indexId,f,V,g.inclusive,C,S.inclusive,D);return b.forEach(z,B=>n.Y(B,e.limit).next(L=>{L.forEach(j=>{const $=O.fromSegments(j.documentKey);a.has($)||(a=a.add($),c.push($))})}))}).next(()=>c)}return b.resolve(null)})}Mn(t){let e=this.Fn.get(t);return e||(t.filters.length===0?e=[t]:e=_y(st.create(t.filters,"and")).map(n=>na(t.path,t.collectionGroup,t.orderBy,n.getFilters(),t.limit,t.startAt,t.endAt)),this.Fn.set(t,e),e)}Bn(t,e,n,s,i,a,c){const u=(e!=null?e.length:1)*Math.max(n.length,i.length),d=u/(e!=null?e.length:1),f=[];for(let p=0;p<u;++p){const g=e?this.Ln(e[p/d]):Gs,S=this.kn(t,g,n[p%d],s),V=this.qn(t,g,i[p%d],a),C=c.map(D=>this.kn(t,g,D,!0));f.push(...this.createRange(S,V,C))}return f}kn(t,e,n,s){const i=new tn(t,O.empty(),e,n);return s?i:i.An()}qn(t,e,n,s){const i=new tn(t,O.empty(),e,n);return s?i.An():i}xn(t,e){const n=new El(e),s=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment();return this.getFieldIndexes(t,s).next(i=>{let a=null;for(const c of i)n.yn(c)&&(!a||c.fields.length>a.fields.length)&&(a=c);return a})}getIndexType(t,e){let n=2;const s=this.Mn(e);return b.forEach(s,i=>this.xn(t,i).next(a=>{a?n!==0&&a.fields.length<function(u){let d=new it(lt.comparator),f=!1;for(const p of u.filters)for(const g of p.getFlattenedFilters())g.field.isKeyField()||(g.op==="array-contains"||g.op==="array-contains-any"?f=!0:d=d.add(g.field));for(const p of u.orderBy)p.field.isKeyField()||(d=d.add(p.field));return d.size+(f?1:0)}(i)&&(n=1):n=0})).next(()=>function(a){return a.limit!==null}(e)&&s.length>1&&n===2?1:n)}Qn(t,e){const n=new Tr;for(const s of Qe(t)){const i=e.data.field(s.fieldPath);if(i==null)return null;const a=n.Pn(s.kind);Ze.Kt.Dt(i,a)}return n.un()}Ln(t){const e=new Tr;return Ze.Kt.Dt(t,e.Pn(0)),e.un()}$n(t,e){const n=new Tr;return Ze.Kt.Dt(rs(this.databaseId,e),n.Pn(function(i){const a=Qe(i);return a.length===0?0:a[a.length-1].kind}(t))),n.un()}Nn(t,e,n){if(n===null)return[];let s=[];s.push(new Tr);let i=0;for(const a of Qe(t)){const c=n[i++];for(const u of s)if(this.Un(e,a.fieldPath)&&ss(c))s=this.Kn(s,a,c);else{const d=u.Pn(a.kind);Ze.Kt.Dt(c,d)}}return this.Wn(s)}On(t,e,n){return this.Nn(t,e,n.position)}Wn(t){const e=[];for(let n=0;n<t.length;++n)e[n]=t[n].un();return e}Kn(t,e,n){const s=[...t],i=[];for(const a of n.arrayValue.values||[])for(const c of s){const u=new Tr;u.seed(c.un()),Ze.Kt.Dt(a,u.Pn(e.kind)),i.push(u)}return i}Un(t,e){return!!t.filters.find(n=>n instanceof Y&&n.field.isEqual(e)&&(n.op==="in"||n.op==="not-in"))}getFieldIndexes(t,e){const n=Ar(t),s=Pn(t);return(e?n.J(Qo,IDBKeyRange.bound(e,e)):n.J()).next(i=>{const a=[];return b.forEach(i,c=>s.get([c.indexId,this.uid]).next(u=>{a.push(function(f,p){const g=p?new Qr(p.sequenceNumber,new Kt(pn(p.readTime),new O(ne(p.documentKey)),p.largestBatchId)):Qr.empty(),S=f.fields.map(([V,C])=>new Xs(lt.fromServerFormat(V),C));return new hi(f.indexId,f.collectionGroup,S,g)}(c,u))})).next(()=>a)})}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next(e=>e.length===0?null:(e.sort((n,s)=>{const i=n.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:W(n.collectionGroup,s.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(t,e,n){const s=Ar(t),i=Pn(t);return this.Gn(t).next(a=>s.J(Qo,IDBKeyRange.bound(e,e)).next(c=>b.forEach(c,u=>i.put(ml(u.indexId,this.uid,a,n)))))}updateIndexEntries(t,e){const n=new Map;return b.forEach(e,(s,i)=>{const a=n.get(s.collectionGroup);return(a?b.resolve(a):this.getFieldIndexes(t,s.collectionGroup)).next(c=>(n.set(s.collectionGroup,c),b.forEach(c,u=>this.zn(t,s,u).next(d=>{const f=this.jn(i,u);return d.isEqual(f)?b.resolve():this.Jn(t,i,u,d,f)}))))})}Hn(t,e,n,s){return xn(t).put(s.Rn(this.uid,this.$n(n,e.key),e.key))}Yn(t,e,n,s){return xn(t).delete(s.Vn(this.uid,this.$n(n,e.key),e.key))}zn(t,e,n){const s=xn(t);let i=new it(we);return s.ee({index:Xh,range:IDBKeyRange.only([n.indexId,this.uid,si(this.$n(n,e))])},(a,c)=>{i=i.add(new tn(n.indexId,e,Il(c.arrayValue),Il(c.directionalValue)))}).next(()=>i)}jn(t,e){let n=new it(we);const s=this.Qn(e,t);if(s==null)return n;const i=Ho(e);if(i!=null){const a=t.data.field(i.fieldPath);if(ss(a))for(const c of a.arrayValue.values||[])n=n.add(new tn(e.indexId,t.key,this.Ln(c),s))}else n=n.add(new tn(e.indexId,t.key,Gs,s));return n}Jn(t,e,n,s,i){k(wl,"Updating index entries for document '%s'",e.key);const a=[];return function(u,d,f,p,g){const S=u.getIterator(),V=d.getIterator();let C=Sn(S),D=Sn(V);for(;C||D;){let z=!1,B=!1;if(C&&D){const L=f(C,D);L<0?B=!0:L>0&&(z=!0)}else C!=null?B=!0:z=!0;z?(p(D),D=Sn(V)):B?(g(C),C=Sn(S)):(C=Sn(S),D=Sn(V))}}(s,i,we,c=>{a.push(this.Hn(t,e,n,c))},c=>{a.push(this.Yn(t,e,n,c))}),b.waitFor(a)}Gn(t){let e=1;return Pn(t).ee({index:Qh,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,s,i)=>{i.done(),e=s.sequenceNumber+1}).next(()=>e)}createRange(t,e,n){n=n.sort((a,c)=>we(a,c)).filter((a,c,u)=>!c||we(a,u[c-1])!==0);const s=[];s.push(t);for(const a of n){const c=we(a,t),u=we(a,e);if(c===0)s[0]=t.An();else if(c>0&&u<0)s.push(a),s.push(a.An());else if(u>0)break}s.push(e);const i=[];for(let a=0;a<s.length;a+=2){if(this.Zn(s[a],s[a+1]))return[];const c=s[a].Vn(this.uid,Gs,O.empty()),u=s[a+1].Vn(this.uid,Gs,O.empty());i.push(IDBKeyRange.bound(c,u))}return i}Zn(t,e){return we(t,e)>0}getMinOffsetFromCollectionGroup(t,e){return this.getFieldIndexes(t,e).next(Al)}getMinOffset(t,e){return b.mapArray(this.Mn(e),n=>this.xn(t,n).next(s=>s||F(44426))).next(Al)}}function Tl(r){return Et(r,Zr)}function xn(r){return Et(r,jr)}function Ar(r){return Et(r,Ra)}function Pn(r){return Et(r,Fr)}function Al(r){U(r.length!==0,28825);let t=r[0].indexState.offset,e=t.largestBatchId;for(let n=1;n<r.length;n++){const s=r[n].indexState.offset;Aa(s,t)<0&&(t=s),e<s.largestBatchId&&(e=s.largestBatchId)}return new Kt(t.readTime,t.documentKey,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bl={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Yd=41943040;class Ct{static withCacheSize(t){return new Ct(t,Ct.DEFAULT_COLLECTION_PERCENTILE,Ct.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zd(r,t,e){const n=r.store(Yt),s=r.store(qn),i=[],a=IDBKeyRange.only(e.batchId);let c=0;const u=n.ee({range:a},(f,p,g)=>(c++,g.delete()));i.push(u.next(()=>{U(c===1,47070,{batchId:e.batchId})}));const d=[];for(const f of e.mutations){const p=Kh(t,f.key.path,e.batchId);i.push(s.delete(p)),d.push(f.key)}return b.waitFor(i).next(()=>d)}function vi(r){if(!r)return 0;let t;if(r.document)t=r.document;else if(r.unknownDocument)t=r.unknownDocument;else{if(!r.noDocument)throw F(14731);t=r.noDocument}return JSON.stringify(t).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ct.DEFAULT_COLLECTION_PERCENTILE=10,Ct.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ct.DEFAULT=new Ct(Yd,Ct.DEFAULT_COLLECTION_PERCENTILE,Ct.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ct.DISABLED=new Ct(-1,0,0);class $i{constructor(t,e,n,s){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=s,this.Xn={}}static wt(t,e,n,s){U(t.uid!=="",64387);const i=t.isAuthenticated()?t.uid:"";return new $i(i,e,n,s)}checkEmpty(t){let e=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Te(t).ee({index:sn,range:n},(s,i,a)=>{e=!1,a.done()}).next(()=>e)}addMutationBatch(t,e,n,s){const i=Mn(t),a=Te(t);return a.add({}).next(c=>{U(typeof c=="number",49019);const u=new Ma(c,e,n,s),d=function(S,V,C){const D=C.baseMutations.map(B=>yi(S.yt,B)),z=C.mutations.map(B=>yi(S.yt,B));return{userId:V,batchId:C.batchId,localWriteTimeMs:C.localWriteTime.toMillis(),baseMutations:D,mutations:z}}(this.serializer,this.userId,u),f=[];let p=new it((g,S)=>W(g.canonicalString(),S.canonicalString()));for(const g of s){const S=Kh(this.userId,g.key.path,c);p=p.add(g.key.path.popLast()),f.push(a.put(d)),f.push(i.put(S,Hg))}return p.forEach(g=>{f.push(this.indexManager.addToCollectionParentIndex(t,g))}),t.addOnCommittedListener(()=>{this.Xn[c]=u.keys()}),b.waitFor(f).next(()=>u)})}lookupMutationBatch(t,e){return Te(t).get(e).next(n=>n?(U(n.userId===this.userId,48,"Unexpected user for mutation batch",{userId:n.userId,batchId:e}),Ye(this.serializer,n)):null)}er(t,e){return this.Xn[e]?b.resolve(this.Xn[e]):this.lookupMutationBatch(t,e).next(n=>{if(n){const s=n.keys();return this.Xn[e]=s,s}return null})}getNextMutationBatchAfterBatchId(t,e){const n=e+1,s=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return Te(t).ee({index:sn,range:s},(a,c,u)=>{c.userId===this.userId&&(U(c.batchId>=n,47524,{tr:n}),i=Ye(this.serializer,c)),u.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(t){const e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=on;return Te(t).ee({index:sn,range:e,reverse:!0},(s,i,a)=>{n=i.batchId,a.done()}).next(()=>n)}getAllMutationBatches(t){const e=IDBKeyRange.bound([this.userId,on],[this.userId,Number.POSITIVE_INFINITY]);return Te(t).J(sn,e).next(n=>n.map(s=>Ye(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(t,e){const n=Js(this.userId,e.path),s=IDBKeyRange.lowerBound(n),i=[];return Mn(t).ee({range:s},(a,c,u)=>{const[d,f,p]=a,g=ne(f);if(d===this.userId&&e.path.isEqual(g))return Te(t).get(p).next(S=>{if(!S)throw F(61480,{nr:a,batchId:p});U(S.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:S.userId,batchId:p}),i.push(Ye(this.serializer,S))});u.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new it(W);const s=[];return e.forEach(i=>{const a=Js(this.userId,i.path),c=IDBKeyRange.lowerBound(a),u=Mn(t).ee({range:c},(d,f,p)=>{const[g,S,V]=d,C=ne(S);g===this.userId&&i.path.isEqual(C)?n=n.add(V):p.done()});s.push(u)}),b.waitFor(s).next(()=>this.rr(t,n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,s=n.length+1,i=Js(this.userId,n),a=IDBKeyRange.lowerBound(i);let c=new it(W);return Mn(t).ee({range:a},(u,d,f)=>{const[p,g,S]=u,V=ne(g);p===this.userId&&n.isPrefixOf(V)?V.length===s&&(c=c.add(S)):f.done()}).next(()=>this.rr(t,c))}rr(t,e){const n=[],s=[];return e.forEach(i=>{s.push(Te(t).get(i).next(a=>{if(a===null)throw F(35274,{batchId:i});U(a.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:a.userId,batchId:i}),n.push(Ye(this.serializer,a))}))}),b.waitFor(s).next(()=>n)}removeMutationBatch(t,e){return Zd(t.le,this.userId,e).next(n=>(t.addOnCommittedListener(()=>{this.ir(e.batchId)}),b.forEach(n,s=>this.referenceDelegate.markPotentiallyOrphaned(t,s))))}ir(t){delete this.Xn[t]}performConsistencyCheck(t){return this.checkEmpty(t).next(e=>{if(!e)return b.resolve();const n=IDBKeyRange.lowerBound(function(a){return[a]}(this.userId)),s=[];return Mn(t).ee({range:n},(i,a,c)=>{if(i[0]===this.userId){const u=ne(i[1]);s.push(u)}else c.done()}).next(()=>{U(s.length===0,56720,{sr:s.map(i=>i.canonicalString())})})})}containsKey(t,e){return tf(t,this.userId,e)}_r(t){return ef(t).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:on,lastStreamToken:""})}}function tf(r,t,e){const n=Js(t,e.path),s=n[1],i=IDBKeyRange.lowerBound(n);let a=!1;return Mn(r).ee({range:i,X:!0},(c,u,d)=>{const[f,p,g]=c;f===t&&p===s&&(a=!0),d.done()}).next(()=>a)}function Te(r){return Et(r,Yt)}function Mn(r){return Et(r,qn)}function ef(r){return Et(r,Jr)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gn{constructor(t){this.ar=t}next(){return this.ar+=2,this.ar}static ur(){return new gn(0)}static cr(){return new gn(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ey{constructor(t,e){this.referenceDelegate=t,this.serializer=e}allocateTargetId(t){return this.lr(t).next(e=>{const n=new gn(e.highestTargetId);return e.highestTargetId=n.next(),this.hr(t,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(t){return this.lr(t).next(e=>q.fromTimestamp(new rt(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(t){return this.lr(t).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,e,n){return this.lr(t).next(s=>(s.highestListenSequenceNumber=e,n&&(s.lastRemoteSnapshotVersion=n.toTimestamp()),e>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=e),this.hr(t,s)))}addTargetData(t,e){return this.Pr(t,e).next(()=>this.lr(t).next(n=>(n.targetCount+=1,this.Tr(e,n),this.hr(t,n))))}updateTargetData(t,e){return this.Pr(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>Vn(t).delete(e.targetId)).next(()=>this.lr(t)).next(n=>(U(n.targetCount>0,8065),n.targetCount-=1,this.hr(t,n)))}removeTargets(t,e,n){let s=0;const i=[];return Vn(t).ee((a,c)=>{const u=Dr(c);u.sequenceNumber<=e&&n.get(u.targetId)===null&&(s++,i.push(this.removeTargetData(t,u)))}).next(()=>b.waitFor(i)).next(()=>s)}forEachTarget(t,e){return Vn(t).ee((n,s)=>{const i=Dr(s);e(i)})}lr(t){return Sl(t).get(mi).next(e=>(U(e!==null,2888),e))}hr(t,e){return Sl(t).put(mi,e)}Pr(t,e){return Vn(t).put(Wd(this.serializer,e))}Tr(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t){return this.lr(t).next(e=>e.targetCount)}getTargetData(t,e){const n=fn(e),s=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return Vn(t).ee({range:s,index:Wh},(a,c,u)=>{const d=Dr(c);hs(e,d.target)&&(i=d,u.done())}).next(()=>i)}addMatchingKeys(t,e,n){const s=[],i=be(t);return e.forEach(a=>{const c=kt(a.path);s.push(i.put({targetId:n,path:c})),s.push(this.referenceDelegate.addReference(t,n,a))}),b.waitFor(s)}removeMatchingKeys(t,e,n){const s=be(t);return b.forEach(e,i=>{const a=kt(i.path);return b.waitFor([s.delete([n,a]),this.referenceDelegate.removeReference(t,n,i)])})}removeMatchingKeysForTargetId(t,e){const n=be(t),s=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(s)}getMatchingKeysForTargetId(t,e){const n=IDBKeyRange.bound([e],[e+1],!1,!0),s=be(t);let i=J();return s.ee({range:n,X:!0},(a,c,u)=>{const d=ne(a[1]),f=new O(d);i=i.add(f)}).next(()=>i)}containsKey(t,e){const n=kt(e.path),s=IDBKeyRange.bound([n],[jh(n)],!1,!0);let i=0;return be(t).ee({index:Sa,X:!0,range:s},([a,c],u,d)=>{a!==0&&(i++,d.done())}).next(()=>i>0)}At(t,e){return Vn(t).get(e).next(n=>n?Dr(n):null)}}function Vn(r){return Et(r,zn)}function Sl(r){return Et(r,an)}function be(r){return Et(r,$n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rl="LruGarbageCollector",nf=1048576;function xl([r,t],[e,n]){const s=W(r,e);return s===0?W(t,n):s}class vy{constructor(t){this.Ir=t,this.buffer=new it(xl),this.Er=0}dr(){return++this.Er}Ar(t){const e=[t,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(e);else{const n=this.buffer.last();xl(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}}get maxValue(){return this.buffer.last()[0]}}class rf{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(t){k(Rl,`Garbage collection scheduled in ${t}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){je(e)?k(Rl,"Ignoring IndexedDB error during garbage collection: ",e):await yn(e)}await this.Vr(3e5)})}}class wy{constructor(t,e){this.mr=t,this.params=e}calculateTargetCount(t,e){return this.mr.gr(t).next(n=>Math.floor(e/100*n))}nthSequenceNumber(t,e){if(e===0)return b.resolve(Wt.ce);const n=new vy(e);return this.mr.forEachTarget(t,s=>n.Ar(s.sequenceNumber)).next(()=>this.mr.pr(t,s=>n.Ar(s))).next(()=>n.maxValue)}removeTargets(t,e,n){return this.mr.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.mr.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(k("LruGarbageCollector","Garbage collection skipped; disabled"),b.resolve(bl)):this.getCacheSize(t).next(n=>n<this.params.cacheSizeCollectionThreshold?(k("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),bl):this.yr(t,e))}getCacheSize(t){return this.mr.getCacheSize(t)}yr(t,e){let n,s,i,a,c,u,d;const f=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(p=>(p>this.params.maximumSequenceNumbersToCollect?(k("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),s=this.params.maximumSequenceNumbersToCollect):s=p,a=Date.now(),this.nthSequenceNumber(t,s))).next(p=>(n=p,c=Date.now(),this.removeTargets(t,n,e))).next(p=>(i=p,u=Date.now(),this.removeOrphanedDocuments(t,n))).next(p=>(d=Date.now(),Cn()<=tt.DEBUG&&k("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-f}ms
	Determined least recently used ${s} in `+(c-a)+`ms
	Removed ${i} targets in `+(u-c)+`ms
	Removed ${p} documents in `+(d-u)+`ms
Total Duration: ${d-f}ms`),b.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:p})))}}function sf(r,t){return new wy(r,t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ty{constructor(t,e){this.db=t,this.garbageCollector=sf(this,e)}gr(t){const e=this.wr(t);return this.db.getTargetCache().getTargetCount(t).next(n=>e.next(s=>n+s))}wr(t){let e=0;return this.pr(t,n=>{e++}).next(()=>e)}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}pr(t,e){return this.Sr(t,(n,s)=>e(s))}addReference(t,e,n){return Ks(t,n)}removeReference(t,e,n){return Ks(t,n)}removeTargets(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return Ks(t,e)}br(t,e){return function(s,i){let a=!1;return ef(s).te(c=>tf(s,c,i).next(u=>(u&&(a=!0),b.resolve(!u)))).next(()=>a)}(t,e)}removeOrphanedDocuments(t,e){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Sr(t,(a,c)=>{if(c<=e){const u=this.br(t,a).next(d=>{if(!d)return i++,n.getEntry(t,a).next(()=>(n.removeEntry(a,q.min()),be(t).delete(function(p){return[0,kt(p.path)]}(a))))});s.push(u)}}).next(()=>b.waitFor(s)).next(()=>n.apply(t)).next(()=>i)}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)}updateLimboDocument(t,e){return Ks(t,e)}Sr(t,e){const n=be(t);let s,i=Wt.ce;return n.ee({index:Sa},([a,c],{path:u,sequenceNumber:d})=>{a===0?(i!==Wt.ce&&e(new O(ne(s)),i),i=d,s=u):i=Wt.ce}).next(()=>{i!==Wt.ce&&e(new O(ne(s)),i)})}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}}function Ks(r,t){return be(r).put(function(n,s){return{targetId:0,path:kt(n.path),sequenceNumber:s}}(t,r.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class of{constructor(){this.changes=new ge(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,dt.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return n!==void 0?b.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ay{constructor(t){this.serializer=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,n){return He(t).put(n)}removeEntry(t,e,n){return He(t).delete(function(i,a){const c=i.path.toArray();return[c.slice(0,c.length-2),c[c.length-2],Ii(a),c[c.length-1]]}(e,n))}updateMetadata(t,e){return this.getMetadata(t).next(n=>(n.byteSize+=e,this.Dr(t,n)))}getEntry(t,e){let n=dt.newInvalidDocument(e);return He(t).ee({index:Ys,range:IDBKeyRange.only(br(e))},(s,i)=>{n=this.Cr(e,i)}).next(()=>n)}vr(t,e){let n={size:0,document:dt.newInvalidDocument(e)};return He(t).ee({index:Ys,range:IDBKeyRange.only(br(e))},(s,i)=>{n={document:this.Cr(e,i),size:vi(i)}}).next(()=>n)}getEntries(t,e){let n=Gt();return this.Fr(t,e,(s,i)=>{const a=this.Cr(s,i);n=n.insert(s,a)}).next(()=>n)}Mr(t,e){let n=Gt(),s=new ut(O.comparator);return this.Fr(t,e,(i,a)=>{const c=this.Cr(i,a);n=n.insert(i,c),s=s.insert(i,vi(a))}).next(()=>({documents:n,Or:s}))}Fr(t,e,n){if(e.isEmpty())return b.resolve();let s=new it(Cl);e.forEach(u=>s=s.add(u));const i=IDBKeyRange.bound(br(s.first()),br(s.last())),a=s.getIterator();let c=a.getNext();return He(t).ee({index:Ys,range:i},(u,d,f)=>{const p=O.fromSegments([...d.prefixPath,d.collectionGroup,d.documentId]);for(;c&&Cl(c,p)<0;)n(c,null),c=a.getNext();c&&c.isEqual(p)&&(n(c,d),c=a.hasNext()?a.getNext():null),c?f.j(br(c)):f.done()}).next(()=>{for(;c;)n(c,null),c=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(t,e,n,s,i){const a=e.path,c=[a.popLast().toArray(),a.lastSegment(),Ii(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],u=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return He(t).J(IDBKeyRange.bound(c,u,!0)).next(d=>{i==null||i.incrementDocumentReadCount(d.length);let f=Gt();for(const p of d){const g=this.Cr(O.fromSegments(p.prefixPath.concat(p.collectionGroup,p.documentId)),p);g.isFoundDocument()&&(ds(e,g)||s.has(g.key))&&(f=f.insert(g.key,g))}return f})}getAllFromCollectionGroup(t,e,n,s){let i=Gt();const a=Vl(e,n),c=Vl(e,Kt.max());return He(t).ee({index:Hh,range:IDBKeyRange.bound(a,c,!0)},(u,d,f)=>{const p=this.Cr(O.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);i=i.insert(p.key,p),i.size===s&&f.done()}).next(()=>i)}newChangeBuffer(t){return new by(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next(e=>e.byteSize)}getMetadata(t){return Pl(t).get(Wo).next(e=>(U(!!e,20021),e))}Dr(t,e){return Pl(t).put(Wo,e)}Cr(t,e){if(e){const n=ly(this.serializer,e);if(!(n.isNoDocument()&&n.version.isEqual(q.min())))return n}return dt.newInvalidDocument(t)}}function af(r){return new Ay(r)}class by extends of{constructor(t,e){super(),this.Nr=t,this.trackRemovals=e,this.Br=new ge(n=>n.toString(),(n,s)=>n.isEqual(s))}applyChanges(t){const e=[];let n=0,s=new it((i,a)=>W(i.canonicalString(),a.canonicalString()));return this.changes.forEach((i,a)=>{const c=this.Br.get(i);if(e.push(this.Nr.removeEntry(t,i,c.readTime)),a.isValidDocument()){const u=dl(this.Nr.serializer,a);s=s.add(i.path.popLast());const d=vi(u);n+=d-c.size,e.push(this.Nr.addEntry(t,i,u))}else if(n-=c.size,this.trackRemovals){const u=dl(this.Nr.serializer,a.convertToNoDocument(q.min()));e.push(this.Nr.addEntry(t,i,u))}}),s.forEach(i=>{e.push(this.Nr.indexManager.addToCollectionParentIndex(t,i))}),e.push(this.Nr.updateMetadata(t,n)),b.waitFor(e)}getFromCache(t,e){return this.Nr.vr(t,e).next(n=>(this.Br.set(e,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(t,e){return this.Nr.Mr(t,e).next(({documents:n,Or:s})=>(s.forEach((i,a)=>{this.Br.set(i,{size:a,readTime:n.get(i).readTime})}),n))}}function Pl(r){return Et(r,Yr)}function He(r){return Et(r,fi)}function br(r){const t=r.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function Vl(r,t){const e=t.documentKey.path.toArray();return[r,Ii(t.readTime),e.slice(0,e.length-2),e.length>0?e[e.length-1]:""]}function Cl(r,t){const e=r.path.toArray(),n=t.path.toArray();let s=0;for(let i=0;i<e.length-2&&i<n.length-2;++i)if(s=W(e[i],n[i]),s)return s;return s=W(e.length,n.length),s||(s=W(e[e.length-2],n[n.length-2]),s||W(e[e.length-1],n[n.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sy{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cf{constructor(t,e,n,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=s}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next(s=>(n=s,this.remoteDocumentCache.getEntry(t,e))).next(s=>(n!==null&&zr(n.mutation,s,Ut.empty(),rt.now()),s))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(n=>this.getLocalViewOfDocuments(t,n,J()).next(()=>n))}getLocalViewOfDocuments(t,e,n=J()){const s=re();return this.populateOverlays(t,s,e).next(()=>this.computeViews(t,e,s,n).next(i=>{let a=Vr();return i.forEach((c,u)=>{a=a.insert(c,u.overlayedDocument)}),a}))}getOverlayedDocuments(t,e){const n=re();return this.populateOverlays(t,n,e).next(()=>this.computeViews(t,e,n,J()))}populateOverlays(t,e,n){const s=[];return n.forEach(i=>{e.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(t,s).next(i=>{i.forEach((a,c)=>{e.set(a,c)})})}computeViews(t,e,n,s){let i=Gt();const a=qr(),c=function(){return qr()}();return e.forEach((u,d)=>{const f=n.get(d.key);s.has(d.key)&&(f===void 0||f.mutation instanceof _e)?i=i.insert(d.key,d):f!==void 0?(a.set(d.key,f.mutation.getFieldMask()),zr(f.mutation,d,f.mutation.getFieldMask(),rt.now())):a.set(d.key,Ut.empty())}),this.recalculateAndSaveOverlays(t,i).next(u=>(u.forEach((d,f)=>a.set(d,f)),e.forEach((d,f)=>c.set(d,new Sy(f,a.get(d)??null))),c))}recalculateAndSaveOverlays(t,e){const n=qr();let s=new ut((a,c)=>a-c),i=J();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(a=>{for(const c of a)c.keys().forEach(u=>{const d=e.get(u);if(d===null)return;let f=n.get(u)||Ut.empty();f=c.applyToLocalView(d,f),n.set(u,f);const p=(s.get(c.batchId)||J()).add(u);s=s.insert(c.batchId,p)})}).next(()=>{const a=[],c=s.getReverseIterator();for(;c.hasNext();){const u=c.getNext(),d=u.key,f=u.value,p=Ad();f.forEach(g=>{if(!i.has(g)){const S=Vd(e.get(g),n.get(g));S!==null&&p.set(g,S),i=i.add(g)}}),a.push(this.documentOverlayCache.saveOverlays(t,d,p))}return b.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(n=>this.recalculateAndSaveOverlays(t,n))}getDocumentsMatchingQuery(t,e,n,s){return function(a){return O.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Id(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,s):this.getDocumentsMatchingCollectionQuery(t,e,n,s)}getNextDocuments(t,e,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,s).next(i=>{const a=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,s-i.size):b.resolve(re());let c=Wr,u=i;return a.next(d=>b.forEach(d,(f,p)=>(c<p.largestBatchId&&(c=p.largestBatchId),i.get(f)?b.resolve():this.remoteDocumentCache.getEntry(t,f).next(g=>{u=u.insert(f,g)}))).next(()=>this.populateOverlays(t,d,i)).next(()=>this.computeViews(t,u,d,J())).next(f=>({batchId:c,changes:Td(f)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new O(e)).next(n=>{let s=Vr();return n.isFoundDocument()&&(s=s.insert(n.key,n)),s})}getDocumentsMatchingCollectionGroupQuery(t,e,n,s){const i=e.collectionGroup;let a=Vr();return this.indexManager.getCollectionParents(t,i).next(c=>b.forEach(c,u=>{const d=function(p,g){return new nr(g,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)}(e,u.child(i));return this.getDocumentsMatchingCollectionQuery(t,d,n,s).next(f=>{f.forEach((p,g)=>{a=a.insert(p,g)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(t,e,n,s){let i;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next(a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,i,s))).next(a=>{i.forEach((u,d)=>{const f=d.getKey();a.get(f)===null&&(a=a.insert(f,dt.newInvalidDocument(f)))});let c=Vr();return a.forEach((u,d)=>{const f=i.get(u);f!==void 0&&zr(f.mutation,d,Ut.empty(),rt.now()),ds(e,d)&&(c=c.insert(u,d))}),c})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ry{constructor(t){this.serializer=t,this.Lr=new Map,this.kr=new Map}getBundleMetadata(t,e){return b.resolve(this.Lr.get(e))}saveBundleMetadata(t,e){return this.Lr.set(e.id,function(s){return{id:s.id,version:s.version,createTime:jt(s.createTime)}}(e)),b.resolve()}getNamedQuery(t,e){return b.resolve(this.kr.get(e))}saveNamedQuery(t,e){return this.kr.set(e.name,function(s){return{name:s.name,query:Qd(s.bundledQuery),readTime:jt(s.readTime)}}(e)),b.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xy{constructor(){this.overlays=new ut(O.comparator),this.qr=new Map}getOverlay(t,e){return b.resolve(this.overlays.get(e))}getOverlays(t,e){const n=re();return b.forEach(e,s=>this.getOverlay(t,s).next(i=>{i!==null&&n.set(s,i)})).next(()=>n)}saveOverlays(t,e,n){return n.forEach((s,i)=>{this.St(t,e,i)}),b.resolve()}removeOverlaysForBatchId(t,e,n){const s=this.qr.get(n);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.qr.delete(n)),b.resolve()}getOverlaysForCollection(t,e,n){const s=re(),i=e.length+1,a=new O(e.child("")),c=this.overlays.getIteratorFrom(a);for(;c.hasNext();){const u=c.getNext().value,d=u.getKey();if(!e.isPrefixOf(d.path))break;d.path.length===i&&u.largestBatchId>n&&s.set(u.getKey(),u)}return b.resolve(s)}getOverlaysForCollectionGroup(t,e,n,s){let i=new ut((d,f)=>d-f);const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===e&&d.largestBatchId>n){let f=i.get(d.largestBatchId);f===null&&(f=re(),i=i.insert(d.largestBatchId,f)),f.set(d.getKey(),d)}}const c=re(),u=i.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((d,f)=>c.set(d,f)),!(c.size()>=s)););return b.resolve(c)}St(t,e,n){const s=this.overlays.get(n.key);if(s!==null){const a=this.qr.get(s.largestBatchId).delete(n.key);this.qr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new La(e,n));let i=this.qr.get(e);i===void 0&&(i=J(),this.qr.set(e,i)),this.qr.set(e,i.add(n.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Py{constructor(){this.sessionToken=yt.EMPTY_BYTE_STRING}getSessionToken(t){return b.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,b.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qa{constructor(){this.Qr=new it(Tt.$r),this.Ur=new it(Tt.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(t,e){const n=new Tt(t,e);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(t,e){t.forEach(n=>this.addReference(n,e))}removeReference(t,e){this.Gr(new Tt(t,e))}zr(t,e){t.forEach(n=>this.removeReference(n,e))}jr(t){const e=new O(new nt([])),n=new Tt(e,t),s=new Tt(e,t+1),i=[];return this.Ur.forEachInRange([n,s],a=>{this.Gr(a),i.push(a.key)}),i}Jr(){this.Qr.forEach(t=>this.Gr(t))}Gr(t){this.Qr=this.Qr.delete(t),this.Ur=this.Ur.delete(t)}Hr(t){const e=new O(new nt([])),n=new Tt(e,t),s=new Tt(e,t+1);let i=J();return this.Ur.forEachInRange([n,s],a=>{i=i.add(a.key)}),i}containsKey(t){const e=new Tt(t,0),n=this.Qr.firstAfterOrEqual(e);return n!==null&&t.isEqual(n.key)}}class Tt{constructor(t,e){this.key=t,this.Yr=e}static $r(t,e){return O.comparator(t.key,e.key)||W(t.Yr,e.Yr)}static Kr(t,e){return W(t.Yr,e.Yr)||O.comparator(t.key,e.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vy{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.tr=1,this.Zr=new it(Tt.$r)}checkEmpty(t){return b.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,n,s){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new Ma(i,e,n,s);this.mutationQueue.push(a);for(const c of s)this.Zr=this.Zr.add(new Tt(c.key,i)),this.indexManager.addToCollectionParentIndex(t,c.key.path.popLast());return b.resolve(a)}lookupMutationBatch(t,e){return b.resolve(this.Xr(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,s=this.ei(n),i=s<0?0:s;return b.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return b.resolve(this.mutationQueue.length===0?on:this.tr-1)}getAllMutationBatches(t){return b.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new Tt(e,0),s=new Tt(e,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([n,s],a=>{const c=this.Xr(a.Yr);i.push(c)}),b.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new it(W);return e.forEach(s=>{const i=new Tt(s,0),a=new Tt(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,a],c=>{n=n.add(c.Yr)})}),b.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,s=n.length+1;let i=n;O.isDocumentKey(i)||(i=i.child(""));const a=new Tt(new O(i),0);let c=new it(W);return this.Zr.forEachWhile(u=>{const d=u.key.path;return!!n.isPrefixOf(d)&&(d.length===s&&(c=c.add(u.Yr)),!0)},a),b.resolve(this.ti(c))}ti(t){const e=[];return t.forEach(n=>{const s=this.Xr(n);s!==null&&e.push(s)}),e}removeMutationBatch(t,e){U(this.ni(e.batchId,"removed")===0,55003),this.mutationQueue.shift();let n=this.Zr;return b.forEach(e.mutations,s=>{const i=new Tt(s.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)}).next(()=>{this.Zr=n})}ir(t){}containsKey(t,e){const n=new Tt(e,0),s=this.Zr.firstAfterOrEqual(n);return b.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,b.resolve()}ni(t,e){return this.ei(t)}ei(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Xr(t){const e=this.ei(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cy{constructor(t){this.ri=t,this.docs=function(){return new ut(O.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,s=this.docs.get(n),i=s?s.size:0,a=this.ri(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return b.resolve(n?n.document.mutableCopy():dt.newInvalidDocument(e))}getEntries(t,e){let n=Gt();return e.forEach(s=>{const i=this.docs.get(s);n=n.insert(s,i?i.document.mutableCopy():dt.newInvalidDocument(s))}),b.resolve(n)}getDocumentsMatchingQuery(t,e,n,s){let i=Gt();const a=e.path,c=new O(a.child("__id-9223372036854775808__")),u=this.docs.getIteratorFrom(c);for(;u.hasNext();){const{key:d,value:{document:f}}=u.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||Aa(qh(f),n)<=0||(s.has(f.key)||ds(e,f))&&(i=i.insert(f.key,f.mutableCopy()))}return b.resolve(i)}getAllFromCollectionGroup(t,e,n,s){F(9500)}ii(t,e){return b.forEach(this.docs,n=>e(n))}newChangeBuffer(t){return new Dy(this)}getSize(t){return b.resolve(this.size)}}class Dy extends of{constructor(t){super(),this.Nr=t}applyChanges(t){const e=[];return this.changes.forEach((n,s)=>{s.isValidDocument()?e.push(this.Nr.addEntry(t,s)):this.Nr.removeEntry(n)}),b.waitFor(e)}getFromCache(t,e){return this.Nr.getEntry(t,e)}getAllFromCache(t,e){return this.Nr.getEntries(t,e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ky{constructor(t){this.persistence=t,this.si=new ge(e=>fn(e),hs),this.lastRemoteSnapshotVersion=q.min(),this.highestTargetId=0,this.oi=0,this._i=new qa,this.targetCount=0,this.ai=gn.ur()}forEachTarget(t,e){return this.si.forEach((n,s)=>e(s)),b.resolve()}getLastRemoteSnapshotVersion(t){return b.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return b.resolve(this.oi)}allocateTargetId(t){return this.highestTargetId=this.ai.next(),b.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.oi&&(this.oi=e),b.resolve()}Pr(t){this.si.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.ai=new gn(e),this.highestTargetId=e),t.sequenceNumber>this.oi&&(this.oi=t.sequenceNumber)}addTargetData(t,e){return this.Pr(e),this.targetCount+=1,b.resolve()}updateTargetData(t,e){return this.Pr(e),b.resolve()}removeTargetData(t,e){return this.si.delete(e.target),this._i.jr(e.targetId),this.targetCount-=1,b.resolve()}removeTargets(t,e,n){let s=0;const i=[];return this.si.forEach((a,c)=>{c.sequenceNumber<=e&&n.get(c.targetId)===null&&(this.si.delete(a),i.push(this.removeMatchingKeysForTargetId(t,c.targetId)),s++)}),b.waitFor(i).next(()=>s)}getTargetCount(t){return b.resolve(this.targetCount)}getTargetData(t,e){const n=this.si.get(e)||null;return b.resolve(n)}addMatchingKeys(t,e,n){return this._i.Wr(e,n),b.resolve()}removeMatchingKeys(t,e,n){this._i.zr(e,n);const s=this.persistence.referenceDelegate,i=[];return s&&e.forEach(a=>{i.push(s.markPotentiallyOrphaned(t,a))}),b.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this._i.jr(e),b.resolve()}getMatchingKeysForTargetId(t,e){const n=this._i.Hr(e);return b.resolve(n)}containsKey(t,e){return b.resolve(this._i.containsKey(e))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class za{constructor(t,e){this.ui={},this.overlays={},this.ci=new Wt(0),this.li=!1,this.li=!0,this.hi=new Py,this.referenceDelegate=t(this),this.Pi=new ky(this),this.indexManager=new yy,this.remoteDocumentCache=function(s){return new Cy(s)}(n=>this.referenceDelegate.Ti(n)),this.serializer=new Hd(e),this.Ii=new Ry(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new xy,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.ui[t.toKey()];return n||(n=new Vy(e,this.referenceDelegate),this.ui[t.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(t,e,n){k("MemoryPersistence","Starting transaction:",t);const s=new Ny(this.ci.next());return this.referenceDelegate.Ei(),n(s).next(i=>this.referenceDelegate.di(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ai(t,e){return b.or(Object.values(this.ui).map(n=>()=>n.containsKey(t,e)))}}class Ny extends $h{constructor(t){super(),this.currentSequenceNumber=t}}class Gi{constructor(t){this.persistence=t,this.Ri=new qa,this.Vi=null}static mi(t){return new Gi(t)}get fi(){if(this.Vi)return this.Vi;throw F(60996)}addReference(t,e,n){return this.Ri.addReference(n,e),this.fi.delete(n.toString()),b.resolve()}removeReference(t,e,n){return this.Ri.removeReference(n,e),this.fi.add(n.toString()),b.resolve()}markPotentiallyOrphaned(t,e){return this.fi.add(e.toString()),b.resolve()}removeTarget(t,e){this.Ri.jr(e.targetId).forEach(s=>this.fi.add(s.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next(s=>{s.forEach(i=>this.fi.add(i.toString()))}).next(()=>n.removeTargetData(t,e))}Ei(){this.Vi=new Set}di(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return b.forEach(this.fi,n=>{const s=O.fromPath(n);return this.gi(t,s).next(i=>{i||e.removeEntry(s,q.min())})}).next(()=>(this.Vi=null,e.apply(t)))}updateLimboDocument(t,e){return this.gi(t,e).next(n=>{n?this.fi.delete(e.toString()):this.fi.add(e.toString())})}Ti(t){return 0}gi(t,e){return b.or([()=>b.resolve(this.Ri.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ai(t,e)])}}class wi{constructor(t,e){this.persistence=t,this.pi=new ge(n=>kt(n.path),(n,s)=>n.isEqual(s)),this.garbageCollector=sf(this,e)}static mi(t,e){return new wi(t,e)}Ei(){}di(t){return b.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}gr(t){const e=this.wr(t);return this.persistence.getTargetCache().getTargetCount(t).next(n=>e.next(s=>n+s))}wr(t){let e=0;return this.pr(t,n=>{e++}).next(()=>e)}pr(t,e){return b.forEach(this.pi,(n,s)=>this.br(t,n,s).next(i=>i?b.resolve():e(s)))}removeTargets(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)}removeOrphanedDocuments(t,e){let n=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ii(t,a=>this.br(t,a,e).next(c=>{c||(n++,i.removeEntry(a,q.min()))})).next(()=>i.apply(t)).next(()=>n)}markPotentiallyOrphaned(t,e){return this.pi.set(e,t.currentSequenceNumber),b.resolve()}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)}addReference(t,e,n){return this.pi.set(n,t.currentSequenceNumber),b.resolve()}removeReference(t,e,n){return this.pi.set(n,t.currentSequenceNumber),b.resolve()}updateLimboDocument(t,e){return this.pi.set(e,t.currentSequenceNumber),b.resolve()}Ti(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=ti(t.data.value)),e}br(t,e,n){return b.or([()=>this.persistence.Ai(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{const s=this.pi.get(e);return b.resolve(s!==void 0&&s>n)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class My{constructor(t){this.serializer=t}k(t,e,n,s){const i=new Ci("createOrUpgrade",e);n<1&&s>=1&&(function(u){u.createObjectStore(ls)}(t),function(u){u.createObjectStore(Jr,{keyPath:Kg}),u.createObjectStore(Yt,{keyPath:qu,autoIncrement:!0}).createIndex(sn,zu,{unique:!0}),u.createObjectStore(qn)}(t),Dl(t),function(u){u.createObjectStore(Xe)}(t));let a=b.resolve();return n<3&&s>=3&&(n!==0&&(function(u){u.deleteObjectStore($n),u.deleteObjectStore(zn),u.deleteObjectStore(an)}(t),Dl(t)),a=a.next(()=>function(u){const d=u.store(an),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:q.min().toTimestamp(),targetCount:0};return d.put(mi,f)}(i))),n<4&&s>=4&&(n!==0&&(a=a.next(()=>function(u,d){return d.store(Yt).J().next(p=>{u.deleteObjectStore(Yt),u.createObjectStore(Yt,{keyPath:qu,autoIncrement:!0}).createIndex(sn,zu,{unique:!0});const g=d.store(Yt),S=p.map(V=>g.put(V));return b.waitFor(S)})}(t,i))),a=a.next(()=>{(function(u){u.createObjectStore(Gn,{keyPath:e_})})(t)})),n<5&&s>=5&&(a=a.next(()=>this.yi(i))),n<6&&s>=6&&(a=a.next(()=>(function(u){u.createObjectStore(Yr)}(t),this.wi(i)))),n<7&&s>=7&&(a=a.next(()=>this.Si(i))),n<8&&s>=8&&(a=a.next(()=>this.bi(t,i))),n<9&&s>=9&&(a=a.next(()=>{(function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")})(t)})),n<10&&s>=10&&(a=a.next(()=>this.Di(i))),n<11&&s>=11&&(a=a.next(()=>{(function(u){u.createObjectStore(ki,{keyPath:n_})})(t),function(u){u.createObjectStore(Ni,{keyPath:r_})}(t)})),n<12&&s>=12&&(a=a.next(()=>{(function(u){const d=u.createObjectStore(Mi,{keyPath:l_});d.createIndex(Xo,h_,{unique:!1}),d.createIndex(Jh,d_,{unique:!1})})(t)})),n<13&&s>=13&&(a=a.next(()=>function(u){const d=u.createObjectStore(fi,{keyPath:Wg});d.createIndex(Ys,Qg),d.createIndex(Hh,Xg)}(t)).next(()=>this.Ci(t,i)).next(()=>t.deleteObjectStore(Xe))),n<14&&s>=14&&(a=a.next(()=>this.Fi(t,i))),n<15&&s>=15&&(a=a.next(()=>function(u){u.createObjectStore(Ra,{keyPath:s_,autoIncrement:!0}).createIndex(Qo,i_,{unique:!1}),u.createObjectStore(Fr,{keyPath:o_}).createIndex(Qh,a_,{unique:!1}),u.createObjectStore(jr,{keyPath:c_}).createIndex(Xh,u_,{unique:!1})}(t))),n<16&&s>=16&&(a=a.next(()=>{e.objectStore(Fr).clear()}).next(()=>{e.objectStore(jr).clear()})),n<17&&s>=17&&(a=a.next(()=>{(function(u){u.createObjectStore(xa,{keyPath:f_})})(t)})),n<18&&s>=18&&vh()&&(a=a.next(()=>{e.objectStore(Fr).clear()}).next(()=>{e.objectStore(jr).clear()})),a}wi(t){let e=0;return t.store(Xe).ee((n,s)=>{e+=vi(s)}).next(()=>{const n={byteSize:e};return t.store(Yr).put(Wo,n)})}yi(t){const e=t.store(Jr),n=t.store(Yt);return e.J().next(s=>b.forEach(s,i=>{const a=IDBKeyRange.bound([i.userId,on],[i.userId,i.lastAcknowledgedBatchId]);return n.J(sn,a).next(c=>b.forEach(c,u=>{U(u.userId===i.userId,18650,"Cannot process batch from unexpected user",{batchId:u.batchId});const d=Ye(this.serializer,u);return Zd(t,i.userId,d).next(()=>{})}))}))}Si(t){const e=t.store($n),n=t.store(Xe);return t.store(an).get(mi).next(s=>{const i=[];return n.ee((a,c)=>{const u=new nt(a),d=function(p){return[0,kt(p)]}(u);i.push(e.get(d).next(f=>f?b.resolve():(p=>e.put({targetId:0,path:kt(p),sequenceNumber:s.highestListenSequenceNumber}))(u)))}).next(()=>b.waitFor(i))})}bi(t,e){t.createObjectStore(Zr,{keyPath:t_});const n=e.store(Zr),s=new Ua,i=a=>{if(s.add(a)){const c=a.lastSegment(),u=a.popLast();return n.put({collectionId:c,parent:kt(u)})}};return e.store(Xe).ee({X:!0},(a,c)=>{const u=new nt(a);return i(u.popLast())}).next(()=>e.store(qn).ee({X:!0},([a,c,u],d)=>{const f=ne(c);return i(f.popLast())}))}Di(t){const e=t.store(zn);return e.ee((n,s)=>{const i=Dr(s),a=Wd(this.serializer,i);return e.put(a)})}Ci(t,e){const n=e.store(Xe),s=[];return n.ee((i,a)=>{const c=e.store(fi),u=function(p){return p.document?new O(nt.fromString(p.document.name).popFirst(5)):p.noDocument?O.fromSegments(p.noDocument.path):p.unknownDocument?O.fromSegments(p.unknownDocument.path):F(36783)}(a).path.toArray(),d={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};s.push(c.put(d))}).next(()=>b.waitFor(s))}Fi(t,e){const n=e.store(Yt),s=af(this.serializer),i=new za(Gi.mi,this.serializer.yt);return n.J().next(a=>{const c=new Map;return a.forEach(u=>{let d=c.get(u.userId)??J();Ye(this.serializer,u).keys().forEach(f=>d=d.add(f)),c.set(u.userId,d)}),b.forEach(c,(u,d)=>{const f=new bt(d),p=zi.wt(this.serializer,f),g=i.getIndexManager(f),S=$i.wt(f,this.serializer,g,i.referenceDelegate);return new cf(s,S,p,g).recalculateAndSaveOverlaysForDocumentKeys(new Jo(e,Wt.ce),u).next()})})}}function Dl(r){r.createObjectStore($n,{keyPath:Yg}).createIndex(Sa,Zg,{unique:!0}),r.createObjectStore(zn,{keyPath:"targetId"}).createIndex(Wh,Jg,{unique:!0}),r.createObjectStore(an)}const Ae="IndexedDbPersistence",ko=18e5,No=5e3,Mo="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Oy="main";class $a{constructor(t,e,n,s,i,a,c,u,d,f,p=18){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Mi=i,this.window=a,this.document=c,this.xi=d,this.Oi=f,this.Ni=p,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=g=>Promise.resolve(),!$a.v())throw new N(P.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Ty(this,s),this.$i=e+Oy,this.serializer=new Hd(u),this.Ui=new De(this.$i,this.Ni,new My(this.serializer)),this.hi=new dy,this.Pi=new Ey(this.referenceDelegate,this.serializer),this.remoteDocumentCache=af(this.serializer),this.Ii=new hy,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,f===!1&&Ft(Ae,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new N(P.FAILED_PRECONDITION,Mo);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",t=>this.Pi.getHighestSequenceNumber(t))}).then(t=>{this.ci=new Wt(t,this.xi)}).then(()=>{this.li=!0}).catch(t=>(this.Ui&&this.Ui.close(),Promise.reject(t)))}Ji(t){return this.Qi=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.Ui.$(async e=>{e.newVersion===null&&await t()})}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.Mi.enqueueAndForget(async()=>{this.started&&await this.Wi()}))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>Hs(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Hi(t).next(e=>{e||(this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)))})}).next(()=>this.Yi(t)).next(e=>this.isPrimary&&!e?this.Zi(t).next(()=>!1):!!e&&this.Xi(t).next(()=>!0))).catch(t=>{if(je(t))return k(Ae,"Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return k(Ae,"Releasing owner lease after error during lease refresh",t),!1}).then(t=>{this.isPrimary!==t&&this.Mi.enqueueRetryable(()=>this.Qi(t)),this.isPrimary=t})}Hi(t){return Sr(t).get(bn).next(e=>b.resolve(this.es(e)))}ts(t){return Hs(t).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,ko)){this.qi=Date.now();const t=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{const n=Et(e,Gn);return n.J().next(s=>{const i=this.ss(s,ko),a=s.filter(c=>i.indexOf(c)===-1);return b.forEach(a,c=>n.delete(c.clientId)).next(()=>a)})}).catch(()=>[]);if(this.Ki)for(const e of t)this.Ki.removeItem(this._s(e.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Wi().then(()=>this.ns()).then(()=>this.ji()))}es(t){return!!t&&t.ownerId===this.clientId}Yi(t){return this.Oi?b.resolve(!0):Sr(t).get(bn).next(e=>{if(e!==null&&this.rs(e.leaseTimestampMs,No)&&!this.us(e.ownerId)){if(this.es(e)&&this.networkEnabled)return!0;if(!this.es(e)){if(!e.allowTabSynchronization)throw new N(P.FAILED_PRECONDITION,Mo);return!1}}return!(!this.networkEnabled||!this.inForeground)||Hs(t).J().next(n=>this.ss(n,No).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,a=!this.inForeground&&s.inForeground,c=this.networkEnabled===s.networkEnabled;if(i||a&&c)return!0}return!1})===void 0)}).next(e=>(this.isPrimary!==e&&k(Ae,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[ls,Gn],t=>{const e=new Jo(t,Wt.ce);return this.Zi(e).next(()=>this.ts(e))}),this.Ui.close(),this.Ps()}ss(t,e){return t.filter(n=>this.rs(n.updateTimeMs,e)&&!this.us(n.clientId))}Ts(){return this.runTransaction("getActiveClients","readonly",t=>Hs(t).J().next(e=>this.ss(e,ko).map(n=>n.clientId)))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(t,e){return $i.wt(t,this.serializer,e,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(t){return new Iy(t,this.serializer.yt.databaseId)}getDocumentOverlayCache(t){return zi.wt(this.serializer,t)}getBundleCache(){return this.Ii}runTransaction(t,e,n){k(Ae,"Starting transaction:",t);const s=e==="readonly"?"readonly":"readwrite",i=function(u){return u===18?g_:u===17?ed:u===16?p_:u===15?Pa:u===14?td:u===13?Zh:u===12?m_:u===11?Yh:void F(60245)}(this.Ni);let a;return this.Ui.runTransaction(t,s,i,c=>(a=new Jo(c,this.ci?this.ci.next():Wt.ce),e==="readwrite-primary"?this.Hi(a).next(u=>!!u||this.Yi(a)).next(u=>{if(!u)throw Ft(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)),new N(P.FAILED_PRECONDITION,zh);return n(a)}).next(u=>this.Xi(a).next(()=>u)):this.Is(a).next(()=>n(a)))).then(c=>(a.raiseOnCommittedEvent(),c))}Is(t){return Sr(t).get(bn).next(e=>{if(e!==null&&this.rs(e.leaseTimestampMs,No)&&!this.us(e.ownerId)&&!this.es(e)&&!(this.Oi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new N(P.FAILED_PRECONDITION,Mo)})}Xi(t){const e={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Sr(t).put(bn,e)}static v(){return De.v()}Zi(t){const e=Sr(t);return e.get(bn).next(n=>this.es(n)?(k(Ae,"Releasing primary lease."),e.delete(bn)):b.resolve())}rs(t,e){const n=Date.now();return!(t<n-e)&&(!(t>n)||(Ft(`Detected an update time that is in the future: ${t} > ${n}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi()))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){var t;typeof((t=this.window)==null?void 0:t.addEventListener)=="function"&&(this.Bi=()=>{this.cs();const e=/(?:Version|Mobile)\/1[456]/;Eh()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(t){var e;try{const n=((e=this.Ki)==null?void 0:e.getItem(this._s(t)))!==null;return k(Ae,`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return Ft(Ae,"Failed to get zombied client id.",n),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(t){Ft("Failed to set zombie client id.",t)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(t){return`firestore_zombie_${this.persistenceKey}_${t}`}}function Sr(r){return Et(r,ls)}function Hs(r){return Et(r,Gn)}function Ly(r,t){let e=r.projectId;return r.isDefaultDatabase||(e+="."+r.database),"firestore/"+t+"/"+e+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ga{constructor(t,e,n,s){this.targetId=t,this.fromCache=e,this.Es=n,this.ds=s}static As(t,e){let n=J(),s=J();for(const i of e.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Ga(t,e.fromCache,n,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fy{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uf{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return Eh()?8:Gh(ci())>0?6:4}()}initialize(t,e){this.ps=t,this.indexManager=e,this.Rs=!0}getDocumentsMatchingQuery(t,e,n,s){const i={result:null};return this.ys(t,e).next(a=>{i.result=a}).next(()=>{if(!i.result)return this.ws(t,e,s,n).next(a=>{i.result=a})}).next(()=>{if(i.result)return;const a=new Fy;return this.Ss(t,e,a).next(c=>{if(i.result=c,this.Vs)return this.bs(t,e,a,c.size)})}).next(()=>i.result)}bs(t,e,n,s){return n.documentReadCount<this.fs?(Cn()<=tt.DEBUG&&k("QueryEngine","SDK will not create cache indexes for query:",Dn(e),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),b.resolve()):(Cn()<=tt.DEBUG&&k("QueryEngine","Query:",Dn(e),"scans",n.documentReadCount,"local documents and returns",s,"documents as results."),n.documentReadCount>this.gs*s?(Cn()<=tt.DEBUG&&k("QueryEngine","The SDK decides to create cache indexes for query:",Dn(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Qt(e))):b.resolve())}ys(t,e){if(nl(e))return b.resolve(null);let n=Qt(e);return this.indexManager.getIndexType(t,n).next(s=>s===0?null:(e.limit!==null&&s===1&&(e=sa(e,null,"F"),n=Qt(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next(i=>{const a=J(...i);return this.ps.getDocuments(t,a).next(c=>this.indexManager.getMinOffset(t,n).next(u=>{const d=this.Ds(e,c);return this.Cs(e,d,a,u.readTime)?this.ys(t,sa(e,null,"F")):this.vs(t,d,e,u)}))})))}ws(t,e,n,s){return nl(e)||s.isEqual(q.min())?b.resolve(null):this.ps.getDocuments(t,n).next(i=>{const a=this.Ds(e,i);return this.Cs(e,a,n,s)?b.resolve(null):(Cn()<=tt.DEBUG&&k("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Dn(e)),this.vs(t,a,e,jg(s,Wr)).next(c=>c))})}Ds(t,e){let n=new it(vd(t));return e.forEach((s,i)=>{ds(t,i)&&(n=n.add(i))}),n}Cs(t,e,n,s){if(t.limit===null)return!1;if(n.size!==e.size)return!0;const i=t.limitType==="F"?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ss(t,e,n){return Cn()<=tt.DEBUG&&k("QueryEngine","Using full collection scan to execute query:",Dn(e)),this.ps.getDocumentsMatchingQuery(t,e,Kt.min(),n)}vs(t,e,n,s){return this.ps.getDocumentsMatchingQuery(t,n,s).next(i=>(e.forEach(a=>{i=i.insert(a.key,a)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ka="LocalStore",jy=3e8;class By{constructor(t,e,n,s){this.persistence=t,this.Fs=e,this.serializer=s,this.Ms=new ut(W),this.xs=new ge(i=>fn(i),hs),this.Os=new Map,this.Ns=t.getRemoteDocumentCache(),this.Pi=t.getTargetCache(),this.Ii=t.getBundleCache(),this.Bs(n)}Bs(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new cf(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Ms))}}function lf(r,t,e,n){return new By(r,t,e,n)}async function hf(r,t){const e=Q(r);return await e.persistence.runTransaction("Handle user change","readonly",n=>{let s;return e.mutationQueue.getAllMutationBatches(n).next(i=>(s=i,e.Bs(t),e.mutationQueue.getAllMutationBatches(n))).next(i=>{const a=[],c=[];let u=J();for(const d of s){a.push(d.batchId);for(const f of d.mutations)u=u.add(f.key)}for(const d of i){c.push(d.batchId);for(const f of d.mutations)u=u.add(f.key)}return e.localDocuments.getDocuments(n,u).next(d=>({Ls:d,removedBatchIds:a,addedBatchIds:c}))})})}function Uy(r,t){const e=Q(r);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const s=t.batch.keys(),i=e.Ns.newChangeBuffer({trackRemovals:!0});return function(c,u,d,f){const p=d.batch,g=p.keys();let S=b.resolve();return g.forEach(V=>{S=S.next(()=>f.getEntry(u,V)).next(C=>{const D=d.docVersions.get(V);U(D!==null,48541),C.version.compareTo(D)<0&&(p.applyToRemoteDocument(C,d),C.isValidDocument()&&(C.setReadTime(d.commitVersion),f.addEntry(C)))})}),S.next(()=>c.mutationQueue.removeMutationBatch(u,p))}(e,n,t,i).next(()=>i.apply(n)).next(()=>e.mutationQueue.performConsistencyCheck(n)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(n,s,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(c){let u=J();for(let d=0;d<c.mutationResults.length;++d)c.mutationResults[d].transformResults.length>0&&(u=u.add(c.batch.mutations[d].key));return u}(t))).next(()=>e.localDocuments.getDocuments(n,s))})}function df(r){const t=Q(r);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Pi.getLastRemoteSnapshotVersion(e))}function qy(r,t){const e=Q(r),n=t.snapshotVersion;let s=e.Ms;return e.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const a=e.Ns.newChangeBuffer({trackRemovals:!0});s=e.Ms;const c=[];t.targetChanges.forEach((f,p)=>{const g=s.get(p);if(!g)return;c.push(e.Pi.removeMatchingKeys(i,f.removedDocuments,p).next(()=>e.Pi.addMatchingKeys(i,f.addedDocuments,p)));let S=g.withSequenceNumber(i.currentSequenceNumber);t.targetMismatches.get(p)!==null?S=S.withResumeToken(yt.EMPTY_BYTE_STRING,q.min()).withLastLimboFreeSnapshotVersion(q.min()):f.resumeToken.approximateByteSize()>0&&(S=S.withResumeToken(f.resumeToken,n)),s=s.insert(p,S),function(C,D,z){return C.resumeToken.approximateByteSize()===0||D.snapshotVersion.toMicroseconds()-C.snapshotVersion.toMicroseconds()>=jy?!0:z.addedDocuments.size+z.modifiedDocuments.size+z.removedDocuments.size>0}(g,S,f)&&c.push(e.Pi.updateTargetData(i,S))});let u=Gt(),d=J();if(t.documentUpdates.forEach(f=>{t.resolvedLimboDocuments.has(f)&&c.push(e.persistence.referenceDelegate.updateLimboDocument(i,f))}),c.push(zy(i,a,t.documentUpdates).next(f=>{u=f.ks,d=f.qs})),!n.isEqual(q.min())){const f=e.Pi.getLastRemoteSnapshotVersion(i).next(p=>e.Pi.setTargetsMetadata(i,i.currentSequenceNumber,n));c.push(f)}return b.waitFor(c).next(()=>a.apply(i)).next(()=>e.localDocuments.getLocalViewOfDocuments(i,u,d)).next(()=>u)}).then(i=>(e.Ms=s,i))}function zy(r,t,e){let n=J(),s=J();return e.forEach(i=>n=n.add(i)),t.getEntries(r,n).next(i=>{let a=Gt();return e.forEach((c,u)=>{const d=i.get(c);u.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(c)),u.isNoDocument()&&u.version.isEqual(q.min())?(t.removeEntry(c,u.readTime),a=a.insert(c,u)):!d.isValidDocument()||u.version.compareTo(d.version)>0||u.version.compareTo(d.version)===0&&d.hasPendingWrites?(t.addEntry(u),a=a.insert(c,u)):k(Ka,"Ignoring outdated watch update for ",c,". Current version:",d.version," Watch version:",u.version)}),{ks:a,qs:s}})}function $y(r,t){const e=Q(r);return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(t===void 0&&(t=on),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}function Gy(r,t){const e=Q(r);return e.persistence.runTransaction("Allocate target","readwrite",n=>{let s;return e.Pi.getTargetData(n,t).next(i=>i?(s=i,b.resolve(s)):e.Pi.allocateTargetId(n).next(a=>(s=new de(t,a,"TargetPurposeListen",n.currentSequenceNumber),e.Pi.addTargetData(n,s).next(()=>s))))}).then(n=>{const s=e.Ms.get(n.targetId);return(s===null||n.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(e.Ms=e.Ms.insert(n.targetId,n),e.xs.set(t,n.targetId)),n})}async function da(r,t,e){const n=Q(r),s=n.Ms.get(t),i=e?"readwrite":"readwrite-primary";try{e||await n.persistence.runTransaction("Release target",i,a=>n.persistence.referenceDelegate.removeTarget(a,s))}catch(a){if(!je(a))throw a;k(Ka,`Failed to update sequence numbers for target ${t}: ${a}`)}n.Ms=n.Ms.remove(t),n.xs.delete(s.target)}function kl(r,t,e){const n=Q(r);let s=q.min(),i=J();return n.persistence.runTransaction("Execute query","readwrite",a=>function(u,d,f){const p=Q(u),g=p.xs.get(f);return g!==void 0?b.resolve(p.Ms.get(g)):p.Pi.getTargetData(d,f)}(n,a,Qt(t)).next(c=>{if(c)return s=c.lastLimboFreeSnapshotVersion,n.Pi.getMatchingKeysForTargetId(a,c.targetId).next(u=>{i=u})}).next(()=>n.Fs.getDocumentsMatchingQuery(a,t,e?s:q.min(),e?i:J())).next(c=>(Ky(n,C_(t),c),{documents:c,Qs:i})))}function Ky(r,t,e){let n=r.Os.get(t)||q.min();e.forEach((s,i)=>{i.readTime.compareTo(n)>0&&(n=i.readTime)}),r.Os.set(t,n)}class Nl{constructor(){this.activeTargetIds=L_()}zs(t){this.activeTargetIds=this.activeTargetIds.add(t)}js(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Gs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class ff{constructor(){this.Mo=new Nl,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t,e=!0){return e&&this.Mo.zs(t),this.xo[t]||"not-current"}updateQueryState(t,e,n){this.xo[t]=e}removeLocalQueryTarget(t){this.Mo.js(t)}isLocalQueryTarget(t){return this.Mo.activeTargetIds.has(t)}clearQueryState(t){delete this.xo[t]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(t){return this.Mo.activeTargetIds.has(t)}start(){return this.Mo=new Nl,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hy{Oo(t){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ml="ConnectivityMonitor";class Ol{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(t){this.qo.push(t)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){k(Ml,"Network connectivity changed: AVAILABLE");for(const t of this.qo)t(0)}ko(){k(Ml,"Network connectivity changed: UNAVAILABLE");for(const t of this.qo)t(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ws=null;function fa(){return Ws===null?Ws=function(){return 268435456+Math.round(2147483648*Math.random())}():Ws++,"0x"+Ws.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oo="RestConnection",Wy={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Qy{get $o(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=e+"://"+t.host,this.Ko=`projects/${n}/databases/${s}`,this.Wo=this.databaseId.database===es?`project_id=${n}`:`project_id=${n}&database_id=${s}`}Go(t,e,n,s,i){const a=fa(),c=this.zo(t,e.toUriEncodedString());k(Oo,`Sending RPC '${t}' ${a}:`,c,n);const u={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(u,s,i);const{host:d}=new URL(c),f=Pi(d);return this.Jo(t,c,u,n,f).then(p=>(k(Oo,`Received RPC '${t}' ${a}: `,p),p),p=>{throw Bn(Oo,`RPC '${t}' ${a} failed with error: `,p,"url: ",c,"request:",n),p})}Ho(t,e,n,s,i,a){return this.Go(t,e,n,s,i)}jo(t,e,n){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+er}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((s,i)=>t[i]=s),n&&n.headers.forEach((s,i)=>t[i]=s)}zo(t,e){const n=Wy[t];return`${this.Uo}/v1/${e}:${n}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xy{constructor(t){this.Yo=t.Yo,this.Zo=t.Zo}Xo(t){this.e_=t}t_(t){this.n_=t}r_(t){this.i_=t}onMessage(t){this.s_=t}close(){this.Zo()}send(t){this.Yo(t)}o_(){this.e_()}__(){this.n_()}a_(t){this.i_(t)}u_(t){this.s_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vt="WebChannelConnection";class Jy extends Qy{constructor(t){super(t),this.c_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Jo(t,e,n,s,i){const a=fa();return new Promise((c,u)=>{const d=new Dh;d.setWithCredentials(!0),d.listenOnce(kh.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case Qs.NO_ERROR:const p=d.getResponseJson();k(Vt,`XHR for RPC '${t}' ${a} received:`,JSON.stringify(p)),c(p);break;case Qs.TIMEOUT:k(Vt,`RPC '${t}' ${a} timed out`),u(new N(P.DEADLINE_EXCEEDED,"Request time out"));break;case Qs.HTTP_ERROR:const g=d.getStatus();if(k(Vt,`RPC '${t}' ${a} failed with status:`,g,"response text:",d.getResponseText()),g>0){let S=d.getResponseJson();Array.isArray(S)&&(S=S[0]);const V=S==null?void 0:S.error;if(V&&V.status&&V.message){const C=function(z){const B=z.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf(B)>=0?B:P.UNKNOWN}(V.status);u(new N(C,V.message))}else u(new N(P.UNKNOWN,"Server responded with status "+d.getStatus()))}else u(new N(P.UNAVAILABLE,"Connection failed."));break;default:F(9055,{l_:t,streamId:a,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{k(Vt,`RPC '${t}' ${a} completed.`)}});const f=JSON.stringify(s);k(Vt,`RPC '${t}' ${a} sending request:`,s),d.send(e,"POST",f,n,15)})}T_(t,e,n){const s=fa(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",t,"/channel"],a=Oh(),c=Mh(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(u.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(u.useFetchStreams=!0),this.jo(u.initMessageHeaders,e,n),u.encodeInitMessageHeaders=!0;const f=i.join("");k(Vt,`Creating RPC '${t}' stream ${s}: ${f}`,u);const p=a.createWebChannel(f,u);this.I_(p);let g=!1,S=!1;const V=new Xy({Yo:D=>{S?k(Vt,`Not sending because RPC '${t}' stream ${s} is closed:`,D):(g||(k(Vt,`Opening RPC '${t}' stream ${s} transport.`),p.open(),g=!0),k(Vt,`RPC '${t}' stream ${s} sending:`,D),p.send(D))},Zo:()=>p.close()}),C=(D,z,B)=>{D.listen(z,L=>{try{B(L)}catch(j){setTimeout(()=>{throw j},0)}})};return C(p,Pr.EventType.OPEN,()=>{S||(k(Vt,`RPC '${t}' stream ${s} transport opened.`),V.o_())}),C(p,Pr.EventType.CLOSE,()=>{S||(S=!0,k(Vt,`RPC '${t}' stream ${s} transport closed`),V.a_(),this.E_(p))}),C(p,Pr.EventType.ERROR,D=>{S||(S=!0,Bn(Vt,`RPC '${t}' stream ${s} transport errored. Name:`,D.name,"Message:",D.message),V.a_(new N(P.UNAVAILABLE,"The operation could not be completed")))}),C(p,Pr.EventType.MESSAGE,D=>{var z;if(!S){const B=D.data[0];U(!!B,16349);const L=B,j=(L==null?void 0:L.error)||((z=L[0])==null?void 0:z.error);if(j){k(Vt,`RPC '${t}' stream ${s} received error:`,j);const $=j.status;let H=function(I){const E=gt[I];if(E!==void 0)return kd(E)}($),v=j.message;H===void 0&&(H=P.INTERNAL,v="Unknown error status: "+$+" with message "+j.message),S=!0,V.a_(new N(H,v)),p.close()}else k(Vt,`RPC '${t}' stream ${s} received:`,B),V.u_(B)}}),C(c,Nh.STAT_EVENT,D=>{D.stat===Go.PROXY?k(Vt,`RPC '${t}' stream ${s} detected buffering proxy`):D.stat===Go.NOPROXY&&k(Vt,`RPC '${t}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{V.__()},0),V}terminate(){this.c_.forEach(t=>t.close()),this.c_=[]}I_(t){this.c_.push(t)}E_(t){this.c_=this.c_.filter(e=>e===t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yy(){return typeof window<"u"?window:null}function ii(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ki(r){return new ty(r,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mf{constructor(t,e,n=1e3,s=1.5,i=6e4){this.Mi=t,this.timerId=e,this.d_=n,this.A_=s,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(t){this.cancel();const e=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),s=Math.max(0,e-n);s>0&&k("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),t())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ll="PersistentStream";class pf{constructor(t,e,n,s,i,a,c,u){this.Mi=t,this.S_=n,this.b_=s,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=c,this.listener=u,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new mf(t,e)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(t){this.Q_(),this.stream.send(t)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(t,e){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,t!==4?this.M_.reset():e&&e.code===P.RESOURCE_EXHAUSTED?(Ft(e.toString()),Ft("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):e&&e.code===P.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.r_(e)}K_(){}auth(){this.state=1;const t=this.W_(this.D_),e=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,s])=>{this.D_===e&&this.G_(n,s)},n=>{t(()=>{const s=new N(P.UNKNOWN,"Fetching auth token failed: "+n.message);return this.z_(s)})})}G_(t,e){const n=this.W_(this.D_);this.stream=this.j_(t,e),this.stream.Xo(()=>{n(()=>this.listener.Xo())}),this.stream.t_(()=>{n(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(s=>{n(()=>this.z_(s))}),this.stream.onMessage(s=>{n(()=>++this.F_==1?this.J_(s):this.onNext(s))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(t){return k(Ll,`close with error: ${t}`),this.stream=null,this.close(4,t)}W_(t){return e=>{this.Mi.enqueueAndForget(()=>this.D_===t?e():(k(Ll,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Zy extends pf{constructor(t,e,n,s,i,a){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,s,a),this.serializer=i}j_(t,e){return this.connection.T_("Listen",t,e)}J_(t){return this.onNext(t)}onNext(t){this.M_.reset();const e=ry(this.serializer,t),n=function(i){if(!("targetChange"in i))return q.min();const a=i.targetChange;return a.targetIds&&a.targetIds.length?q.min():a.readTime?jt(a.readTime):q.min()}(t);return this.listener.H_(e,n)}Y_(t){const e={};e.database=aa(this.serializer),e.addTarget=function(i,a){let c;const u=a.target;if(c=pi(u)?{documents:Ud(i,u)}:{query:qd(i,u).ft},c.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){c.resumeToken=Od(i,a.resumeToken);const d=ia(i,a.expectedCount);d!==null&&(c.expectedCount=d)}else if(a.snapshotVersion.compareTo(q.min())>0){c.readTime=Yn(i,a.snapshotVersion.toTimestamp());const d=ia(i,a.expectedCount);d!==null&&(c.expectedCount=d)}return c}(this.serializer,t);const n=iy(this.serializer,t);n&&(e.labels=n),this.q_(e)}Z_(t){const e={};e.database=aa(this.serializer),e.removeTarget=t,this.q_(e)}}class tI extends pf{constructor(t,e,n,s,i,a){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,s,a),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(t,e){return this.connection.T_("Write",t,e)}J_(t){return U(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,U(!t.writeResults||t.writeResults.length===0,55816),this.listener.ta()}onNext(t){U(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.M_.reset();const e=sy(t.writeResults,t.commitTime),n=jt(t.commitTime);return this.listener.na(n,e)}ra(){const t={};t.database=aa(this.serializer),this.q_(t)}ea(t){const e={streamToken:this.lastStreamToken,writes:t.map(n=>yi(this.serializer,n))};this.q_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eI{}class nI extends eI{constructor(t,e,n,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new N(P.FAILED_PRECONDITION,"The client has already been terminated.")}Go(t,e,n,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,a])=>this.connection.Go(t,oa(e,n),s,i,a)).catch(i=>{throw i.name==="FirebaseError"?(i.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new N(P.UNKNOWN,i.toString())})}Ho(t,e,n,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,c])=>this.connection.Ho(t,oa(e,n),s,a,c,i)).catch(a=>{throw a.name==="FirebaseError"?(a.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new N(P.UNKNOWN,a.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class rI{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(t){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ca("Offline")))}set(t){this.Pa(),this.oa=0,t==="Online"&&(this.aa=!1),this.ca(t)}ca(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}la(t){const e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Ft(e),this.aa=!1):k("OnlineStateTracker",e)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _n="RemoteStore";class sI{constructor(t,e,n,s,i){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(a=>{n.enqueueAndForget(async()=>{In(this)&&(k(_n,"Restarting streams for network reachability change."),await async function(u){const d=Q(u);d.Ea.add(4),await ps(d),d.Ra.set("Unknown"),d.Ea.delete(4),await Hi(d)}(this))})}),this.Ra=new rI(n,s)}}async function Hi(r){if(In(r))for(const t of r.da)await t(!0)}async function ps(r){for(const t of r.da)await t(!1)}function gf(r,t){const e=Q(r);e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),Xa(e)?Qa(e):sr(e).O_()&&Wa(e,t))}function Ha(r,t){const e=Q(r),n=sr(e);e.Ia.delete(t),n.O_()&&_f(e,t),e.Ia.size===0&&(n.O_()?n.L_():In(e)&&e.Ra.set("Unknown"))}function Wa(r,t){if(r.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(q.min())>0){const e=r.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}sr(r).Y_(t)}function _f(r,t){r.Va.Ue(t),sr(r).Z_(t)}function Qa(r){r.Va=new X_({getRemoteKeysForTarget:t=>r.remoteSyncer.getRemoteKeysForTarget(t),At:t=>r.Ia.get(t)||null,ht:()=>r.datastore.serializer.databaseId}),sr(r).start(),r.Ra.ua()}function Xa(r){return In(r)&&!sr(r).x_()&&r.Ia.size>0}function In(r){return Q(r).Ea.size===0}function yf(r){r.Va=void 0}async function iI(r){r.Ra.set("Online")}async function oI(r){r.Ia.forEach((t,e)=>{Wa(r,t)})}async function aI(r,t){yf(r),Xa(r)?(r.Ra.ha(t),Qa(r)):r.Ra.set("Unknown")}async function cI(r,t,e){if(r.Ra.set("Online"),t instanceof Md&&t.state===2&&t.cause)try{await async function(s,i){const a=i.cause;for(const c of i.targetIds)s.Ia.has(c)&&(await s.remoteSyncer.rejectListen(c,a),s.Ia.delete(c),s.Va.removeTarget(c))}(r,t)}catch(n){k(_n,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await Ti(r,n)}else if(t instanceof ri?r.Va.Ze(t):t instanceof Nd?r.Va.st(t):r.Va.tt(t),!e.isEqual(q.min()))try{const n=await df(r.localStore);e.compareTo(n)>=0&&await function(i,a){const c=i.Va.Tt(a);return c.targetChanges.forEach((u,d)=>{if(u.resumeToken.approximateByteSize()>0){const f=i.Ia.get(d);f&&i.Ia.set(d,f.withResumeToken(u.resumeToken,a))}}),c.targetMismatches.forEach((u,d)=>{const f=i.Ia.get(u);if(!f)return;i.Ia.set(u,f.withResumeToken(yt.EMPTY_BYTE_STRING,f.snapshotVersion)),_f(i,u);const p=new de(f.target,u,d,f.sequenceNumber);Wa(i,p)}),i.remoteSyncer.applyRemoteEvent(c)}(r,e)}catch(n){k(_n,"Failed to raise snapshot:",n),await Ti(r,n)}}async function Ti(r,t,e){if(!je(t))throw t;r.Ea.add(1),await ps(r),r.Ra.set("Offline"),e||(e=()=>df(r.localStore)),r.asyncQueue.enqueueRetryable(async()=>{k(_n,"Retrying IndexedDB access"),await e(),r.Ea.delete(1),await Hi(r)})}function If(r,t){return t().catch(e=>Ti(r,e,t))}async function gs(r){const t=Q(r),e=Oe(t);let n=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:on;for(;uI(t);)try{const s=await $y(t.localStore,n);if(s===null){t.Ta.length===0&&e.L_();break}n=s.batchId,lI(t,s)}catch(s){await Ti(t,s)}Ef(t)&&vf(t)}function uI(r){return In(r)&&r.Ta.length<10}function lI(r,t){r.Ta.push(t);const e=Oe(r);e.O_()&&e.X_&&e.ea(t.mutations)}function Ef(r){return In(r)&&!Oe(r).x_()&&r.Ta.length>0}function vf(r){Oe(r).start()}async function hI(r){Oe(r).ra()}async function dI(r){const t=Oe(r);for(const e of r.Ta)t.ea(e.mutations)}async function fI(r,t,e){const n=r.Ta.shift(),s=Oa.from(n,t,e);await If(r,()=>r.remoteSyncer.applySuccessfulWrite(s)),await gs(r)}async function mI(r,t){t&&Oe(r).X_&&await async function(n,s){if(function(a){return H_(a)&&a!==P.ABORTED}(s.code)){const i=n.Ta.shift();Oe(n).B_(),await If(n,()=>n.remoteSyncer.rejectFailedWrite(i.batchId,s)),await gs(n)}}(r,t),Ef(r)&&vf(r)}async function Fl(r,t){const e=Q(r);e.asyncQueue.verifyOperationInProgress(),k(_n,"RemoteStore received new credentials");const n=In(e);e.Ea.add(3),await ps(e),n&&e.Ra.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await Hi(e)}async function pI(r,t){const e=Q(r);t?(e.Ea.delete(2),await Hi(e)):t||(e.Ea.add(2),await ps(e),e.Ra.set("Unknown"))}function sr(r){return r.ma||(r.ma=function(e,n,s){const i=Q(e);return i.sa(),new Zy(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(r.datastore,r.asyncQueue,{Xo:iI.bind(null,r),t_:oI.bind(null,r),r_:aI.bind(null,r),H_:cI.bind(null,r)}),r.da.push(async t=>{t?(r.ma.B_(),Xa(r)?Qa(r):r.Ra.set("Unknown")):(await r.ma.stop(),yf(r))})),r.ma}function Oe(r){return r.fa||(r.fa=function(e,n,s){const i=Q(e);return i.sa(),new tI(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(r.datastore,r.asyncQueue,{Xo:()=>Promise.resolve(),t_:hI.bind(null,r),r_:mI.bind(null,r),ta:dI.bind(null,r),na:fI.bind(null,r)}),r.da.push(async t=>{t?(r.fa.B_(),await gs(r)):(await r.fa.stop(),r.Ta.length>0&&(k(_n,`Stopping write stream with ${r.Ta.length} pending writes`),r.Ta=[]))})),r.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ja{constructor(t,e,n,s,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=s,this.removalCallback=i,this.deferred=new Ce,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,s,i){const a=Date.now()+n,c=new Ja(t,e,a,s,i);return c.start(n),c}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new N(P.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ya(r,t){if(Ft("AsyncQueue",`${t}: ${r}`),je(r))return new N(P.UNAVAILABLE,`${t}: ${r}`);throw r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fn{static emptySet(t){return new Fn(t.comparator)}constructor(t){this.comparator=t?(e,n)=>t(e,n)||O.comparator(e.key,n.key):(e,n)=>O.comparator(e.key,n.key),this.keyedMap=Vr(),this.sortedSet=new ut(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,n)=>(t(e),!1))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof Fn)||this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const s=e.getNext().key,i=n.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){const n=new Fn;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jl{constructor(){this.ga=new ut(O.comparator)}track(t){const e=t.doc.key,n=this.ga.get(e);n?t.type!==0&&n.type===3?this.ga=this.ga.insert(e,t):t.type===3&&n.type!==1?this.ga=this.ga.insert(e,{type:n.type,doc:t.doc}):t.type===2&&n.type===2?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):t.type===2&&n.type===0?this.ga=this.ga.insert(e,{type:0,doc:t.doc}):t.type===1&&n.type===0?this.ga=this.ga.remove(e):t.type===1&&n.type===2?this.ga=this.ga.insert(e,{type:1,doc:n.doc}):t.type===0&&n.type===1?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):F(63341,{Rt:t,pa:n}):this.ga=this.ga.insert(e,t)}ya(){const t=[];return this.ga.inorderTraversal((e,n)=>{t.push(n)}),t}}class Zn{constructor(t,e,n,s,i,a,c,u,d){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=c,this.excludesMetadataChanges=u,this.hasCachedResults=d}static fromInitialDocuments(t,e,n,s,i){const a=[];return e.forEach(c=>{a.push({type:0,doc:c})}),new Zn(t,e,Fn.emptySet(e),a,n,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&ji(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let s=0;s<e.length;s++)if(e[s].type!==n[s].type||!e[s].doc.isEqual(n[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gI{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(t=>t.Da())}}class _I{constructor(){this.queries=Bl(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(e,n){const s=Q(e),i=s.queries;s.queries=Bl(),i.forEach((a,c)=>{for(const u of c.Sa)u.onError(n)})})(this,new N(P.ABORTED,"Firestore shutting down"))}}function Bl(){return new ge(r=>Ed(r),ji)}async function yI(r,t){const e=Q(r);let n=3;const s=t.query;let i=e.queries.get(s);i?!i.ba()&&t.Da()&&(n=2):(i=new gI,n=t.Da()?0:1);try{switch(n){case 0:i.wa=await e.onListen(s,!0);break;case 1:i.wa=await e.onListen(s,!1);break;case 2:await e.onFirstRemoteStoreListen(s)}}catch(a){const c=Ya(a,`Initialization of query '${Dn(t.query)}' failed`);return void t.onError(c)}e.queries.set(s,i),i.Sa.push(t),t.va(e.onlineState),i.wa&&t.Fa(i.wa)&&Za(e)}async function II(r,t){const e=Q(r),n=t.query;let s=3;const i=e.queries.get(n);if(i){const a=i.Sa.indexOf(t);a>=0&&(i.Sa.splice(a,1),i.Sa.length===0?s=t.Da()?0:1:!i.ba()&&t.Da()&&(s=2))}switch(s){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}}function EI(r,t){const e=Q(r);let n=!1;for(const s of t){const i=s.query,a=e.queries.get(i);if(a){for(const c of a.Sa)c.Fa(s)&&(n=!0);a.wa=s}}n&&Za(e)}function vI(r,t,e){const n=Q(r),s=n.queries.get(t);if(s)for(const i of s.Sa)i.onError(e);n.queries.delete(t)}function Za(r){r.Ca.forEach(t=>{t.next()})}var ma,Ul;(Ul=ma||(ma={})).Ma="default",Ul.Cache="cache";class wI{constructor(t,e,n){this.query=t,this.xa=e,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(t){if(!this.options.includeMetadataChanges){const n=[];for(const s of t.docChanges)s.type!==3&&n.push(s);t=new Zn(t.query,t.docs,t.oldDocs,n,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Oa?this.Ba(t)&&(this.xa.next(t),e=!0):this.La(t,this.onlineState)&&(this.ka(t),e=!0),this.Na=t,e}onError(t){this.xa.error(t)}va(t){this.onlineState=t;let e=!1;return this.Na&&!this.Oa&&this.La(this.Na,t)&&(this.ka(this.Na),e=!0),e}La(t,e){if(!t.fromCache||!this.Da())return!0;const n=e!=="Offline";return(!this.options.qa||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}Ba(t){if(t.docChanges.length>0)return!0;const e=this.Na&&this.Na.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}ka(t){t=Zn.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Oa=!0,this.xa.next(t)}Da(){return this.options.source!==ma.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wf{constructor(t){this.key=t}}class Tf{constructor(t){this.key=t}}class TI{constructor(t,e){this.query=t,this.Ya=e,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=J(),this.mutatedKeys=J(),this.eu=vd(t),this.tu=new Fn(this.eu)}get nu(){return this.Ya}ru(t,e){const n=e?e.iu:new jl,s=e?e.tu:this.tu;let i=e?e.mutatedKeys:this.mutatedKeys,a=s,c=!1;const u=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal((f,p)=>{const g=s.get(f),S=ds(this.query,p)?p:null,V=!!g&&this.mutatedKeys.has(g.key),C=!!S&&(S.hasLocalMutations||this.mutatedKeys.has(S.key)&&S.hasCommittedMutations);let D=!1;g&&S?g.data.isEqual(S.data)?V!==C&&(n.track({type:3,doc:S}),D=!0):this.su(g,S)||(n.track({type:2,doc:S}),D=!0,(u&&this.eu(S,u)>0||d&&this.eu(S,d)<0)&&(c=!0)):!g&&S?(n.track({type:0,doc:S}),D=!0):g&&!S&&(n.track({type:1,doc:g}),D=!0,(u||d)&&(c=!0)),D&&(S?(a=a.add(S),i=C?i.add(f):i.delete(f)):(a=a.delete(f),i=i.delete(f)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),i=i.delete(f.key),n.track({type:1,doc:f})}return{tu:a,iu:n,Cs:c,mutatedKeys:i}}su(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,s){const i=this.tu;this.tu=t.tu,this.mutatedKeys=t.mutatedKeys;const a=t.iu.ya();a.sort((f,p)=>function(S,V){const C=D=>{switch(D){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return F(20277,{Rt:D})}};return C(S)-C(V)}(f.type,p.type)||this.eu(f.doc,p.doc)),this.ou(n),s=s??!1;const c=e&&!s?this._u():[],u=this.Xa.size===0&&this.current&&!s?1:0,d=u!==this.Za;return this.Za=u,a.length!==0||d?{snapshot:new Zn(this.query,t.tu,i,a,t.mutatedKeys,u===0,d,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:c}:{au:c}}va(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new jl,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(t){return!this.Ya.has(t)&&!!this.tu.has(t)&&!this.tu.get(t).hasLocalMutations}ou(t){t&&(t.addedDocuments.forEach(e=>this.Ya=this.Ya.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.Ya=this.Ya.delete(e)),this.current=t.current)}_u(){if(!this.current)return[];const t=this.Xa;this.Xa=J(),this.tu.forEach(n=>{this.uu(n.key)&&(this.Xa=this.Xa.add(n.key))});const e=[];return t.forEach(n=>{this.Xa.has(n)||e.push(new Tf(n))}),this.Xa.forEach(n=>{t.has(n)||e.push(new wf(n))}),e}cu(t){this.Ya=t.Qs,this.Xa=J();const e=this.ru(t.documents);return this.applyChanges(e,!0)}lu(){return Zn.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const tc="SyncEngine";class AI{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class bI{constructor(t){this.key=t,this.hu=!1}}class SI{constructor(t,e,n,s,i,a){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new ge(c=>Ed(c),ji),this.Iu=new Map,this.Eu=new Set,this.du=new ut(O.comparator),this.Au=new Map,this.Ru=new qa,this.Vu={},this.mu=new Map,this.fu=gn.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function RI(r,t,e=!0){const n=Pf(r);let s;const i=n.Tu.get(t);return i?(n.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await Af(n,t,e,!0),s}async function xI(r,t){const e=Pf(r);await Af(e,t,!0,!1)}async function Af(r,t,e,n){const s=await Gy(r.localStore,Qt(t)),i=s.targetId,a=r.sharedClientState.addLocalQueryTarget(i,e);let c;return n&&(c=await PI(r,t,i,a==="current",s.resumeToken)),r.isPrimaryClient&&e&&gf(r.remoteStore,s),c}async function PI(r,t,e,n,s){r.pu=(p,g,S)=>async function(C,D,z,B){let L=D.view.ru(z);L.Cs&&(L=await kl(C.localStore,D.query,!1).then(({documents:v})=>D.view.ru(v,L)));const j=B&&B.targetChanges.get(D.targetId),$=B&&B.targetMismatches.get(D.targetId)!=null,H=D.view.applyChanges(L,C.isPrimaryClient,j,$);return zl(C,D.targetId,H.au),H.snapshot}(r,p,g,S);const i=await kl(r.localStore,t,!0),a=new TI(t,i.Qs),c=a.ru(i.documents),u=ms.createSynthesizedTargetChangeForCurrentChange(e,n&&r.onlineState!=="Offline",s),d=a.applyChanges(c,r.isPrimaryClient,u);zl(r,e,d.au);const f=new AI(t,e,a);return r.Tu.set(t,f),r.Iu.has(e)?r.Iu.get(e).push(t):r.Iu.set(e,[t]),d.snapshot}async function VI(r,t,e){const n=Q(r),s=n.Tu.get(t),i=n.Iu.get(s.targetId);if(i.length>1)return n.Iu.set(s.targetId,i.filter(a=>!ji(a,t))),void n.Tu.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||await da(n.localStore,s.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(s.targetId),e&&Ha(n.remoteStore,s.targetId),pa(n,s.targetId)}).catch(yn)):(pa(n,s.targetId),await da(n.localStore,s.targetId,!0))}async function CI(r,t){const e=Q(r),n=e.Tu.get(t),s=e.Iu.get(n.targetId);e.isPrimaryClient&&s.length===1&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),Ha(e.remoteStore,n.targetId))}async function DI(r,t,e){const n=Vf(r);try{const s=await function(a,c){const u=Q(a),d=rt.now(),f=c.reduce((S,V)=>S.add(V.key),J());let p,g;return u.persistence.runTransaction("Locally write mutations","readwrite",S=>{let V=Gt(),C=J();return u.Ns.getEntries(S,f).next(D=>{V=D,V.forEach((z,B)=>{B.isValidDocument()||(C=C.add(z))})}).next(()=>u.localDocuments.getOverlayedDocuments(S,V)).next(D=>{p=D;const z=[];for(const B of c){const L=G_(B,p.get(B.key).overlayedDocument);L!=null&&z.push(new _e(B.key,L,hd(L.value.mapValue),It.exists(!0)))}return u.mutationQueue.addMutationBatch(S,d,z,c)}).next(D=>{g=D;const z=D.applyToLocalDocumentSet(p,C);return u.documentOverlayCache.saveOverlays(S,D.batchId,z)})}).then(()=>({batchId:g.batchId,changes:Td(p)}))}(n.localStore,t);n.sharedClientState.addPendingMutation(s.batchId),function(a,c,u){let d=a.Vu[a.currentUser.toKey()];d||(d=new ut(W)),d=d.insert(c,u),a.Vu[a.currentUser.toKey()]=d}(n,s.batchId,e),await _s(n,s.changes),await gs(n.remoteStore)}catch(s){const i=Ya(s,"Failed to persist write");e.reject(i)}}async function bf(r,t){const e=Q(r);try{const n=await qy(e.localStore,t);t.targetChanges.forEach((s,i)=>{const a=e.Au.get(i);a&&(U(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.hu=!0:s.modifiedDocuments.size>0?U(a.hu,14607):s.removedDocuments.size>0&&(U(a.hu,42227),a.hu=!1))}),await _s(e,n,t)}catch(n){await yn(n)}}function ql(r,t,e){const n=Q(r);if(n.isPrimaryClient&&e===0||!n.isPrimaryClient&&e===1){const s=[];n.Tu.forEach((i,a)=>{const c=a.view.va(t);c.snapshot&&s.push(c.snapshot)}),function(a,c){const u=Q(a);u.onlineState=c;let d=!1;u.queries.forEach((f,p)=>{for(const g of p.Sa)g.va(c)&&(d=!0)}),d&&Za(u)}(n.eventManager,t),s.length&&n.Pu.H_(s),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}async function kI(r,t,e){const n=Q(r);n.sharedClientState.updateQueryState(t,"rejected",e);const s=n.Au.get(t),i=s&&s.key;if(i){let a=new ut(O.comparator);a=a.insert(i,dt.newNoDocument(i,q.min()));const c=J().add(i),u=new qi(q.min(),new Map,new ut(W),a,c);await bf(n,u),n.du=n.du.remove(i),n.Au.delete(t),ec(n)}else await da(n.localStore,t,!1).then(()=>pa(n,t,e)).catch(yn)}async function NI(r,t){const e=Q(r),n=t.batch.batchId;try{const s=await Uy(e.localStore,t);Rf(e,n,null),Sf(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),await _s(e,s)}catch(s){await yn(s)}}async function MI(r,t,e){const n=Q(r);try{const s=await function(a,c){const u=Q(a);return u.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let f;return u.mutationQueue.lookupMutationBatch(d,c).next(p=>(U(p!==null,37113),f=p.keys(),u.mutationQueue.removeMutationBatch(d,p))).next(()=>u.mutationQueue.performConsistencyCheck(d)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(d,f,c)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,f)).next(()=>u.localDocuments.getDocuments(d,f))})}(n.localStore,t);Rf(n,t,e),Sf(n,t),n.sharedClientState.updateMutationState(t,"rejected",e),await _s(n,s)}catch(s){await yn(s)}}function Sf(r,t){(r.mu.get(t)||[]).forEach(e=>{e.resolve()}),r.mu.delete(t)}function Rf(r,t,e){const n=Q(r);let s=n.Vu[n.currentUser.toKey()];if(s){const i=s.get(t);i&&(e?i.reject(e):i.resolve(),s=s.remove(t)),n.Vu[n.currentUser.toKey()]=s}}function pa(r,t,e=null){r.sharedClientState.removeLocalQueryTarget(t);for(const n of r.Iu.get(t))r.Tu.delete(n),e&&r.Pu.yu(n,e);r.Iu.delete(t),r.isPrimaryClient&&r.Ru.jr(t).forEach(n=>{r.Ru.containsKey(n)||xf(r,n)})}function xf(r,t){r.Eu.delete(t.path.canonicalString());const e=r.du.get(t);e!==null&&(Ha(r.remoteStore,e),r.du=r.du.remove(t),r.Au.delete(e),ec(r))}function zl(r,t,e){for(const n of e)n instanceof wf?(r.Ru.addReference(n.key,t),OI(r,n)):n instanceof Tf?(k(tc,"Document no longer in limbo: "+n.key),r.Ru.removeReference(n.key,t),r.Ru.containsKey(n.key)||xf(r,n.key)):F(19791,{wu:n})}function OI(r,t){const e=t.key,n=e.path.canonicalString();r.du.get(e)||r.Eu.has(n)||(k(tc,"New document in limbo: "+e),r.Eu.add(n),ec(r))}function ec(r){for(;r.Eu.size>0&&r.du.size<r.maxConcurrentLimboResolutions;){const t=r.Eu.values().next().value;r.Eu.delete(t);const e=new O(nt.fromString(t)),n=r.fu.next();r.Au.set(n,new bI(e)),r.du=r.du.insert(e,n),gf(r.remoteStore,new de(Qt(Fi(e.path)),n,"TargetPurposeLimboResolution",Wt.ce))}}async function _s(r,t,e){const n=Q(r),s=[],i=[],a=[];n.Tu.isEmpty()||(n.Tu.forEach((c,u)=>{a.push(n.pu(u,t,e).then(d=>{var f;if((d||e)&&n.isPrimaryClient){const p=d?!d.fromCache:(f=e==null?void 0:e.targetChanges.get(u.targetId))==null?void 0:f.current;n.sharedClientState.updateQueryState(u.targetId,p?"current":"not-current")}if(d){s.push(d);const p=Ga.As(u.targetId,d);i.push(p)}}))}),await Promise.all(a),n.Pu.H_(s),await async function(u,d){const f=Q(u);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",p=>b.forEach(d,g=>b.forEach(g.Es,S=>f.persistence.referenceDelegate.addReference(p,g.targetId,S)).next(()=>b.forEach(g.ds,S=>f.persistence.referenceDelegate.removeReference(p,g.targetId,S)))))}catch(p){if(!je(p))throw p;k(Ka,"Failed to update sequence numbers: "+p)}for(const p of d){const g=p.targetId;if(!p.fromCache){const S=f.Ms.get(g),V=S.snapshotVersion,C=S.withLastLimboFreeSnapshotVersion(V);f.Ms=f.Ms.insert(g,C)}}}(n.localStore,i))}async function LI(r,t){const e=Q(r);if(!e.currentUser.isEqual(t)){k(tc,"User change. New user:",t.toKey());const n=await hf(e.localStore,t);e.currentUser=t,function(i,a){i.mu.forEach(c=>{c.forEach(u=>{u.reject(new N(P.CANCELLED,a))})}),i.mu.clear()}(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),await _s(e,n.Ls)}}function FI(r,t){const e=Q(r),n=e.Au.get(t);if(n&&n.hu)return J().add(n.key);{let s=J();const i=e.Iu.get(t);if(!i)return s;for(const a of i){const c=e.Tu.get(a);s=s.unionWith(c.view.nu)}return s}}function Pf(r){const t=Q(r);return t.remoteStore.remoteSyncer.applyRemoteEvent=bf.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=FI.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=kI.bind(null,t),t.Pu.H_=EI.bind(null,t.eventManager),t.Pu.yu=vI.bind(null,t.eventManager),t}function Vf(r){const t=Q(r);return t.remoteStore.remoteSyncer.applySuccessfulWrite=NI.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=MI.bind(null,t),t}class cs{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=Ki(t.databaseInfo.databaseId),this.sharedClientState=this.Du(t),this.persistence=this.Cu(t),await this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Fu(t,this.localStore),this.indexBackfillerScheduler=this.Mu(t,this.localStore)}Fu(t,e){return null}Mu(t,e){return null}vu(t){return lf(this.persistence,new uf,t.initialUser,this.serializer)}Cu(t){return new za(Gi.mi,this.serializer)}Du(t){return new ff}async terminate(){var t,e;(t=this.gcScheduler)==null||t.stop(),(e=this.indexBackfillerScheduler)==null||e.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}cs.provider={build:()=>new cs};class jI extends cs{constructor(t){super(),this.cacheSizeBytes=t}Fu(t,e){U(this.persistence.referenceDelegate instanceof wi,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new rf(n,t.asyncQueue,e)}Cu(t){const e=this.cacheSizeBytes!==void 0?Ct.withCacheSize(this.cacheSizeBytes):Ct.DEFAULT;return new za(n=>wi.mi(n,e),this.serializer)}}class BI extends cs{constructor(t,e,n){super(),this.xu=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}async initialize(t){await super.initialize(t),await this.xu.initialize(this,t),await Vf(this.xu.syncEngine),await gs(this.xu.remoteStore),await this.persistence.Ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(t){return lf(this.persistence,new uf,t.initialUser,this.serializer)}Fu(t,e){const n=this.persistence.referenceDelegate.garbageCollector;return new rf(n,t.asyncQueue,e)}Mu(t,e){const n=new zg(e,this.persistence);return new qg(t.asyncQueue,n)}Cu(t){const e=Ly(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?Ct.withCacheSize(this.cacheSizeBytes):Ct.DEFAULT;return new $a(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,Yy(),ii(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(t){return new ff}}class Ai{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>ql(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=LI.bind(null,this.syncEngine),await pI(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return function(){return new _I}()}createDatastore(t){const e=Ki(t.databaseInfo.databaseId),n=function(i){return new Jy(i)}(t.databaseInfo);return function(i,a,c,u){return new nI(i,a,c,u)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return function(n,s,i,a,c){return new sI(n,s,i,a,c)}(this.localStore,this.datastore,t.asyncQueue,e=>ql(this.syncEngine,e,0),function(){return Ol.v()?new Ol:new Hy}())}createSyncEngine(t,e){return function(s,i,a,c,u,d,f){const p=new SI(s,i,a,c,u,d);return f&&(p.gu=!0),p}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){var t,e;await async function(s){const i=Q(s);k(_n,"RemoteStore shutting down."),i.Ea.add(5),await ps(i),i.Aa.shutdown(),i.Ra.set("Unknown")}(this.remoteStore),(t=this.datastore)==null||t.terminate(),(e=this.eventManager)==null||e.terminate()}}Ai.provider={build:()=>new Ai};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UI{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Ou(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Ou(this.observer.error,t):Ft("Uncaught Error in snapshot listener:",t.toString()))}Nu(){this.muted=!0}Ou(t,e){setTimeout(()=>{this.muted||t(e)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Le="FirestoreClient";class qI{constructor(t,e,n,s,i){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=s,this.user=bt.UNAUTHENTICATED,this.clientId=Ta.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,async a=>{k(Le,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(n,a=>(k(Le,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new Ce;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=Ya(e,"Failed to shutdown persistence");t.reject(n)}}),t.promise}}async function Lo(r,t){r.asyncQueue.verifyOperationInProgress(),k(Le,"Initializing OfflineComponentProvider");const e=r.configuration;await t.initialize(e);let n=e.initialUser;r.setCredentialChangeListener(async s=>{n.isEqual(s)||(await hf(t.localStore,s),n=s)}),t.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=t}async function $l(r,t){r.asyncQueue.verifyOperationInProgress();const e=await zI(r);k(Le,"Initializing OnlineComponentProvider"),await t.initialize(e,r.configuration),r.setCredentialChangeListener(n=>Fl(t.remoteStore,n)),r.setAppCheckTokenChangeListener((n,s)=>Fl(t.remoteStore,s)),r._onlineComponents=t}async function zI(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){k(Le,"Using user provided OfflineComponentProvider");try{await Lo(r,r._uninitializedComponentsProvider._offline)}catch(t){const e=t;if(!function(s){return s.name==="FirebaseError"?s.code===P.FAILED_PRECONDITION||s.code===P.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(e))throw e;Bn("Error using user provided cache. Falling back to memory cache: "+e),await Lo(r,new cs)}}else k(Le,"Using default OfflineComponentProvider"),await Lo(r,new jI(void 0));return r._offlineComponents}async function Cf(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(k(Le,"Using user provided OnlineComponentProvider"),await $l(r,r._uninitializedComponentsProvider._online)):(k(Le,"Using default OnlineComponentProvider"),await $l(r,new Ai))),r._onlineComponents}function $I(r){return Cf(r).then(t=>t.syncEngine)}async function Gl(r){const t=await Cf(r),e=t.eventManager;return e.onListen=RI.bind(null,t.syncEngine),e.onUnlisten=VI.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=xI.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=CI.bind(null,t.syncEngine),e}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Df(r){const t={};return r.timeoutSeconds!==void 0&&(t.timeoutSeconds=r.timeoutSeconds),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kl=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kf="firestore.googleapis.com",Hl=!0;class Wl{constructor(t){if(t.host===void 0){if(t.ssl!==void 0)throw new N(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=kf,this.ssl=Hl}else this.host=t.host,this.ssl=t.ssl??Hl;if(this.isUsingEmulator=t.emulatorOptions!==void 0,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=Yd;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<nf)throw new N(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}Fg("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Df(t.experimentalLongPollingOptions??{}),function(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new N(P.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<5)throw new N(P.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is 5)`);if(n.timeoutSeconds>30)throw new N(P.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(n,s){return n.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Wi{constructor(t,e,n,s){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Wl({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new N(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new N(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Wl(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new xg;switch(n.type){case"firstParty":return new Dg(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new N(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const n=Kl.get(e);n&&(k("ComponentProvider","Removing Datastore"),Kl.delete(e),n.terminate())}(this),Promise.resolve()}}function GI(r,t,e,n={}){var d;r=te(r,Wi);const s=Pi(t),i=r._getSettings(),a={...i,emulatorOptions:r._getEmulatorOptions()},c=`${t}:${e}`;s&&(yh(`https://${c}`),lp("Firestore",!0)),i.host!==kf&&i.host!==c&&Bn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const u={...i,host:c,ssl:s,emulatorOptions:n};if(!Gr(u,a)&&(r._setSettings(u),n.mockUserToken)){let f,p;if(typeof n.mockUserToken=="string")f=n.mockUserToken,p=bt.MOCK_USER;else{f=ap(n.mockUserToken,(d=r._app)==null?void 0:d.options.projectId);const g=n.mockUserToken.sub||n.mockUserToken.user_id;if(!g)throw new N(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new bt(g)}r._authCredentials=new Pg(new Fh(f,p))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class En{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new En(this.firestore,t,this._query)}}class pt{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ke(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new pt(this.firestore,t,this._key)}toJSON(){return{type:pt._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,e,n){if(us(e,pt._jsonSchema))return new pt(t,n||null,new O(nt.fromString(e.referencePath)))}}pt._jsonSchemaVersion="firestore/documentReference/1.0",pt._jsonSchema={type:_t("string",pt._jsonSchemaVersion),referencePath:_t("string")};class ke extends En{constructor(t,e,n){super(t,e,Fi(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new pt(this.firestore,null,new O(t))}withConverter(t){return new ke(this.firestore,t,this._path)}}function Ql(r,t,...e){if(r=Xt(r),Bh("collection","path",t),r instanceof Wi){const n=nt.fromString(t,...e);return Lu(n),new ke(r,null,n)}{if(!(r instanceof pt||r instanceof ke))throw new N(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(nt.fromString(t,...e));return Lu(n),new ke(r.firestore,null,n)}}function un(r,t,...e){if(r=Xt(r),arguments.length===1&&(t=Ta.newId()),Bh("doc","path",t),r instanceof Wi){const n=nt.fromString(t,...e);return Ou(n),new pt(r,null,new O(n))}{if(!(r instanceof pt||r instanceof ke))throw new N(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(nt.fromString(t,...e));return Ou(n),new pt(r.firestore,r instanceof ke?r.converter:null,new O(n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xl="AsyncQueue";class Jl{constructor(t=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new mf(this,"async_queue_retry"),this._c=()=>{const n=ii();n&&k(Xl,"Visibility state changed to "+n.visibilityState),this.M_.w_()},this.ac=t;const e=ii();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.uc(),this.cc(t)}enterRestrictedMode(t){if(!this.ec){this.ec=!0,this.sc=t||!1;const e=ii();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this._c)}}enqueue(t){if(this.uc(),this.ec)return new Promise(()=>{});const e=new Ce;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Xu.push(t),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(t){if(!je(t))throw t;k(Xl,"Operation failed with retryable error: "+t)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(t){const e=this.ac.then(()=>(this.rc=!0,t().catch(n=>{throw this.nc=n,this.rc=!1,Ft("INTERNAL UNHANDLED ERROR: ",Yl(n)),n}).then(n=>(this.rc=!1,n))));return this.ac=e,e}enqueueAfterDelay(t,e,n){this.uc(),this.oc.indexOf(t)>-1&&(e=0);const s=Ja.createAndSchedule(this,t,e,n,i=>this.hc(i));return this.tc.push(s),s}uc(){this.nc&&F(47125,{Pc:Yl(this.nc)})}verifyOperationInProgress(){}async Tc(){let t;do t=this.ac,await t;while(t!==this.ac)}Ic(t){for(const e of this.tc)if(e.timerId===t)return!0;return!1}Ec(t){return this.Tc().then(()=>{this.tc.sort((e,n)=>e.targetTimeMs-n.targetTimeMs);for(const e of this.tc)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.Tc()})}dc(t){this.oc.push(t)}hc(t){const e=this.tc.indexOf(t);this.tc.splice(e,1)}}function Yl(r){let t=r.message||"";return r.stack&&(t=r.stack.includes(r.message)?r.stack:r.message+`
`+r.stack),t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zl(r){return function(e,n){if(typeof e!="object"||e===null)return!1;const s=e;for(const i of n)if(i in s&&typeof s[i]=="function")return!0;return!1}(r,["next","error","complete"])}class Fe extends Wi{constructor(t,e,n,s){super(t,e,n,s),this.type="firestore",this._queue=new Jl,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new Jl(t),this._firestoreClient=void 0,await t}}}function KI(r,t,e){e||(e=es);const n=Rh(r,"firestore");if(n.isInitialized(e)){const s=n.getImmediate({identifier:e}),i=n.getOptions(e);if(Gr(i,t))return s;throw new N(P.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(t.cacheSizeBytes!==void 0&&t.localCache!==void 0)throw new N(P.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(t.cacheSizeBytes!==void 0&&t.cacheSizeBytes!==-1&&t.cacheSizeBytes<nf)throw new N(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return t.host&&Pi(t.host)&&yh(t.host),n.initialize({options:t,instanceIdentifier:e})}function HI(r,t){const e=typeof r=="object"?r:pg(),n=typeof r=="string"?r:es,s=Rh(e,"firestore").getImmediate({identifier:n});if(!s._initialized){const i=ip("firestore");i&&GI(s,...i)}return s}function nc(r){if(r._terminated)throw new N(P.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||WI(r),r._firestoreClient}function WI(r){var n,s,i;const t=r._freezeSettings(),e=function(c,u,d,f){return new y_(c,u,d,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,Df(f.experimentalLongPollingOptions),f.useFetchStreams,f.isUsingEmulator)}(r._databaseId,((n=r._app)==null?void 0:n.options.appId)||"",r._persistenceKey,t);r._componentsProvider||(s=t.localCache)!=null&&s._offlineComponentProvider&&((i=t.localCache)!=null&&i._onlineComponentProvider)&&(r._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),r._firestoreClient=new qI(r._authCredentials,r._appCheckCredentials,r._queue,e,r._componentsProvider&&function(c){const u=c==null?void 0:c._online.build();return{_offline:c==null?void 0:c._offline.build(u),_online:u}}(r._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ht{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Ht(yt.fromBase64String(t))}catch(e){throw new N(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new Ht(yt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:Ht._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(us(t,Ht._jsonSchema))return Ht.fromBase64String(t.bytes)}}Ht._jsonSchemaVersion="firestore/bytes/1.0",Ht._jsonSchema={type:_t("string",Ht._jsonSchemaVersion),bytes:_t("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ys{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new N(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new lt(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rc{constructor(t){this._methodName=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class se{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new N(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new N(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return W(this._lat,t._lat)||W(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:se._jsonSchemaVersion}}static fromJSON(t){if(us(t,se._jsonSchema))return new se(t.latitude,t.longitude)}}se._jsonSchemaVersion="firestore/geoPoint/1.0",se._jsonSchema={type:_t("string",se._jsonSchemaVersion),latitude:_t("number"),longitude:_t("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ie{constructor(t){this._values=(t||[]).map(e=>e)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(n,s){if(n.length!==s.length)return!1;for(let i=0;i<n.length;++i)if(n[i]!==s[i])return!1;return!0}(this._values,t._values)}toJSON(){return{type:ie._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(us(t,ie._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every(e=>typeof e=="number"))return new ie(t.vectorValues);throw new N(P.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}ie._jsonSchemaVersion="firestore/vectorValue/1.0",ie._jsonSchema={type:_t("string",ie._jsonSchemaVersion),vectorValues:_t("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QI=/^__.*__$/;class XI{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return this.fieldMask!==null?new _e(t,this.data,this.fieldMask,e,this.fieldTransforms):new rr(t,this.data,e,this.fieldTransforms)}}class Nf{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new _e(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function Mf(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw F(40011,{Ac:r})}}class sc{constructor(t,e,n,s,i,a){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=s,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(t){return new sc({...this.settings,...t},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(t){var s;const e=(s=this.path)==null?void 0:s.child(t),n=this.Vc({path:e,fc:!1});return n.gc(t),n}yc(t){var s;const e=(s=this.path)==null?void 0:s.child(t),n=this.Vc({path:e,fc:!1});return n.Rc(),n}wc(t){return this.Vc({path:void 0,fc:!0})}Sc(t){return bi(t,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}Rc(){if(this.path)for(let t=0;t<this.path.length;t++)this.gc(this.path.get(t))}gc(t){if(t.length===0)throw this.Sc("Document fields must not be empty");if(Mf(this.Ac)&&QI.test(t))throw this.Sc('Document fields cannot begin and end with "__"')}}class JI{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||Ki(t)}Cc(t,e,n,s=!1){return new sc({Ac:t,methodName:e,Dc:n,path:lt.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Is(r){const t=r._freezeSettings(),e=Ki(r._databaseId);return new JI(r._databaseId,!!t.ignoreUndefinedProperties,e)}function ic(r,t,e,n,s,i={}){const a=r.Cc(i.merge||i.mergeFields?2:0,t,e,s);oc("Data must be an object, but it was:",a,n);const c=Ff(n,a);let u,d;if(i.merge)u=new Ut(a.fieldMask),d=a.fieldTransforms;else if(i.mergeFields){const f=[];for(const p of i.mergeFields){const g=ga(t,p,e);if(!a.contains(g))throw new N(P.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);Bf(f,g)||f.push(g)}u=new Ut(f),d=a.fieldTransforms.filter(p=>u.covers(p.field))}else u=null,d=a.fieldTransforms;return new XI(new Dt(c),u,d)}class Qi extends rc{_toFieldTransform(t){if(t.Ac!==2)throw t.Ac===1?t.Sc(`${this._methodName}() can only appear at the top level of your update data`):t.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof Qi}}function Of(r,t,e,n){const s=r.Cc(1,t,e);oc("Data must be an object, but it was:",s,n);const i=[],a=Dt.empty();Be(n,(u,d)=>{const f=ac(t,u,e);d=Xt(d);const p=s.yc(f);if(d instanceof Qi)i.push(f);else{const g=Es(d,p);g!=null&&(i.push(f),a.set(f,g))}});const c=new Ut(i);return new Nf(a,c,s.fieldTransforms)}function Lf(r,t,e,n,s,i){const a=r.Cc(1,t,e),c=[ga(t,n,e)],u=[s];if(i.length%2!=0)throw new N(P.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<i.length;g+=2)c.push(ga(t,i[g])),u.push(i[g+1]);const d=[],f=Dt.empty();for(let g=c.length-1;g>=0;--g)if(!Bf(d,c[g])){const S=c[g];let V=u[g];V=Xt(V);const C=a.yc(S);if(V instanceof Qi)d.push(S);else{const D=Es(V,C);D!=null&&(d.push(S),f.set(S,D))}}const p=new Ut(d);return new Nf(f,p,a.fieldTransforms)}function YI(r,t,e,n=!1){return Es(e,r.Cc(n?4:3,t))}function Es(r,t){if(jf(r=Xt(r)))return oc("Unsupported field value:",t,r),Ff(r,t);if(r instanceof rc)return function(n,s){if(!Mf(s.Ac))throw s.Sc(`${n._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${n._methodName}() is not currently supported inside arrays`);const i=n._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(r,t),null;if(r===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),r instanceof Array){if(t.settings.fc&&t.Ac!==4)throw t.Sc("Nested arrays are not supported");return function(n,s){const i=[];let a=0;for(const c of n){let u=Es(c,s.wc(a));u==null&&(u={nullValue:"NULL_VALUE"}),i.push(u),a++}return{arrayValue:{values:i}}}(r,t)}return function(n,s){if((n=Xt(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return F_(s.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const i=rt.fromDate(n);return{timestampValue:Yn(s.serializer,i)}}if(n instanceof rt){const i=new rt(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Yn(s.serializer,i)}}if(n instanceof se)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Ht)return{bytesValue:Od(s.serializer,n._byteString)};if(n instanceof pt){const i=s.databaseId,a=n.firestore._databaseId;if(!a.isEqual(i))throw s.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:ja(n.firestore._databaseId||s.databaseId,n._key.path)}}if(n instanceof ie)return function(a,c){return{mapValue:{fields:{[Ca]:{stringValue:Da},[Kn]:{arrayValue:{values:a.toArray().map(d=>{if(typeof d!="number")throw c.Sc("VectorValues must only contain numeric values.");return Na(c.serializer,d)})}}}}}}(n,s);throw s.Sc(`Unsupported field value: ${Vi(n)}`)}(r,t)}function Ff(r,t){const e={};return nd(r)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Be(r,(n,s)=>{const i=Es(s,t.mc(n));i!=null&&(e[n]=i)}),{mapValue:{fields:e}}}function jf(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof rt||r instanceof se||r instanceof Ht||r instanceof pt||r instanceof rc||r instanceof ie)}function oc(r,t,e){if(!jf(e)||!Uh(e)){const n=Vi(e);throw n==="an object"?t.Sc(r+" a custom object"):t.Sc(r+" "+n)}}function ga(r,t,e){if((t=Xt(t))instanceof ys)return t._internalPath;if(typeof t=="string")return ac(r,t);throw bi("Field path arguments must be of type string or ",r,!1,void 0,e)}const ZI=new RegExp("[~\\*/\\[\\]]");function ac(r,t,e){if(t.search(ZI)>=0)throw bi(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,e);try{return new ys(...t.split("."))._internalPath}catch{throw bi(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,e)}}function bi(r,t,e,n,s){const i=n&&!n.isEmpty(),a=s!==void 0;let c=`Function ${t}() called with invalid data`;e&&(c+=" (via `toFirestore()`)"),c+=". ";let u="";return(i||a)&&(u+=" (found",i&&(u+=` in field ${n}`),a&&(u+=` in document ${s}`),u+=")"),new N(P.INVALID_ARGUMENT,c+r+u)}function Bf(r,t){return r.some(e=>e.isEqual(t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uf{constructor(t,e,n,s,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new pt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new tE(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(Xi("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}}class tE extends Uf{data(){return super.data()}}function Xi(r,t){return typeof t=="string"?ac(r,t):t instanceof ys?t._internalPath:t._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eE(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new N(P.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class cc{}class qf extends cc{}function nE(r,t,...e){let n=[];t instanceof cc&&n.push(t),n=n.concat(e),function(i){const a=i.filter(u=>u instanceof uc).length,c=i.filter(u=>u instanceof Ji).length;if(a>1||a>0&&c>0)throw new N(P.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const s of n)r=s._apply(r);return r}class Ji extends qf{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new Ji(t,e,n)}_apply(t){const e=this._parse(t);return zf(t._query,e),new En(t.firestore,t.converter,ra(t._query,e))}_parse(t){const e=Is(t.firestore);return function(i,a,c,u,d,f,p){let g;if(d.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new N(P.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){eh(p,f);const V=[];for(const C of p)V.push(th(u,i,C));g={arrayValue:{values:V}}}else g=th(u,i,p)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||eh(p,f),g=YI(c,a,p,f==="in"||f==="not-in");return Y.create(d,f,g)}(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value)}}function rE(r,t,e){const n=t,s=Xi("where",r);return Ji._create(s,n,e)}class uc extends cc{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new uc(t,e)}_parse(t){const e=this._queryConstraints.map(n=>n._parse(t)).filter(n=>n.getFilters().length>0);return e.length===1?e[0]:st.create(e,this._getOperator())}_apply(t){const e=this._parse(t);return e.getFilters().length===0?t:(function(s,i){let a=s;const c=i.getFlattenedFilters();for(const u of c)zf(a,u),a=ra(a,u)}(t._query,e),new En(t.firestore,t.converter,ra(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class lc extends qf{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new lc(t,e)}_apply(t){const e=function(s,i,a){if(s.startAt!==null)throw new N(P.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new N(P.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new is(i,a)}(t._query,this._field,this._direction);return new En(t.firestore,t.converter,function(s,i){const a=s.explicitOrderBy.concat([i]);return new nr(s.path,s.collectionGroup,a,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(t._query,e))}}function sE(r,t="asc"){const e=t,n=Xi("orderBy",r);return lc._create(n,e)}function th(r,t,e){if(typeof(e=Xt(e))=="string"){if(e==="")throw new N(P.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Id(t)&&e.indexOf("/")!==-1)throw new N(P.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);const n=t.path.child(nt.fromString(e));if(!O.isDocumentKey(n))throw new N(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return rs(r,new O(n))}if(e instanceof pt)return rs(r,e._key);throw new N(P.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Vi(e)}.`)}function eh(r,t){if(!Array.isArray(r)||r.length===0)throw new N(P.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function zf(r,t){const e=function(s,i){for(const a of s)for(const c of a.getFlattenedFilters())if(i.indexOf(c.op)>=0)return c.op;return null}(r.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(e!==null)throw e===t.op?new N(P.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new N(P.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${e.toString()}' filters.`)}class iE{convertValue(t,e="none"){switch(Ne(t)){case 0:return null;case 1:return t.booleanValue;case 2:return ct(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(pe(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw F(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return Be(t,(s,i)=>{n[s]=this.convertValue(i,e)}),n}convertVectorValue(t){var n,s,i;const e=(i=(s=(n=t.fields)==null?void 0:n[Kn].arrayValue)==null?void 0:s.values)==null?void 0:i.map(a=>ct(a.doubleValue));return new ie(e)}convertGeoPoint(t){return new se(ct(t.latitude),ct(t.longitude))}convertArray(t,e){return(t.values||[]).map(n=>this.convertValue(n,e))}convertServerTimestamp(t,e){switch(e){case"previous":const n=Oi(t);return n==null?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(ts(t));default:return null}}convertTimestamp(t){const e=me(t);return new rt(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=nt.fromString(t);U(Kd(n),9688,{name:t});const s=new dn(n.get(1),n.get(3)),i=new O(n.popFirst(5));return s.isEqual(e)||Ft(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hc(r,t,e){let n;return n=r?e&&(e.merge||e.mergeFields)?r.toFirestore(t,e):r.toFirestore(t):t,n}class kr{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class ln extends Uf{constructor(t,e,n,s,i,a){super(t,e,n,s,a),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new oi(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(Xi("DocumentSnapshot.get",t));if(n!==null)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new N(P.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t=this._document,e={};return e.type=ln._jsonSchemaVersion,e.bundle="",e.bundleSource="DocumentSnapshot",e.bundleName=this._key.toString(),!t||!t.isValidDocument()||!t.isFoundDocument()?e:(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),e.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),e)}}ln._jsonSchemaVersion="firestore/documentSnapshot/1.0",ln._jsonSchema={type:_t("string",ln._jsonSchemaVersion),bundleSource:_t("string","DocumentSnapshot"),bundleName:_t("string"),bundle:_t("string")};class oi extends ln{data(t={}){return super.data(t)}}class jn{constructor(t,e,n,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new kr(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach(n=>{t.call(e,new oi(this._firestore,this._userDataWriter,n.key,n,new kr(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new N(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map(c=>{const u=new oi(s._firestore,s._userDataWriter,c.doc.key,c.doc,new kr(s._snapshot.mutatedKeys.has(c.doc.key),s._snapshot.fromCache),s.query.converter);return c.doc,{type:"added",doc:u,oldIndex:-1,newIndex:a++}})}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(c=>i||c.type!==3).map(c=>{const u=new oi(s._firestore,s._userDataWriter,c.doc.key,c.doc,new kr(s._snapshot.mutatedKeys.has(c.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,f=-1;return c.type!==0&&(d=a.indexOf(c.doc.key),a=a.delete(c.doc.key)),c.type!==1&&(a=a.add(c.doc),f=a.indexOf(c.doc.key)),{type:oE(c.type),doc:u,oldIndex:d,newIndex:f}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new N(P.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t={};t.type=jn._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=Ta.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const e=[],n=[],s=[];return this.docs.forEach(i=>{i._document!==null&&(e.push(i._document),n.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))}),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}}function oE(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return F(61501,{type:r})}}jn._jsonSchemaVersion="firestore/querySnapshot/1.0",jn._jsonSchema={type:_t("string",jn._jsonSchemaVersion),bundleSource:_t("string","QuerySnapshot"),bundleName:_t("string"),bundle:_t("string")};class $f extends iE{constructor(t){super(),this.firestore=t}convertBytes(t){return new Ht(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new pt(this.firestore,null,e)}}function nh(r,t,e){r=te(r,pt);const n=te(r.firestore,Fe),s=hc(r.converter,t,e);return vs(n,[ic(Is(n),"setDoc",r._key,s,r.converter!==null,e).toMutation(r._key,It.none())])}function Gf(r,t,e,...n){r=te(r,pt);const s=te(r.firestore,Fe),i=Is(s);let a;return a=typeof(t=Xt(t))=="string"||t instanceof ys?Lf(i,"updateDoc",r._key,t,e,n):Of(i,"updateDoc",r._key,t),vs(s,[a.toMutation(r._key,It.exists(!0))])}function aE(r){return vs(te(r.firestore,Fe),[new fs(r._key,It.none())])}function cE(r,t){const e=te(r.firestore,Fe),n=un(r),s=hc(r.converter,t);return vs(e,[ic(Is(r.firestore),"addDoc",n._key,s,r.converter!==null,{}).toMutation(n._key,It.exists(!1))]).then(()=>n)}function Kf(r,...t){var u,d,f;r=Xt(r);let e={includeMetadataChanges:!1,source:"default"},n=0;typeof t[n]!="object"||Zl(t[n])||(e=t[n++]);const s={includeMetadataChanges:e.includeMetadataChanges,source:e.source};if(Zl(t[n])){const p=t[n];t[n]=(u=p.next)==null?void 0:u.bind(p),t[n+1]=(d=p.error)==null?void 0:d.bind(p),t[n+2]=(f=p.complete)==null?void 0:f.bind(p)}let i,a,c;if(r instanceof pt)a=te(r.firestore,Fe),c=Fi(r._key.path),i={next:p=>{t[n]&&t[n](uE(a,r,p))},error:t[n+1],complete:t[n+2]};else{const p=te(r,En);a=te(p.firestore,Fe),c=p._query;const g=new $f(a);i={next:S=>{t[n]&&t[n](new jn(a,g,p,S))},error:t[n+1],complete:t[n+2]},eE(r._query)}return function(g,S,V,C){const D=new UI(C),z=new wI(S,D,V);return g.asyncQueue.enqueueAndForget(async()=>yI(await Gl(g),z)),()=>{D.Nu(),g.asyncQueue.enqueueAndForget(async()=>II(await Gl(g),z))}}(nc(a),c,s,i)}function vs(r,t){return function(n,s){const i=new Ce;return n.asyncQueue.enqueueAndForget(async()=>DI(await $I(n),s,i)),i.promise}(nc(r),t)}function uE(r,t,e){const n=e.docs.get(t._key),s=new $f(r);return new ln(r,s,t._key,n,new kr(e.hasPendingWrites,e.fromCache),t.converter)}class lE{constructor(t){let e;this.kind="persistent",t!=null&&t.tabManager?(t.tabManager._initialize(t),e=t.tabManager):(e=fE(void 0),e._initialize(t)),this._onlineComponentProvider=e._onlineComponentProvider,this._offlineComponentProvider=e._offlineComponentProvider}toJSON(){return{kind:this.kind}}}function hE(r){return new lE(r)}class dE{constructor(t){this.forceOwnership=t,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(t){this._onlineComponentProvider=Ai.provider,this._offlineComponentProvider={build:e=>new BI(e,t==null?void 0:t.cacheSizeBytes,this.forceOwnership)}}}function fE(r){return new dE(r==null?void 0:r.forceOwnership)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mE{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Is(t)}set(t,e,n){this._verifyNotCommitted();const s=Fo(t,this._firestore),i=hc(s.converter,e,n),a=ic(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,n);return this._mutations.push(a.toMutation(s._key,It.none())),this}update(t,e,n,...s){this._verifyNotCommitted();const i=Fo(t,this._firestore);let a;return a=typeof(e=Xt(e))=="string"||e instanceof ys?Lf(this._dataReader,"WriteBatch.update",i._key,e,n,s):Of(this._dataReader,"WriteBatch.update",i._key,e),this._mutations.push(a.toMutation(i._key,It.exists(!0))),this}delete(t){this._verifyNotCommitted();const e=Fo(t,this._firestore);return this._mutations=this._mutations.concat(new fs(e._key,It.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new N(P.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Fo(r,t){if((r=Xt(r)).firestore!==t)throw new N(P.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pE(r){return nc(r=te(r,Fe)),new mE(r,t=>vs(r,t))}(function(t,e=!0){(function(s){er=s})(mg),li(new Kr("firestore",(n,{instanceIdentifier:s,options:i})=>{const a=n.getProvider("app").getImmediate(),c=new Fe(new Vg(n.getProvider("auth-internal")),new kg(a,n.getProvider("app-check-internal")),function(d,f){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new N(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new dn(d.options.projectId,f)}(a,s),a);return i={useFetchStreams:e,...i},c._setSettings(i),c},"PUBLIC").setMultipleInstances(!0)),Ln(Du,ku,t),Ln(Du,ku,"esm2020")})();const gE={apiKey:"AIzaSyBFOBEGWvfdQ_-8TgBtpG1-ccViyTQevSc",authDomain:"olsc-agrifeeds-trading.firebaseapp.com",projectId:"olsc-agrifeeds-trading",storageBucket:"olsc-agrifeeds-trading.firebasestorage.app",messagingSenderId:"188615089972",appId:"1:188615089972:web:e1311c138055bbddfccf61",measurementId:"G-ESY5FJM316"},rh=xh(gE);let Zt;try{Zt=KI(rh,{localCache:hE({})})}catch(r){r.code==="failed-precondition"?console.warn("Firebase persistence failed: This can happen if multiple tabs are open. Falling back to memory-only cache."):r.code==="unimplemented"?console.error("Firebase persistence is not supported in this browser. Falling back to memory-only cache."):console.error(`An error occurred while initializing Firestore with persistence: ${r.message}`),Zt=HI(rh)}var Se,$r,Hf,Si,Wf=-1,ir=function(r){addEventListener("pageshow",function(t){t.persisted&&(Wf=t.timeStamp,r(t))},!0)},dc=function(){return window.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0]},Yi=function(){var r=dc();return r&&r.activationStart||0},ae=function(r,t){var e=dc(),n="navigate";return Wf>=0?n="back-forward-cache":e&&(document.prerendering||Yi()>0?n="prerender":document.wasDiscarded?n="restore":e.type&&(n=e.type.replace(/_/g,"-"))),{name:r,value:t===void 0?-1:t,rating:"good",delta:0,entries:[],id:"v3-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12),navigationType:n}},Zi=function(r,t,e){try{if(PerformanceObserver.supportedEntryTypes.includes(r)){var n=new PerformanceObserver(function(s){Promise.resolve().then(function(){t(s.getEntries())})});return n.observe(Object.assign({type:r,buffered:!0},e||{})),n}}catch{}},ce=function(r,t,e,n){var s,i;return function(a){t.value>=0&&(a||n)&&((i=t.value-(s||0))||s===void 0)&&(s=t.value,t.delta=i,t.rating=function(c,u){return c>u[1]?"poor":c>u[0]?"needs-improvement":"good"}(t.value,e),r(t))}},fc=function(r){requestAnimationFrame(function(){return requestAnimationFrame(function(){return r()})})},mc=function(r){var t=function(e){e.type!=="pagehide"&&document.visibilityState!=="hidden"||r(e)};addEventListener("visibilitychange",t,!0),addEventListener("pagehide",t,!0)},pc=function(r){var t=!1;return function(e){t||(r(e),t=!0)}},On=-1,sh=function(){return document.visibilityState!=="hidden"||document.prerendering?1/0:0},Ri=function(r){document.visibilityState==="hidden"&&On>-1&&(On=r.type==="visibilitychange"?r.timeStamp:0,_E())},ih=function(){addEventListener("visibilitychange",Ri,!0),addEventListener("prerenderingchange",Ri,!0)},_E=function(){removeEventListener("visibilitychange",Ri,!0),removeEventListener("prerenderingchange",Ri,!0)},gc=function(){return On<0&&(On=sh(),ih(),ir(function(){setTimeout(function(){On=sh(),ih()},0)})),{get firstHiddenTime(){return On}}},to=function(r){document.prerendering?addEventListener("prerenderingchange",function(){return r()},!0):r()},oh=[1800,3e3],Qf=function(r,t){t=t||{},to(function(){var e,n=gc(),s=ae("FCP"),i=Zi("paint",function(a){a.forEach(function(c){c.name==="first-contentful-paint"&&(i.disconnect(),c.startTime<n.firstHiddenTime&&(s.value=Math.max(c.startTime-Yi(),0),s.entries.push(c),e(!0)))})});i&&(e=ce(r,s,oh,t.reportAllChanges),ir(function(a){s=ae("FCP"),e=ce(r,s,oh,t.reportAllChanges),fc(function(){s.value=performance.now()-a.timeStamp,e(!0)})}))})},ah=[.1,.25],yE=function(r,t){t=t||{},Qf(pc(function(){var e,n=ae("CLS",0),s=0,i=[],a=function(u){u.forEach(function(d){if(!d.hadRecentInput){var f=i[0],p=i[i.length-1];s&&d.startTime-p.startTime<1e3&&d.startTime-f.startTime<5e3?(s+=d.value,i.push(d)):(s=d.value,i=[d])}}),s>n.value&&(n.value=s,n.entries=i,e())},c=Zi("layout-shift",a);c&&(e=ce(r,n,ah,t.reportAllChanges),mc(function(){a(c.takeRecords()),e(!0)}),ir(function(){s=0,n=ae("CLS",0),e=ce(r,n,ah,t.reportAllChanges),fc(function(){return e()})}),setTimeout(e,0))}))},Nr={passive:!0,capture:!0},IE=new Date,ch=function(r,t){Se||(Se=t,$r=r,Hf=new Date,Jf(removeEventListener),Xf())},Xf=function(){if($r>=0&&$r<Hf-IE){var r={entryType:"first-input",name:Se.type,target:Se.target,cancelable:Se.cancelable,startTime:Se.timeStamp,processingStart:Se.timeStamp+$r};Si.forEach(function(t){t(r)}),Si=[]}},EE=function(r){if(r.cancelable){var t=(r.timeStamp>1e12?new Date:performance.now())-r.timeStamp;r.type=="pointerdown"?function(e,n){var s=function(){ch(e,n),a()},i=function(){a()},a=function(){removeEventListener("pointerup",s,Nr),removeEventListener("pointercancel",i,Nr)};addEventListener("pointerup",s,Nr),addEventListener("pointercancel",i,Nr)}(t,r):ch(t,r)}},Jf=function(r){["mousedown","keydown","touchstart","pointerdown"].forEach(function(t){return r(t,EE,Nr)})},uh=[100,300],vE=function(r,t){t=t||{},to(function(){var e,n=gc(),s=ae("FID"),i=function(u){u.startTime<n.firstHiddenTime&&(s.value=u.processingStart-u.startTime,s.entries.push(u),e(!0))},a=function(u){u.forEach(i)},c=Zi("first-input",a);e=ce(r,s,uh,t.reportAllChanges),c&&mc(pc(function(){a(c.takeRecords()),c.disconnect()})),c&&ir(function(){var u;s=ae("FID"),e=ce(r,s,uh,t.reportAllChanges),Si=[],$r=-1,Se=null,Jf(addEventListener),u=i,Si.push(u),Xf()})})},lh=[2500,4e3],jo={},wE=function(r,t){t=t||{},to(function(){var e,n=gc(),s=ae("LCP"),i=function(u){var d=u[u.length-1];d&&d.startTime<n.firstHiddenTime&&(s.value=Math.max(d.startTime-Yi(),0),s.entries=[d],e())},a=Zi("largest-contentful-paint",i);if(a){e=ce(r,s,lh,t.reportAllChanges);var c=pc(function(){jo[s.id]||(i(a.takeRecords()),a.disconnect(),jo[s.id]=!0,e(!0))});["keydown","click"].forEach(function(u){addEventListener(u,function(){return setTimeout(c,0)},!0)}),mc(c),ir(function(u){s=ae("LCP"),e=ce(r,s,lh,t.reportAllChanges),fc(function(){s.value=performance.now()-u.timeStamp,jo[s.id]=!0,e(!0)})})}})},hh=[800,1800],TE=function r(t){document.prerendering?to(function(){return r(t)}):document.readyState!=="complete"?addEventListener("load",function(){return r(t)},!0):setTimeout(t,0)},AE=function(r,t){t=t||{};var e=ae("TTFB"),n=ce(r,e,hh,t.reportAllChanges);TE(function(){var s=dc();if(s){var i=s.responseStart;if(i<=0||i>performance.now())return;e.value=Math.max(i-Yi(),0),e.entries=[s],n(!0),ir(function(){e=ae("TTFB",0),(n=ce(r,e,hh,t.reportAllChanges))(!0)})}})};const en=class en{constructor(){Lt(this,"metrics",[]);Lt(this,"interactions",[]);Lt(this,"errors",[]);Lt(this,"sessionId");Lt(this,"userId");Lt(this,"isOnline",navigator.onLine);this.sessionId=this.generateSessionId(),this.initializeListeners(),this.trackCoreWebVitals()}static getInstance(){return en.instance||(en.instance=new en),en.instance}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}initializeListeners(){window.addEventListener("online",()=>{this.isOnline=!0,this.trackUserAction("app_online")}),window.addEventListener("offline",()=>{this.isOnline=!1,this.trackUserAction("app_offline")}),document.addEventListener("visibilitychange",()=>{document.hidden?this.trackUserAction("page_hidden"):this.trackUserAction("page_visible")}),window.addEventListener("error",t=>{var e;this.trackError({message:t.message,stack:(e=t.error)==null?void 0:e.stack,context:{filename:t.filename,lineno:t.lineno,colno:t.colno},timestamp:Date.now(),page:window.location.pathname})}),window.addEventListener("unhandledrejection",t=>{var e,n;this.trackError({message:((e=t.reason)==null?void 0:e.message)||"Unhandled promise rejection",stack:(n=t.reason)==null?void 0:n.stack,context:{reason:t.reason},timestamp:Date.now(),page:window.location.pathname})})}trackCoreWebVitals(){const t=e=>{const n=this.getRating(e.name,e.value);this.metrics.push({name:e.name,value:e.value,rating:n,timestamp:Date.now()})};yE(t),vE(t),Qf(t),wE(t),AE(t)}getRating(t,e){const s={CLS:{good:.1,poor:.25},FID:{good:100,poor:300},FCP:{good:1800,poor:3e3},LCP:{good:2500,poor:4e3},TTFB:{good:800,poor:1800}}[t];return!s||e<=s.good?"good":e<=s.poor?"needs-improvement":"poor"}setUserId(t){this.userId=t}trackPageLoad(t){const e=performance.now();this.trackUserAction("page_load",{page:t,loadTime:e,url:window.location.href,userAgent:navigator.userAgent})}trackUserAction(t,e){const n={action:t,duration:0,timestamp:Date.now(),page:window.location.pathname,userId:this.userId,sessionId:this.sessionId};this.interactions.push(n)}trackTransactionTime(t,e){const n=performance.now()-t;this.trackUserAction("transaction_complete",{type:e,duration:n,timestamp:Date.now()})}trackError(t){t.userId=this.userId,t.sessionId=this.sessionId,this.errors.push(t)}trackPerformanceMark(t,e){if(e){const n=performance.now()-e;this.trackUserAction("performance_mark",{name:t,duration:n,timestamp:Date.now()})}else performance.mark(t)}trackMemoryUsage(){if("memory"in performance){const t=performance.memory;this.trackUserAction("memory_usage",{usedJSHeapSize:t.usedJSHeapSize,totalJSHeapSize:t.totalJSHeapSize,jsHeapSizeLimit:t.jsHeapSizeLimit})}}getMetrics(){return[...this.metrics]}getInteractions(){return[...this.interactions]}getErrors(){return[...this.errors]}getSessionData(){return{sessionId:this.sessionId,userId:this.userId,isOnline:this.isOnline,pageLoads:this.interactions.filter(t=>t.action==="page_load").length,interactions:this.interactions.length,errors:this.errors.length}}exportData(){return{metrics:this.getMetrics(),interactions:this.getInteractions(),errors:this.getErrors(),session:this.getSessionData()}}clearData(){this.metrics=[],this.interactions=[],this.errors=[]}};Lt(en,"instance");let _a=en;function eo(){const r=_a.getInstance();return{trackPageLoad:r.trackPageLoad.bind(r),trackUserAction:r.trackUserAction.bind(r),trackTransactionTime:r.trackTransactionTime.bind(r),trackError:r.trackError.bind(r),trackPerformanceMark:r.trackPerformanceMark.bind(r),trackMemoryUsage:r.trackMemoryUsage.bind(r),setUserId:r.setUserId.bind(r),getMetrics:r.getMetrics.bind(r),getSessionData:r.getSessionData.bind(r),exportData:r.exportData.bind(r)}}const nn=class nn{constructor(){Lt(this,"errorListeners",[]);Lt(this,"retryConfig",{maxRetries:3,baseDelay:1e3,maxDelay:1e4,backoffMultiplier:2});this.setupGlobalErrorHandling()}static getInstance(){return nn.instance||(nn.instance=new nn),nn.instance}setupGlobalErrorHandling(){window.addEventListener("unhandledrejection",t=>{this.handleError(new Error(t.reason),{operation:"unhandled_promise_rejection",timestamp:Date.now()})}),window.addEventListener("error",t=>{this.handleError(new Error(t.message),{operation:"javascript_error",data:{filename:t.filename,lineno:t.lineno,colno:t.colno},timestamp:Date.now()})})}setRetryConfig(t){this.retryConfig={...this.retryConfig,...t}}addErrorListener(t){this.errorListeners.push(t)}removeErrorListener(t){const e=this.errorListeners.indexOf(t);e>-1&&this.errorListeners.splice(e,1)}handleError(t,e){const{trackError:n}=eo();n({message:t.message,stack:t.stack,context:e,timestamp:Date.now(),page:window.location.pathname}),this.errorListeners.forEach(s=>{try{s(t,e)}catch(i){console.error("Error in error listener:",i)}})}async retryOperation(t,e){let n,s=this.retryConfig.baseDelay;for(let i=0;i<=this.retryConfig.maxRetries;i++)try{return await t()}catch(a){if(n=a,i===this.retryConfig.maxRetries)throw this.handleError(n,{...e,retryCount:i,timestamp:Date.now()}),n;console.warn(`Retry attempt ${i+1}/${this.retryConfig.maxRetries+1} for ${e.operation}:`,a),await this.delay(s),s=Math.min(s*this.retryConfig.backoffMultiplier,this.retryConfig.maxDelay)}throw n}delay(t){return new Promise(e=>setTimeout(e,t))}handleFirebaseError(t,e){let n="An error occurred. Please try again.";if(t.code)switch(t.code){case"permission-denied":n="You don't have permission to perform this action.";break;case"unavailable":n="Service is temporarily unavailable. Please try again.";break;case"network-request-failed":n="Network error. Please check your connection.";break;case"quota-exceeded":n="Storage quota exceeded. Please contact support.";break;default:n=`Error: ${t.message||"Unknown error occurred"}`}this.handleError(new Error(n),{operation:`firebase_${e}`,data:{firebaseError:t},timestamp:Date.now()})}handleNetworkError(t,e){const n=navigator.onLine,s=n?"Network request failed. Please try again.":"You are offline. Please check your connection.";this.handleError(new Error(s),{operation:`network_${e}`,data:{isOnline:n,originalError:t},timestamp:Date.now()})}handleValidationError(t,e){const n=`Validation failed: ${t.join(", ")}`;this.handleError(new Error(n),{operation:`validation_${e}`,data:{validationErrors:t},timestamp:Date.now()})}};Lt(nn,"instance");let ya=nn;function Yf(){const r=ya.getInstance();return eo(),{handleError:(t,e)=>{r.handleError(t,{...e,timestamp:Date.now()})},retryOperation:(t,e)=>r.retryOperation(t,e),handleFirebaseError:(t,e)=>{r.handleFirebaseError(t,e)},handleNetworkError:(t,e)=>{r.handleNetworkError(t,e)},handleValidationError:(t,e)=>{r.handleValidationError(t,e)},addErrorListener:t=>{r.addErrorListener(t)},removeErrorListener:t=>{r.removeErrorListener(t)}}}class Rr extends he.Component{constructor(e){super(e);Lt(this,"retry",()=>{this.setState({hasError:!1,error:void 0,errorInfo:void 0})});this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,n){this.setState({error:e,errorInfo:n});const{trackError:s}=eo();s({message:e.message,stack:e.stack,context:{errorInfo:n},timestamp:Date.now(),page:window.location.pathname}),this.props.onError&&this.props.onError(e,n)}render(){var e;if(this.state.hasError){if(this.props.fallback){const n=this.props.fallback;return he.createElement(n,{error:this.state.error,retry:this.retry})}return he.createElement("div",{className:"flex items-center justify-center min-h-[400px] p-8"},he.createElement("div",{className:"text-center"},he.createElement("div",{className:"text-6xl mb-4"},"⚠️"),he.createElement("h2",{className:"text-xl font-bold text-foreground mb-2"},"Something went wrong"),he.createElement("p",{className:"text-muted-foreground mb-4"},((e=this.state.error)==null?void 0:e.message)||"An unexpected error occurred"),he.createElement("button",{onClick:this.retry,className:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90"},"Try Again")))}return this.props.children}}const Zf=r=>{var n,s;const t=[];(!r.type||!["INCOME","EXPENSE"].includes(r.type))&&t.push("Transaction type must be INCOME or EXPENSE"),(!r.amount||typeof r.amount!="number"||r.amount<=0)&&t.push("Amount must be a positive number"),(!r.description||typeof r.description!="string"||r.description.trim().length===0)&&t.push("Description is required"),r.description&&r.description.length>500&&t.push("Description must be less than 500 characters"),(!r.date||!SE(r.date))&&t.push("Valid date is required"),r.type==="INCOME"&&r.items&&(Array.isArray(r.items)?r.items.forEach((i,a)=>{(!i.inventoryItemId||typeof i.inventoryItemId!="string")&&t.push(`Item ${a+1}: Valid inventory item ID is required`),(!i.quantity||typeof i.quantity!="number"||i.quantity<=0)&&t.push(`Item ${a+1}: Quantity must be a positive number`)}):t.push("Items must be an array"));const e={type:r.type,amount:Number(r.amount),description:(n=r.description)==null?void 0:n.trim(),date:r.date,items:(s=r.items)==null?void 0:s.map(i=>({inventoryItemId:i.inventoryItemId,quantity:Number(i.quantity)}))};return{isValid:t.length===0,errors:t,sanitizedData:e}},bE=r=>{var n,s,i,a,c;const t=[];(!r.name||typeof r.name!="string"||r.name.trim().length===0)&&t.push("Item name is required"),r.name&&r.name.length>100&&t.push("Item name must be less than 100 characters"),(!r.price||typeof r.price!="number"||r.price<0)&&t.push("Price must be a non-negative number"),(typeof r.stock!="number"||r.stock<0)&&t.push("Stock must be a non-negative number"),(!r.unit||typeof r.unit!="string"||r.unit.trim().length===0)&&t.push("Unit is required"),r.category&&r.category.length>50&&t.push("Category must be less than 50 characters"),r.imageUrl&&!RE(r.imageUrl)&&t.push("Invalid image URL");const e={name:(n=r.name)==null?void 0:n.trim(),price:Number(r.price),stock:Number(r.stock),unit:(s=r.unit)==null?void 0:s.trim(),category:(i=r.category)==null?void 0:i.trim(),cost:(a=r.cost)==null?void 0:a.trim(),imageUrl:(c=r.imageUrl)==null?void 0:c.trim()};return{isValid:t.length===0,errors:t,sanitizedData:e}},SE=r=>{const t=new Date(r);return t instanceof Date&&!isNaN(t.getTime())},RE=r=>{try{return new URL(r),!0}catch{return!1}};function dh(r,t,e="asc",n=[]){const[s,i]=G.useState([]),[a,c]=G.useState(!0),[u,d]=G.useState(null),[f,p]=G.useState("syncing"),{handleFirebaseError:g,retryOperation:S}=Yf();G.useEffect(()=>{c(!0),d(null);const L=Ql(Zt,r),j=n.map(I=>rE(I.field,I.operator,I.value)),$=t?[sE(t,e)]:[],H=[...j,...$],v=nE(L,...H),y=Kf(v,I=>{try{const E=[];I.forEach(T=>{E.push({id:T.id,...T.data()})}),i(E),c(!1),d(null),I.metadata.hasPendingWrites?p("syncing"):I.metadata.fromCache?p("offline"):p("synced")}catch(E){const T=E;d(T),c(!1),g(T,`${r}_read`)}},I=>{console.error(I),d(I),c(!1),p("offline"),g(I,`${r}_read`)});return()=>y()},[r,t,e,JSON.stringify(n)]);const V=G.useCallback(async L=>{try{if(r==="transactions"){const j=Zf(L);if(!j.isValid)throw new Error(`Validation failed: ${j.errors.join(", ")}`)}else if(r==="inventory"){const j=bE(L);if(!j.isValid)throw new Error(`Validation failed: ${j.errors.join(", ")}`)}return await S(async()=>(await cE(Ql(Zt,r),L)).id,{operation:`${r}_add`})}catch(j){const $=j;throw g($,`${r}_add`),$}},[r,S,g]),C=G.useCallback(async(L,j)=>{try{return await S(async()=>{const $=un(Zt,r,L);await Gf($,j)},{operation:`${r}_update`})}catch($){const H=$;throw g(H,`${r}_update`),H}},[r,S,g]),D=G.useCallback(async L=>{try{return await S(async()=>{const j=un(Zt,r,L);await aE(j)},{operation:`${r}_delete`})}catch(j){const $=j;throw g($,`${r}_delete`),$}},[r,S,g]),z=G.useCallback(async L=>{try{return await S(async()=>{const j=pE(Zt);L.forEach($=>{const H=un(Zt,r,$.id);j.update(H,$.data)}),await j.commit()},{operation:`${r}_batch_update`})}catch(j){const $=j;throw g($,`${r}_batch_update`),$}},[r,S,g]),B=G.useCallback(async()=>{d(null),p("syncing")},[]);return{data:s,loading:a,error:u,syncStatus:f,addItem:V,updateItem:C,deleteItem:D,updateMultipleItems:z,retrySync:B}}function xE(r,t,e){const[n,s]=G.useState(e),[i,a]=G.useState(!0),[c,u]=G.useState(null),[d,f]=G.useState("syncing");G.useEffect(()=>{a(!0);const S=un(Zt,r,t),V=Kf(S,C=>{C.exists()?s(C.data()):(console.log(`Document ${r}/${t} not found, creating with initial data.`),nh(S,e).catch(D=>console.error("Error creating document:",D)),s(e)),a(!1),C.metadata.hasPendingWrites?f("syncing"):C.metadata.fromCache?f("offline"):f("synced")},C=>{console.error(C),u(C),a(!1),f("offline")});return()=>V()},[r,t,JSON.stringify(e)]);const p=G.useCallback(async S=>{const V=un(Zt,r,t);try{await Gf(V,S)}catch(C){throw console.error("Error updating document: ",C),C}},[r,t]),g=G.useCallback(async S=>{const V=un(Zt,r,t);try{await nh(V,S)}catch(C){throw console.error("Error setting document: ",C),C}},[r,t]);return{data:n,loading:i,error:c,syncStatus:d,updateData:p,setData:g}}var wt=(r=>(r.Dashboard="DASHBOARD",r.Transactions="TRANSACTIONS",r.Inventory="INVENTORY",r.Settings="SETTINGS",r))(wt||{}),zt=(r=>(r.Income="INCOME",r.Expense="EXPENSE",r))(zt||{});const tm=({className:r})=>A.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),em=({className:r})=>A.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5h2m-2 2h2m-2 2h2m-4-4h2m-2 2h2"})}),nm=({className:r})=>A.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})}),QE=({className:r})=>A.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),PE=({className:r})=>A.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})}),XE=({className:r})=>A.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.536L16.732 3.732z"})}),VE=({className:r})=>A.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),JE=({className:r})=>A.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})}),YE=({className:r})=>A.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 17h8m0 0v-8m0 8l-8-8-4 4-6-6"})}),ZE=({className:r})=>A.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 12m18 0v6a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 18v-6m18 0V9M3 12V9m18 3a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 9m18 3V9M3 9a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 9v3m-9 6h2"})}),CE=({className:r})=>A.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"})}),tv=({className:r})=>A.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),ev=({className:r})=>A.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),nv=({className:r})=>A.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),rm=({className:r})=>A.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),rv=({className:r})=>A.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}),sv=({className:r})=>A.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6A2.25 2.25 0 016 3.75h12A2.25 2.25 0 0120.25 6v12A2.25 2.25 0 0118 20.25H6A2.25 2.25 0 013.75 18V6zM3.75 12h16.5M9 3.75v16.5"})}),iv=({className:r})=>A.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 6.75h12M8.25 12h12m-12 5.25h12M3.75 6.75h.007v.008H3.75V6.75zm0 4.5h.007v.008H3.75v-4.5zm0 4.5h.007v.008H3.75v-4.5z"})}),DE=({className:r})=>A.jsxs("svg",{className:r,viewBox:"0 0 100 100",xmlns:"http://www.w3.org/2000/svg",children:[A.jsx("circle",{cx:"50",cy:"50",r:"48",fill:"currentColor"}),A.jsx("text",{x:"50",y:"55",fontFamily:"Arial, sans-serif",fontSize:"20",textAnchor:"middle",fill:"#fff",children:"OLESCO"}),A.jsx("text",{x:"50",y:"75",fontFamily:"Arial, sans-serif",fontSize:"14",textAnchor:"middle",fill:"#fff",children:"AGV"})]}),ov=({className:r})=>A.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})}),av=({className:r})=>A.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})}),kE=({className:r})=>A.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),NE=({className:r})=>A.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001a.75.75 0 01.75.75c0 .414-.336.75-.75.75h-4.992v.001a.75.75 0 01-.75-.75c0-.414.336-.75.75-.75zm-8.046 0h4.992v-.001a.75.75 0 01.75.75c0 .414-.336.75-.75.75H7.977v.001a.75.75 0 01-.75-.75c0-.414.336-.75.75-.75zm-4.498 4.5A8.25 8.25 0 0112 5.25a8.25 8.25 0 017.962 7.158.75.75 0 01-1.493.153A6.75 6.75 0 0012 6.75a6.75 6.75 0 00-6.463 4.842.75.75 0 01-1.494-.154z"})}),ME=({className:r})=>A.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.412 15.655L9.75 21.75l3.745-4.012M9.255 9.755L7.5 15.75l3.745-4.012M12.27 12.27L15 21.75l3.75-4.012M14.73 9.755L12 15.75l3.75-4.012M21.75 12c0 .242-.015.482-.044.714M21 12a9 9 0 10-9 9m-9-9a9 9 0 0115.544-6.322"})}),OE=({isOpen:r,onClose:t,onAddTransaction:e,inventory:n})=>{const[s,i]=G.useState(zt.Income),[a,c]=G.useState(""),[u,d]=G.useState(""),[f,p]=G.useState(""),[g,S]=G.useState([]),[V,C]=G.useState(null),[D,z]=G.useState(1);G.useEffect(()=>{r&&(i(zt.Income),c(""),d(""),p(new Date().toISOString().split("T")[0]),S([]),C(null),z(1))},[r]);const{totalAmount:B,autoDescription:L}=G.useMemo(()=>{if(s!==zt.Income)return{totalAmount:0,autoDescription:""};let w=0;const _=[];return g.forEach(X=>{const vt=n.find(or=>or.id===X.itemId);vt&&(w+=vt.price*X.quantity,_.push(`${vt.name} (x${X.quantity})`))}),{totalAmount:w,autoDescription:_.join(", ")||"Point of Sale Transaction"}},[g,n,s]);if(!r)return null;const j=w=>{i(w)},$=w=>{w.stock<=0||(V===w.id?C(null):(C(w.id),z(1)))},H=()=>{!V||D<=0||(S(w=>{const _=w.findIndex(X=>X.itemId===V);if(_>-1){const X=[...w];return X[_].quantity+=D,X}return[...w,{itemId:V,quantity:D}]}),C(null))},v=w=>{S(_=>_.filter(X=>X.itemId!==w))},y=w=>{w.preventDefault();const _=f?new Date(f).toISOString():new Date().toISOString();if(s===zt.Income)g.length>0&&(e({type:s,amount:B,description:L,date:_,items:g.map(X=>({inventoryItemId:X.itemId,quantity:X.quantity}))}),t());else{const X=parseFloat(a);u&&!isNaN(X)&&X>0&&(e({type:s,amount:X,description:u,date:_}),t())}},I=w=>w.toLocaleString("en-PH",{style:"currency",currency:"PHP"}),E=()=>{const w=[];return n.forEach(_=>{const X=V===_.id,vt=_.stock<=0&&!X;w.push(A.jsxs("button",{type:"button",onClick:()=>$(_),disabled:vt,className:`relative p-3 rounded-lg text-left transition-all duration-200 shadow-sm border ${X?"ring-2 ring-primary ring-offset-2 ring-offset-muted bg-accent":"bg-background hover:bg-accent"} ${vt?"opacity-50 cursor-not-allowed":""}`,children:[A.jsx("p",{className:"font-bold text-foreground",children:_.name}),A.jsxs("p",{className:"text-xs text-muted-foreground",children:["(",_.unit,")"]}),A.jsx("p",{className:"text-lg font-semibold text-success mt-1",children:_.price.toLocaleString("en-PH",{style:"currency",currency:"PHP",maximumFractionDigits:0})}),_.stock<=0&&A.jsx("span",{className:"absolute top-1 right-1 text-xs bg-destructive text-destructive-foreground font-bold px-2 py-0.5 rounded-full",children:"Out"})]},_.id)),X&&w.push(A.jsx(LE,{item:_,quantity:D,setQuantity:z,onAddToCart:H},`${_.id}-editor`))}),A.jsx(A.Fragment,{children:A.jsxs("div",{className:"space-y-3",children:[A.jsxs("div",{children:[A.jsx("label",{className:"block text-sm font-medium text-muted-foreground mb-2",children:"Select Products"}),A.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3 max-h-64 overflow-y-auto bg-muted p-3 rounded-lg",children:n.length>0?w:A.jsx("p",{className:"col-span-full text-center text-muted-foreground py-4",children:"Add items to inventory first."})})]}),A.jsxs("div",{children:[A.jsx("h3",{className:"text-lg font-bold text-card-foreground mb-2",children:"Current Order"}),A.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto pr-2",children:g.length===0?A.jsx("p",{className:"text-center text-muted-foreground py-4",children:"Select a product to start."}):g.map(_=>{const X=n.find(vt=>vt.id===_.itemId);return X?A.jsxs("div",{className:"flex justify-between items-center bg-background border border-border p-2 rounded-md shadow-sm",children:[A.jsxs("div",{children:[A.jsx("p",{className:"font-semibold text-foreground",children:X.name}),A.jsxs("p",{className:"text-sm text-muted-foreground",children:[_.quantity," ",X.unit," x ",I(X.price)]})]}),A.jsxs("div",{className:"flex items-center gap-3",children:[A.jsx("p",{className:"font-bold text-foreground",children:I(_.quantity*X.price)}),A.jsx("button",{type:"button",onClick:()=>v(_.itemId),className:"text-muted-foreground hover:text-destructive",children:A.jsx(VE,{className:"w-5 h-5"})})]})]},_.itemId):null})})]}),A.jsxs("div",{className:"p-3 bg-info/10 rounded-lg text-right",children:[A.jsx("span",{className:"text-sm text-info",children:"Total Amount"}),A.jsx("p",{className:"text-2xl font-bold text-info",children:I(B)})]})]})})},T=()=>A.jsxs(A.Fragment,{children:[A.jsxs("div",{children:[A.jsx("label",{htmlFor:"amount",className:"block text-sm font-medium text-muted-foreground mb-1",children:"Amount"}),A.jsx("input",{type:"number",id:"amount",value:a,onChange:w=>c(w.target.value),required:!0,min:"0.01",step:"0.01",placeholder:"0.00",className:"w-full px-3 py-2 bg-background border border-input rounded-md focus:outline-none focus:ring-2 focus:ring-ring"})]}),A.jsxs("div",{children:[A.jsx("label",{htmlFor:"expense_description",className:"block text-sm font-medium text-muted-foreground mb-1",children:"Description"}),A.jsx("input",{type:"text",id:"expense_description",value:u,onChange:w=>d(w.target.value),required:!0,placeholder:"e.g., Rent, Utilities",className:"w-full px-3 py-2 bg-background border border-input rounded-md focus:outline-none focus:ring-2 focus:ring-ring"})]})]});return A.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex justify-center items-center z-50 animate-fade-in p-4",children:A.jsxs("div",{className:"bg-card border border-border rounded-lg shadow-xl w-full max-w-lg animate-slide-in-up max-h-[90vh] flex flex-col",role:"dialog","aria-modal":"true",children:[A.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-border",children:[A.jsx("h2",{className:"text-xl font-bold text-card-foreground",children:"Add Transaction"}),A.jsx("button",{onClick:t,className:"text-muted-foreground hover:text-foreground",children:A.jsx(PE,{className:"w-6 h-6"})})]}),A.jsxs("form",{onSubmit:y,className:"p-4 sm:p-6 space-y-4 overflow-y-auto",children:[A.jsxs("div",{className:"grid grid-cols-2 gap-2 rounded-lg p-1 bg-muted",children:[A.jsx("button",{type:"button",onClick:()=>j(zt.Income),className:`py-2 rounded-md font-semibold transition-colors ${s===zt.Income?"bg-success text-success-foreground shadow":"text-muted-foreground"}`,children:"Income"}),A.jsx("button",{type:"button",onClick:()=>j(zt.Expense),className:`py-2 rounded-md font-semibold transition-colors ${s===zt.Expense?"bg-error text-error-foreground shadow":"text-muted-foreground"}`,children:"Expense"})]}),s===zt.Income?E():T(),A.jsxs("div",{children:[A.jsx("label",{htmlFor:"date",className:"block text-sm font-medium text-muted-foreground mb-1",children:"Date"}),A.jsx("input",{type:"date",id:"date",value:f,onChange:w=>p(w.target.value),required:!0,className:"w-full px-3 py-2 bg-background border border-input rounded-md focus:outline-none focus:ring-2 focus:ring-ring"})]})]}),A.jsx("div",{className:"p-4 sm:p-6 border-t border-border mt-auto",children:A.jsx("button",{type:"submit",form:"add-transaction-form",onClick:y,className:"w-full bg-primary text-primary-foreground font-bold py-3 px-6 rounded-lg hover:bg-primary/90 transition-colors shadow-md disabled:bg-muted disabled:text-muted-foreground disabled:cursor-not-allowed",disabled:s===zt.Income&&g.length===0||s===zt.Expense&&(!u||!a),children:"Add Transaction"})})]})})},LE=({item:r,quantity:t,setQuantity:e,onAddToCart:n})=>{const s=a=>{const c=Math.floor(t);e(c+a)},i=["Kilo","kg","L","Litre"].some(a=>r.unit.toLowerCase().includes(a.toLowerCase()));return A.jsxs("div",{className:"col-span-2 sm:col-span-3 p-3 bg-accent rounded-b-lg -mt-1 mb-2 animate-fade-in border-t-2 border-dashed border-border",children:[A.jsxs("p",{className:"font-semibold mb-2 text-sm text-center text-accent-foreground",children:["Enter Quantity (",r.unit,")"]}),i&&A.jsx("div",{className:"flex justify-center gap-2 mb-3",children:[.25,.5,.75].map(a=>A.jsx("button",{type:"button",onClick:()=>s(a),className:"w-10 h-8 text-sm font-bold bg-background border border-border rounded-md hover:bg-muted transition",children:a===.25?"¼":a===.5?"½":"¾"},a))}),A.jsxs("div",{className:"flex items-center gap-2 mb-3 justify-center",children:[A.jsx("button",{type:"button",onClick:()=>e(a=>Math.max(i?.25:1,a-1)),className:"w-10 h-10 text-2xl font-bold bg-background border border-border rounded-md hover:bg-muted transition",children:"-"}),A.jsx("input",{type:"number",value:t,onChange:a=>e(Number(a.target.value)),step:i?"0.01":"1",className:"w-20 h-10 text-center font-bold text-lg bg-background border border-input rounded-md focus:ring-ring focus:border-ring"}),A.jsx("button",{type:"button",onClick:()=>e(a=>a+1),className:"w-10 h-10 text-2xl font-bold bg-background border border-border rounded-md hover:bg-muted transition",children:"+"})]}),A.jsx("button",{onClick:n,className:"w-full bg-primary/80 text-primary-foreground font-bold py-2 px-4 rounded-lg hover:bg-primary transition-colors",children:"Add to Cart"})]})},sm=G.memo(({currentPage:r,setCurrentPage:t})=>{const e=[{page:wt.Dashboard,label:"Dashboard",icon:tm},{page:wt.Transactions,label:"Transactions",icon:em},{page:wt.Inventory,label:"Inventory",icon:nm},{page:wt.Settings,label:"Settings",icon:rm}];return A.jsxs("nav",{className:"fixed bottom-0 left-0 right-0 bg-card border-t border-border md:hidden z-50",children:[A.jsx("div",{className:"flex justify-around items-center h-16 px-2",children:e.map(({page:n,label:s,icon:i})=>{const a=r===n;return A.jsxs("button",{onClick:()=>t(n),className:`flex flex-col items-center justify-center flex-1 h-full transition-all duration-200 ease-in-out relative group ${a?"text-primary":"text-muted-foreground hover:text-foreground"}`,"aria-label":s,children:[a&&A.jsx("div",{className:"absolute top-0 left-1/2 transform -translate-x-1/2 w-12 h-1 bg-primary rounded-b-full transition-all duration-200"}),A.jsx("div",{className:`transition-all duration-200 ${a?"scale-110":"scale-100 group-hover:scale-105"}`,children:A.jsx(i,{className:`w-6 h-6 transition-colors duration-200 ${a?"text-primary":"text-muted-foreground group-hover:text-foreground"}`})}),A.jsx("span",{className:`text-xs font-medium mt-1 transition-all duration-200 ${a?"text-primary opacity-100":"text-muted-foreground opacity-70 group-hover:opacity-100"}`,children:s}),A.jsx("div",{className:"absolute inset-0 rounded-lg transition-opacity duration-200 opacity-0 group-active:opacity-20 group-active:bg-primary/20"})]},n)})}),A.jsx("div",{className:"h-safe-area-inset-bottom bg-card"})]})});sm.displayName="BottomNav";const FE=({status:r})=>{const t={synced:{Icon:kE,text:"Synced",color:"text-success",animation:""},syncing:{Icon:NE,text:"Syncing...",color:"text-info",animation:"animate-spin"},offline:{Icon:ME,text:"Offline",color:"text-warning",animation:""}},{Icon:e,text:n,color:s,animation:i}=t[r];return A.jsxs("div",{className:`flex items-center gap-2 text-sm font-semibold ${s}`,children:[A.jsx(e,{className:`w-5 h-5 ${i}`}),A.jsx("span",{className:"hidden sm:inline",children:n})]})},rn=class rn{constructor(){Lt(this,"metrics",new Map);Lt(this,"observers",new Map);this.initObservers()}static getInstance(){return rn.instance||(rn.instance=new rn),rn.instance}initObservers(){if("PerformanceObserver"in window){try{const t=new PerformanceObserver(e=>{for(const n of e.getEntries())console.warn("Long task detected:",n.duration,"ms")});t.observe({entryTypes:["longtask"]}),this.observers.set("longtask",t)}catch{console.warn("Long task observer not supported")}try{const t=new PerformanceObserver(e=>{for(const n of e.getEntries()){const s=n;s.value>.1&&console.warn("Layout shift detected:",s.value)}});t.observe({entryTypes:["layout-shift"]}),this.observers.set("layout-shift",t)}catch{console.warn("Layout shift observer not supported")}}}startMeasure(t){"performance"in window&&performance.mark(`${t}-start`)}endMeasure(t){if("performance"in window){performance.mark(`${t}-end`),performance.measure(t,`${t}-start`,`${t}-end`);const n=performance.getEntriesByName(t)[0].duration;return this.metrics.set(t,n),console.log(`${t}: ${n.toFixed(2)}ms`),n}return 0}getMetrics(){return new Map(this.metrics)}clearMetrics(){this.metrics.clear()}measureComponentRender(t,e){this.startMeasure(`${t}-render`),e(),this.endMeasure(`${t}-render`)}async measureAsync(t,e){this.startMeasure(t);try{const n=await e();return this.endMeasure(t),n}catch(n){throw this.endMeasure(t),n}}getMemoryInfo(){if("memory"in performance){const t=performance.memory;return{used:t.usedJSHeapSize,total:t.totalJSHeapSize,limit:t.jsHeapSizeLimit}}return null}destroy(){this.observers.forEach(t=>t.disconnect()),this.observers.clear(),this.metrics.clear()}};Lt(rn,"instance");let Ia=rn;function jE(){const r=Ia.getInstance();return{measureRender:(n,s)=>{r.measureComponentRender(n,s)},measureAsync:async(n,s)=>r.measureAsync(n,s),getMetrics:r.getMetrics.bind(r)}}const fh=G.lazy(()=>xi(()=>import("./DashboardPage-Bx4JcTTG.js"),__vite__mapDeps([0,1,2,3]))),BE=G.lazy(()=>xi(()=>import("./TransactionsPage-yIUDp7wD.js"),__vite__mapDeps([4,1,2]))),UE=G.lazy(()=>xi(()=>import("./InventoryPage-CfCvR9Yw.js"),__vite__mapDeps([5,1,2,3]))),qE=G.lazy(()=>xi(()=>import("./SettingsPage-BsTaUK4x.js"),__vite__mapDeps([6,1,2,3]))),xr=()=>A.jsx("div",{className:"flex items-center justify-center min-h-[400px] p-8",children:A.jsxs("div",{className:"text-center",children:[A.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),A.jsx("p",{className:"text-muted-foreground",children:"Loading..."})]})}),zE=()=>{const[r,t]=G.useState(wt.Dashboard),[e,n]=G.useState(!1),{measureAsync:s}=jE(),{trackPageLoad:i,trackUserAction:a,trackTransactionTime:c}=eo(),{handleError:u,retryOperation:d}=Yf(),{data:f,updateData:p,syncStatus:g}=xE("config","settings",{storeName:"Olesco Agrivet Trading",storeLogo:"",profitMarginDivisor:.83,theme:"dark"}),{data:S,addItem:V,deleteItem:C,syncStatus:D}=dh("transactions","date","desc"),{data:z,addItem:B,updateItem:L,deleteItem:j,updateMultipleItems:$,syncStatus:H}=dh("inventory","name","asc");G.useEffect(()=>{i(r)},[r,i]),G.useEffect(()=>{const K=window.document.documentElement;K.classList.remove("light","dark"),K.classList.add(f.theme)},[f.theme]);const v=G.useCallback(async K=>{const Nt=performance.now();try{const ft=Zf(K);if(!ft.isValid)throw new Error(`Validation failed: ${ft.errors.join(", ")}`);await s("add-transaction",async()=>{if(await V(ft.sanitizedData),K.type===zt.Income&&K.items){const Bt=K.items.map(mt=>{const ar=z.find(qe=>qe.id===mt.inventoryItemId);return ar?{id:ar.id,data:{stock:Math.max(0,ar.stock-mt.quantity)}}:null}).filter(mt=>mt!==null);Bt.length>0&&await $(Bt)}}),c(Nt,K.type),a("transaction_added",{type:K.type,amount:K.amount})}catch(ft){const Bt=ft;throw u(Bt,{operation:"add_transaction",data:K}),Bt}},[V,z,$,s,c,a,u]),y=G.useCallback(async K=>{if(window.confirm("Are you sure you want to delete this transaction? This action will not restock items."))try{await d(async()=>await C(K.id),{operation:"delete_transaction"}),a("transaction_deleted",{type:K.type,amount:K.amount})}catch(Nt){const ft=Nt;throw u(ft,{operation:"delete_transaction",data:K}),ft}},[C,d,a,u]),I=G.useCallback(async K=>{try{if("id"in K){const{id:Nt,...ft}=K;await L(Nt,ft),a("inventory_item_updated",{itemId:Nt})}else await B(K),a("inventory_item_added",{itemName:K.name})}catch(Nt){const ft=Nt;throw u(ft,{operation:"save_inventory_item",data:K}),ft}},[B,L,a,u]),E=G.useCallback(async K=>{if(window.confirm("Are you sure you want to delete this item? This cannot be undone."))try{await d(async()=>await j(K),{operation:"delete_inventory_item"}),a("inventory_item_deleted",{itemId:K})}catch(Nt){const ft=Nt;throw u(ft,{operation:"delete_inventory_item",data:{id:K}}),ft}},[j,d,a,u]),T=G.useCallback(async K=>{try{await d(async()=>await p(K),{operation:"save_settings"}),a("settings_updated",{settings:Object.keys(K)})}catch(Nt){const ft=Nt;throw u(ft,{operation:"save_settings",data:K}),ft}},[p,d,a,u]),w=G.useCallback(K=>{p({theme:K}),a("theme_changed",{theme:K})},[p,a]),_=G.useMemo(()=>{const K=[g,D,H];return K.includes("syncing")?"syncing":K.includes("offline")?"offline":"synced"},[g,D,H]),X=G.useMemo(()=>({transactions:S,inventory:z,onNavigate:t,onDeleteTransaction:y,onSaveItem:I,onDeleteItem:E,profitMarginDivisor:f.profitMarginDivisor,settings:f,onSaveSettings:T,theme:f.theme,setTheme:w}),[S,z,f,y,I,E,T]),vt={[wt.Dashboard]:{title:"Dashboard"},[wt.Transactions]:{title:"Transaction History",subtitle:"Review past sales and expenses."},[wt.Inventory]:{title:"Inventory Management"},[wt.Settings]:{title:"Settings",subtitle:"Configure your application and store details."}},or=()=>{switch(r){case wt.Dashboard:return A.jsx(Rr,{children:A.jsx(G.Suspense,{fallback:A.jsx(xr,{}),children:A.jsx(fh,{...X})})});case wt.Transactions:return A.jsx(Rr,{children:A.jsx(G.Suspense,{fallback:A.jsx(xr,{}),children:A.jsx(BE,{...X})})});case wt.Inventory:return A.jsx(Rr,{children:A.jsx(G.Suspense,{fallback:A.jsx(xr,{}),children:A.jsx(UE,{...X})})});case wt.Settings:return A.jsx(Rr,{children:A.jsx(G.Suspense,{fallback:A.jsx(xr,{}),children:A.jsx(qE,{...X})})});default:return A.jsx(Rr,{children:A.jsx(G.Suspense,{fallback:A.jsx(xr,{}),children:A.jsx(fh,{...X})})})}},ye=()=>A.jsxs("div",{className:"flex items-center justify-between gap-4 p-4",children:[A.jsxs("div",{className:"flex items-center gap-4",children:[f.storeLogo?A.jsx("img",{src:f.storeLogo,alt:"Store Logo",className:"w-12 h-12 rounded-md object-cover flex-shrink-0 bg-secondary"}):A.jsx("div",{className:"w-12 h-12 rounded-md flex-shrink-0 bg-secondary flex items-center justify-center text-muted-foreground",children:A.jsx(DE,{className:"w-full h-full p-1 opacity-50"})}),A.jsxs("div",{children:[A.jsx("p",{className:"text-sm text-muted-foreground",children:"Welcome to"}),A.jsx("h1",{className:"text-xl font-bold text-foreground",children:f.storeName})]})]}),A.jsx("div",{className:"flex-shrink-0",children:A.jsx(FE,{status:_})})]}),Ue=()=>A.jsxs("aside",{className:"w-64 bg-card shadow-lg hidden md:flex flex-col border-r border-border",children:[A.jsx("div",{className:"border-b border-border",children:A.jsx(ye,{})}),A.jsx("nav",{className:"flex flex-col gap-2 p-4",children:[{page:wt.Dashboard,label:"Dashboard",icon:A.jsx(tm,{className:"w-5 h-5"})},{page:wt.Transactions,label:"Transactions",icon:A.jsx(em,{className:"w-5 h-5"})},{page:wt.Inventory,label:"Inventory",icon:A.jsx(nm,{className:"w-5 h-5"})},{page:wt.Settings,label:"Settings",icon:A.jsx(rm,{className:"w-5 h-5"})}].map(K=>A.jsxs("button",{onClick:()=>{t(K.page),a("navigation",{page:K.page})},className:`flex items-center gap-3 p-3 rounded-lg text-left transition-colors ${r===K.page?"bg-primary text-primary-foreground":"text-muted-foreground hover:bg-muted hover:text-foreground"}`,children:[K.icon,A.jsx("span",{className:"font-semibold",children:K.label})]},K.page))})]});return A.jsxs("div",{className:"flex min-h-screen bg-background",children:[A.jsx(Ue,{}),A.jsxs("div",{className:"flex-1 flex flex-col max-w-full overflow-hidden",children:[A.jsx("div",{className:"md:hidden border-b border-border bg-card",children:A.jsx(ye,{})}),A.jsxs("main",{className:"flex-1 p-4 md:p-8 pb-20 md:pb-8 overflow-y-auto",children:[A.jsxs("div",{className:"mb-6",children:[A.jsx("h2",{className:"text-3xl font-bold text-foreground",children:vt[r].title}),vt[r].subtitle&&A.jsx("p",{className:"text-muted-foreground mt-1",children:vt[r].subtitle})]}),or()]})]}),A.jsx("button",{onClick:()=>{n(!0),a("add_transaction_button_clicked")},className:"fixed bottom-20 right-4 md:bottom-8 md:right-8 w-16 h-16 bg-primary rounded-full text-primary-foreground shadow-lg flex items-center justify-center hover:bg-primary/90 transition-transform transform hover:scale-110 z-40","aria-label":"Add Transaction",children:A.jsx(CE,{className:"w-8 h-8"})}),A.jsx(OE,{isOpen:e,onClose:()=>{n(!1),a("add_transaction_modal_closed")},onAddTransaction:v,inventory:z}),A.jsx(sm,{currentPage:r,setCurrentPage:t})]})},im=document.getElementById("root");if(!im)throw new Error("Could not find root element to mount to");const $E=Hm.createRoot(im);$E.render(A.jsx(he.StrictMode,{children:A.jsx(zE,{})}));export{rv as C,nv as D,XE as E,tv as I,iv as L,av as M,wt as P,ov as S,zt as T,ev as U,ZE as W,xi as _,JE as a,YE as b,sv as c,VE as d,QE as e,PE as f,A as j};
